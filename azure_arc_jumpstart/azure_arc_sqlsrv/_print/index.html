<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.80.0"><link rel=canonical type=text/html href=/azure_arc_jumpstart/azure_arc_sqlsrv/><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Azure Arc enabled SQL Server | Goldydocs</title><meta property="og:title" content="Azure Arc enabled SQL Server"><meta property="og:description" content="The deployment scenarios in this section will guide you through onboarding Microsoft SQL Server as an Azure Arc enabled SQL server."><meta property="og:type" content="website"><meta property="og:url" content="/azure_arc_jumpstart/azure_arc_sqlsrv/"><meta property="og:site_name" content="Goldydocs"><meta itemprop=name content="Azure Arc enabled SQL Server"><meta itemprop=description content="The deployment scenarios in this section will guide you through onboarding Microsoft SQL Server as an Azure Arc enabled SQL server."><meta name=twitter:card content="summary"><meta name=twitter:title content="Azure Arc enabled SQL Server"><meta name=twitter:description content="The deployment scenarios in this section will guide you through onboarding Microsoft SQL Server as an Azure Arc enabled SQL server."><link rel=preload href=/scss/main.min.4aec00cbc82dae02258a2ba135990358146339f666dc47346f0f1e49d7a6fa42.css as=style><link href=/scss/main.min.4aec00cbc82dae02258a2ba135990358146339f666dc47346f0f1e49d7a6fa42.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zM197.0804 232.033c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zM197.0839 232.0372c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zM197.0839 232.0372c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zM197.0804 177.6188c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zM197.0839 177.623c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zM197.0839 177.623c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zM197.5309 286.4723c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zM197.5344 286.4765c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zM197.5344 286.4765c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zM197.0804 340.5784c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zM197.0839 340.5826c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zM197.0839 340.5826c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Goldydocs</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/no/>Norsk</a>
<a class=dropdown-item href=/fa/>فارسی</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="print();return false;">Click here to print</a>.</p><p><a href=/azure_arc_jumpstart/azure_arc_sqlsrv/>Return to the regular view of this page</a>.</p></div><h1 class=title>Azure Arc enabled SQL Server</h1><div class=lead>The deployment scenarios in this section will guide you through onboarding Microsoft SQL Server as an Azure Arc enabled SQL server.</div><ul><li>1: <a href=#pg-c12c951b6c375f80f7847834cdcc8abd>Microsoft Azure</a></li><ul><li>1.1: <a href=#pg-7e6a22f521dd06e37a0862afc3cc5a51>SQL Server Virtual Machine</a></li><ul></ul></ul><li>2: <a href=#pg-cfa90491acfc4183e3edd8811ffcda55>Amazon Web Services</a></li><ul><li>2.1: <a href=#pg-1c7623fa022f4e3eda2af8b035cbb220>SQL Server EC2 instance</a></li><ul></ul></ul><li>3: <a href=#pg-48665cd3821fc3cb6a56e5bf4a7b1700>Google Cloud Platform</a></li><ul><li>3.1: <a href=#pg-902ce380d3ffe6b2389dbb5f0587b0ec>SQL Server GCP instance</a></li><ul></ul></ul><li>4: <a href=#pg-c2f7cf1f325670d4b3c331a6b7955873>VMware vSphere</a></li><ul><li>4.1: <a href=#pg-d522c677fb3694c8b330c3549f9e9cb2>SQL Server VM</a></li><ul></ul></ul></ul><div class=content></div></div><div class=td-content><h1 id=pg-c12c951b6c375f80f7847834cdcc8abd>1 - Microsoft Azure</h1><div class=lead>The following guide in this section will walk you through how to project an Azure VM installed with SQL Server as an Azure Arc enabled server and Azure Arc enabled SQL. This guide, using Azure VM as the targeted Azure Arc enabled SQL Server, is designed <strong>for demo and testing purposes ONLY and are not supported.</strong> In the guide you will find a detailed technical explanation of the mechanism and why <strong>it is not expected to project an Azure VM as an Azure Arc enabled server.</strong>
In each guide, you find a detailed, technical explanation of the mechanism and why it is not expected to project an Azure VM as an Azure Arc enabled server.</div></div><div class=td-content><h1 id=pg-7e6a22f521dd06e37a0862afc3cc5a51>1.1 - SQL Server Virtual Machine</h1><h2 id=deploy-an-azure-virtual-machine-with-windows-server--microsoft-sql-server-and-connect-it-to-azure-arc-using-terraform>Deploy an Azure Virtual Machine with Windows Server & Microsoft SQL Server and connect it to Azure Arc using Terraform</h2><p>The following README will guide you on how to use the provided <a href=https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/overview>Azure ARM Template</a> to deploy an Azure VM installed with Windows Server and Microsoft SQL Server 2019 (Developer edition) and connect it as an Azure Arc enabled SQL server resource.</p><p>Azure VMs are leveraging the <a href=https://docs.microsoft.com/en-us/azure/virtual-machines/windows/instance-metadata-service>Azure Instance Metadata Service (IMDS)</a> by default. By projecting an Azure VM as an Azure Arc enabled server, a &ldquo;conflict&rdquo; is created which will not allow for the Azure Arc server resources to be represented as one when the IMDS is being used and instead, the Azure Arc server will still &ldquo;act&rdquo; as a native Azure VM.</p><p>However, <strong>for demo purposes only</strong>, the below guide will allow you to use and onboard Azure VMs to Azure Arc and by doing so, you will be able to simulate a server which is deployed outside of Azure (i.e &ldquo;on-premises&rdquo; or in other cloud platforms)</p><blockquote><p><strong>Note: It is not expected for an Azure VM to be projected as an Azure Arc enabled server. The below scenario is unsupported and should ONLY be used for demo and testing purposes.</strong></p></blockquote><p>By the end of the guide, you will have an Azure VM installed with Windows Server 2019 with SQL Server 2019, projected as an Azure Arc enabled SQL Server and a running SQL assessment with data injected to Azure Log Analytics workspace.</p><blockquote><p><strong>Note: Currently, Azure Arc enabled SQL Server is in <a href="https://docs.microsoft.com/en-us/sql/sql-server/azure-arc/overview?view=sql-server-ver15">public preview</a></strong>.</p></blockquote><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p>In case you don&rsquo;t already have one, you can <a href=https://azure.microsoft.com/en-us/free/>Create a free Azure account</a>.</p></li><li><p>Create Azure service principal (SP)</p><p>In order for you to deploy the Azure resources using the ARM template, Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note It is optional, but highly recommended, to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a>.</strong></p></blockquote></li></ul><h2 id=automation-flow>Automation Flow</h2><p>The automation for this scenario include 3 PowerShell scripts executed in the following order:</p><ol><li><p><a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_sqlsrv_jumpstart/azure/arm_template/scripts/ClientTools.ps1><em>ClientTools.ps1</em></a> - Executed at ARM Template deployment time as a CustomScriptExtension. This script has two main functionalities:</p><ol><li>Generate the <em>LogonScript.ps1</em> script and will configure a Windows scheduled task to <em>LogonScript</em> when user log in the VM for the first time.</li><li>Download the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_sqlsrv_jumpstart/azure/arm_template/scripts/ArcOnboarding.ps1><em>ArcOnboarding.ps1</em></a> script.</li></ol></li><li><p><em>LogonScript.ps1</em> - Auto generated by the <em>ClientTools</em> script. This script has two main functionalities:</p><ol><li>Install and configure SQL Server on the VM</li><li>Execute the <em>ArcOnboarding</em> script</li></ol></li><li><p><a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_sqlsrv_jumpstart/azure/arm_template/scripts/ArcOnboarding.ps1><em>ArcOnboarding.ps1</em></a> - This is the main script and will be executed by the <em>LogonScript</em> script at VM runtime. This script has multiple functionalities:</p><ol><li>Restore AdventureWorksLT2019 Database</li><li>Allow Azure VM to be onboard to Azure Arc</li><li>Project VM as an Azure Arc enabled server resource</li><li>Project SQL Server as an Azure Arc enabled SQL server resource</li><li>Deploy Log Analytics workspace and Solutions</li><li>Install Log Analytics agent using extension on Azure Arc server</li><li>Create SQL Assessment and inject data to Azure Log Analytics workspace</li></ol></li></ol><p>For you to get familiar with the automation and deployment flow, below is an explanation.</p><ol><li><p>User is editing the ARM template parameters file (1-time edit). These parameters values are being used throughout the deployment.</p></li><li><p>The ARM template incl. an Azure VM Custom Script Extension which will deploy the the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_sqlsrv_jumpstart/azure/arm_template/scripts/ClientTools.ps1><em>ClientTools.ps1</em></a> PowerShell Script. The script will:</p><ol><li><p>Download the <em>ArcOnboarding.ps1</em> PowerShell script</p></li><li><p>Set local OS environment variables</p></li><li><p>Generate a local OS logon script named <em>LogonScript.ps1</em>. This script will:</p></li></ol></li></ol><h2 id=deployment>Deployment</h2><p>As mentioned, this deployment will use an ARM Template. You will deploy a single template, responsible for creating all the Azure resources in a single resource group as well onboarding the created VM to Azure Arc.</p><ul><li><p>Before deploying the ARM template, login to Azure using AZ CLI with the <code>az login</code> command.</p></li><li><p>The deployment is using the ARM template parameters file. Before initiating the deployment, edit the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_sqlsrv_jumpstart/azure/arm_template/azuredeploy.parameters.json><em>azuredeploy.parameters.json</em></a> file located in your local cloned repository folder. An example parameters file is located <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_sqlsrv_jumpstart/azure/arm_template/azuredeploy.parameters.example.json>here</a>.</p></li><li><p>To deploy the ARM template, navigate to the local cloned <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_sqlsrv_jumpstart/azure/arm_template>deployment folder</a> and run the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az group create --name &lt;Name of the Azure resource group&gt; --location &lt;Azure Region&gt; --tags <span style=color:#4e9a06>&#34;Project=jumpstart_azure_arc_sql&#34;</span>
az deployment group create <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--name &lt;The name of this deployment&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--template-uri https://raw.githubusercontent.com/microsoft/azure_arc/main/azure_arc_sqlsrv_jumpstart/azure/arm_template/azuredeploy.json <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--parameters &lt;The *azuredeploy.parameters.json* parameters file location&gt;
</code></pre></div><blockquote><p><strong>Note: Make sure that you are using the same Azure resource group name as the one you&rsquo;ve just used in the <em>azuredeploy.parameters.json</em> file</strong></p></blockquote><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az group create --name Arc-SQL-Demo --location <span style=color:#4e9a06>&#34;East US&#34;</span> --tags <span style=color:#4e9a06>&#34;Project=jumpstart_azure_arc_sql&#34;</span>
az deployment group create <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--resource-group Arc-Servers-Win-Demo <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--name arcsqlsrvdemo <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--template-uri https://raw.githubusercontent.com/microsoft/azure_arc/main/azure_arc_sqlsrv_jumpstart/azure/arm_template/azuredeploy.json <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--parameters azuredeploy.parameters.json
</code></pre></div></li><li><p>Once Azure resources has been provisioned, you will be able to see it in Azure portal.</p><p><img src=./01.jpg alt="Screenshot showing ARM deployment"></p><p><img src=./02.jpg alt="Screenshot showing Azure Portal with Azure resources"></p></li></ul><h2 id=windows-login--post-deployment>Windows Login & Post Deployment</h2><ul><li><p>Now that the Windows Server VM has been deployed, it is time to login to it. Using it&rsquo;s public IP, RDP to the VM.</p><p><img src=./03.jpg alt="Screenshot showing Overview tab of Azure VM"></p></li><li><p>At first login, as mentioned in the &ldquo;Automation Flow&rdquo; section, a logon script will get executed. This script was created as part of the automated deployment process.</p><p>Let the script to run its course and <strong>do not close</strong> the PowerShell session, this will be done for you once completed.</p><blockquote><p><strong>Note: The script run time is ~10-15min long</strong></p></blockquote><p><img src=./04.jpg alt="Screenshot showing PowerShell script executing in VM"></p><p><img src=./05.jpg alt="Screenshot showing showing PowerShell script executing in VM"></p><p><img src=./06.jpg alt="Screenshot showing showing PowerShell script executing in VM"></p><p><img src=./07.jpg alt="Screenshot showing showing PowerShell script executing in VM"></p><p><img src=./08.jpg alt="Screenshot showing showing PowerShell script executing in VM"></p><p><img src=./09.jpg alt="Screenshot showing showing PowerShell script executing in VM"></p><p><img src=./10.jpg alt="Screenshot showing showing PowerShell script executing in VM"></p><p><img src=./11.jpg alt="Screenshot showing showing PowerShell script executing in VM"></p><p><img src=./12.jpg alt="Screenshot showing showing PowerShell script executing in VM"></p><p><img src=./13.jpg alt="Screenshot showing showing PowerShell script executing in VM"></p></li><li><p>Upon successful run, in the Azure portal, notice you now have a new Azure Arc enabled server (with the Microsoft Monitoring agent installed via an extension) and Azure Arc enabled SQL resources as well as Azure Log Analytics added to the resource group.</p><p><img src=./14.jpg alt="Screenshot showing Azure Arc enabled SQL resources"></p><p><img src=./15.jpg alt="Screenshot showing Azure Arc enabled SQL resources"></p><p><img src=./16.jpg alt="Screenshot showing Azure Arc enabled SQL resources"></p></li><li><p>Open Microsoft SQL Server Management Studio (a Windows shortcut will be created for you) and validate the <em>AdventureWorksLT2019</em> sample database is deployed as well.</p><p><img src=./17.jpg alt="Screenshot showing SQL Management Studio"></p><p><img src=./18.jpg alt="Screenshot showing SQL Management Studio"></p></li></ul><h2 id=azure-sql-assessment>Azure SQL Assessment</h2><p>Now that you have both the server and SQL projected as Azure Arc resources, the last step is complete the initiation of the SQL Assessment run.</p><ul><li><p>On the SQL Azure Arc resource, click on &ldquo;Environment Health&rdquo; followed by clicking the &ldquo;Download configuration script&rdquo;.</p><p>Since the <em>LogonScript</em> run in the deployment step took care of deploying and installing the required binaries, you can safely ignore and delete the downloaded <em>AddSqlAssessment.ps1</em> file.</p><p>Clicking the &ldquo;Download configuration script&rdquo; will simply send a REST API call to the Azure portal which will make &ldquo;Step3&rdquo; available and will result with a grayed-out &ldquo;View SQL Assessment Results&rdquo; button.</p><p><img src=./19.jpg alt="Screenshot showing Environment Health blade of Azure Arc enabled SQL server"></p><p><img src=./20.jpg alt="Screenshot showing Environment Health blade of Azure Arc enabled SQL server"></p><p><img src=./21.jpg alt="Screenshot showing Environment Health blade of Azure Arc enabled SQL server"></p><p><img src=./22.jpg alt="Screenshot showing Environment Health blade of Azure Arc enabled SQL server"></p><p>It might take a bit of time, but after ~45-60min you will notice how the &ldquo;View SQL Assessment Results&rdquo; button is available for you to click on. At this point, the SQL assessment data and logs are getting injected to Azure Log Analytics.</p><p>Initially, the amount of data will be limited as it take a while for the assessment to complete a full cycle but after few hours you should be able to see much more data coming in.</p><p><img src=./23.jpg alt="Screenshot showing Environment Health blade of Azure Arc enabled SQL server"></p><p><img src=./24.jpg alt="Screenshot showing Environment Health blade of Azure Arc enabled SQL server"></p></li></ul><h2 id=cleanup>Cleanup</h2><p>To delete the entire deployment, simply delete the resource group from the Azure portal.</p><p><img src=./25.jpg alt="Screenshot showing Azure Portal delete resource group function"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-cfa90491acfc4183e3edd8811ffcda55>2 - Amazon Web Services</h1><div class=lead>If you are working in a multi-cloud environment, you can deploy new a AWS EC2 instance installed with SQL Server in an automated fashion using Terraform and onboard it as Azure Arc enabled SQL Server.</div></div><div class=td-content><h1 id=pg-1c7623fa022f4e3eda2af8b035cbb220>2.1 - SQL Server EC2 instance</h1><h2 id=deploy-an-aws-ec2-instance-with-windows-server--microsoft-sql-server-and-connect-it-to-azure-arc-using-terraform>Deploy an AWS EC2 instance with Windows Server & Microsoft SQL Server and connect it to Azure Arc using Terraform</h2><p>The following README will guide you on how to use the provided <a href=https://www.terraform.io/>Terraform</a> plan to deploy a Windows Server installed with Microsoft SQL Server 2019 (Developer edition) in a Amazon Web Services (AWS) EC2 instance and connect it as an Azure Arc enabled SQL server resource.</p><p>By the end of the guide, you will have an AWS EC2 instance installed with Windows Server 2019 with SQL Server 2019, projected as an Azure Arc enabled SQL server and a running SQL assessment with data injected to Azure Log Analytics workspace.</p><blockquote><p><strong>Note: Currently, Azure Arc enabled SQL Server is in <a href="https://docs.microsoft.com/en-us/sql/sql-server/azure-arc/overview?view=sql-server-ver15">public preview</a></strong>.</p></blockquote><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p><a href=https://aws.amazon.com/free/>Create a free Amazon Web Services account</a> if you don&rsquo;t already have one.</p></li><li><p><a href=https://learn.hashicorp.com/terraform/getting-started/install.html>Install Terraform >=0.12</a></p></li><li><p>Create Azure service principal (SP)</p><p>To connect the EC2 instance to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li></ul><h2 id=create-a-new-aws-iam-role--key>Create a new AWS IAM Role & Key</h2><p>Create AWS User IAM Key. An access key grants programmatic access to your resources which we will be using later on in this guide.</p><ul><li><p>Navigate to the <a href=https://console.aws.amazon.com/iam/home#/home>IAM Access page</a>.</p><p><img src=./01.png alt="Create AWS IAM Role & Key"></p></li><li><p>Select the <strong>Users</strong> from the side menu.</p><p><img src=./02.png alt="Create AWS IAM Role & Key"></p></li><li><p>Select the <strong>User</strong> you want to create the access key for.</p><p><img src=./03.png alt="Create AWS IAM Role & Key"></p></li><li><p>Select <strong>Security credentials</strong> of the <strong>User</strong> selected.</p><p><img src=./04.png alt="Create AWS IAM Role & Key"></p></li><li><p>Under <strong>Access Keys</strong> select <strong>Create Access Keys</strong>.</p><p><img src=./05.png alt="Create AWS IAM Role & Key"></p></li><li><p>In the popup window it will show you the <em><strong>Access key ID</strong></em> and <em><strong>Secret access key</strong></em>. Save both of these values to configure the <strong>Terraform plan</strong> variables later.</p><p><img src=./06.png alt="Create AWS IAM Role & Key"></p></li></ul><h2 id=automation-flow>Automation Flow</h2><p>For you to get familiar with the automation and deployment flow, below is an explanation.</p><ol><li><p>User is exporting the Terraform environment variables (1-time export) which are being used throughout the deployment.</p></li><li><p>User is executing the Terraform plan which will deploy the EC2 instance as well as:</p><ol><li><p>Create an Administrator Windows user account, enabling WinRM on the VM and change the Windows Computer Name.</p></li><li><p>Generate and execute the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_sqlsrv_jumpstart/aws/winsrv/terraform/scripts/sql.ps1.tmpl><em>sql.ps1</em></a> script. This script will:</p><ol><li><p>Install Azure CLI, Azure PowerShell module and SQL Server Management Studio (SSMS) <a href=https://chocolatey.org/>Chocolaty packages</a>.</p></li><li><p>Create a runtime logon script (<em>LogonScript.ps1</em>) which will run upon the user first logon to Windows. Runtime script will:</p><ul><li>Install SQL Server Developer Edition</li><li>Enable SQL TCP protocol on the default instance</li><li>Create SQL Server Management Studio Desktop shortcut</li><li>Restore <a href="https://docs.microsoft.com/en-us/sql/samples/adventureworks-install-configure?view=sql-server-ver15&tabs=ssms"><em>AdventureWorksLT2019</em></a> Sample Database</li><li>Onboard both the server and SQL to Azure Arc</li><li>Deploy Azure Log Analytics and a workspace</li><li>Install the <a href=https://docs.microsoft.com/en-us/services-hub/health/mma-setup>Microsoft Monitoring Agent (MMA) agent</a></li><li>Enable Log Analytics Solutions</li><li>Deploy MMA Azure Extension ARM Template from within the VM</li><li>Configure SQL Azure Assessment</li></ul></li><li><p>Disable and prevent Windows Server Manager from running on startup</p></li></ol></li></ol></li><li><p>Once Terraform plan deployment has completed and upon the user initial RDP login to Windows, <em>LogonScript.ps1</em> script will run automatically and execute all the above.</p></li></ol><h2 id=deployment>Deployment</h2><p>Before executing the Terraform plan, you must set the environment variables which will be used by the plan. These variables are based on the Azure service principal you&rsquo;ve just created, your Azure subscription and tenant, and your AWS account.</p><ul><li><p>Retrieve your Azure subscription ID and tenant ID using the <code>az account list</code> command.</p></li><li><p>The Terraform plan creates resources in both Microsoft Azure and AWS. It then executes a script on the virtual machine to install all the necessary artifacts.</p><p>Both the script and the Terraform plan itself requires certain information about your AWS and Azure environments. Edit variables according to your environment and export it using the below commands</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_subId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your Azure subscription ID&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_servicePrincipalAppId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your Azure service principal  App ID&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_servicePrincipalSecret</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your Azure service principal  App Password&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_servicePrincipalTenantId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your Azure tenant ID&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_location</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Azure region&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_resourceGroup</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Azure resource group name&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_AWS_ACCESS_KEY_ID</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your AWS Access Key ID&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_AWS_SECRET_ACCESS_KEY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your AWS Secret Key&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_key_name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your AWS Key Pair name&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_aws_region</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;AWS region&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_aws_availabilityzone</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;AWS Availability Zone region&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_instance_type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;EC2 instance type&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_hostname</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;EC2 instance Windows Computer Name&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_admin_user</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Guest OS Admin Username&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_admin_password</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Guest OS Admin Password&#39;</span>
</code></pre></div><p><img src=./07.png alt="Export terraform variables"></p></li><li><p>From the folder within your cloned repo where the Terraform binaries are, the below commands to download the needed TF providers and to run the plan.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>terraform init
terraform apply --auto-approve
</code></pre></div><p>Once the Terraform plan deployment has completed, a new Windows Server VM will be up & running as well as an empty Azure resource group will be created.</p><p><img src=./08.png alt="terraform apply completed"></p><p><img src=./09.png alt="New AWS EC2 instance"></p><p><img src=./10.png alt="An empty Azure resource group"></p></li><li><p>Download the RDP file and log in to the VM (<strong>using the data from the <em>TF_VAR_admin_user</em> and <em>TF_VAR_admin_password</em> environment variables</strong>) which will initiate the <em>LogonScript</em> run. Let the script to run it&rsquo;s course and which will also close the PowerShell session when completed.</p><p><img src=./11.png alt="Connect to AWS EC2 instance"></p><p><img src=./12.png alt="Connect to AWS EC2 instance"></p><blockquote><p><strong>Note: The script runtime will take ~10-15min to complete</strong></p></blockquote><p><img src=./13.png alt="PowerShell LogonScript run"></p><p><img src=./14.png alt="PowerShell LogonScript run"></p><p><img src=./15.png alt="PowerShell LogonScript run"></p><p><img src=./16.png alt="PowerShell LogonScript run"></p><p><img src=./17.png alt="PowerShell LogonScript run"></p><p><img src=./18.png alt="PowerShell LogonScript run"></p><p><img src=./19.png alt="PowerShell LogonScript run"></p><p><img src=./20.png alt="PowerShell LogonScript run"></p><p><img src=./21.png alt="PowerShell LogonScript run"></p></li><li><p>Open Microsoft SQL Server Management Studio (a Windows shortcut will be created for you) and validate the <em>AdventureWorksLT2019</em> sample database is deployed as well.</p><p><img src=./22.png alt="Microsoft SQL Server Management Studio"></p><p><img src=./23.png alt="AdventureWorksLT2019 sample database"></p></li><li><p>In the Azure Portal, notice you now have an Azure Arc enabled server resource (with the MMA agent installed via an Extension), Azure Arc enabled SQL server resource and Azure Log Analytics deployed.</p><p><img src=./24.png alt="An Azure resource group with deployed resources"></p><p><img src=./25.png alt="Azure Arc enabled server resource"></p><p><img src=./26.png alt="MMA agent installed via an Extension"></p><p><img src=./27.png alt="Azure Arc enabled SQL server resources"></p></li></ul><h2 id=azure-sql-assessment>Azure SQL Assessment</h2><p>Now that you have both the server and SQL projected as Azure Arc resources, the last step is complete the initiation of the SQL Assessment run.</p><ul><li><p>On the SQL Azure Arc resource, click on &ldquo;Environment Health&rdquo; followed by clicking the &ldquo;Download configuration script&rdquo;.</p><p>Since the <em>LogonScript</em> run in the deployment step took care of deploying and installing the required binaries, you can safely and delete the downloaded <em>AddSqlAssessment.ps1</em> file.</p><p>Clicking the &ldquo;Download configuration script&rdquo; will simply send a REST API call to the Azure portal which will make &ldquo;Step3&rdquo; available and will result with a grayed-out &ldquo;View SQL Assessment Results&rdquo; button.</p><p><img src=./28.png alt="SQL Assessment Environment Health"></p><p><img src=./29.png alt="SQL Assessment Environment Health"></p><p><img src=./30.png alt="View SQL Assessment Results"></p></li><li><p>After few minutes you will notice how the &ldquo;View SQL Assessment Results&rdquo; button is available for you to click on. At this point, the SQL assessment data and logs are getting injected to Azure Log Analytics.</p><p>Initially, the amount of data will be limited as it take a while for the assessment to complete a full cycle but after few hours you should be able to see much more data coming in.</p><p><img src=./31.png alt="SQL Assessment results"></p><p><img src=./32.png alt="SQL Assessment results"></p></li></ul><h2 id=cleanup>Cleanup</h2><p>To delete the environment, use the <em><code>terraform destroy --auto-approve</code></em> command which will delete the AWS and the Azure resources.</p><p><img src=./33.png alt="terraform destroy completed"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-48665cd3821fc3cb6a56e5bf4a7b1700>3 - Google Cloud Platform</h1><div class=lead>If you are working in a multi-cloud environment, you can deploy new a GCP instance installed with SQL Server in an automated fashion using Terraform and onboard it as Azure Arc enabled SQL Server.</div></div><div class=td-content><h1 id=pg-902ce380d3ffe6b2389dbb5f0587b0ec>3.1 - SQL Server GCP instance</h1><h2 id=deploy-a-gcp-instance-with-windows-server--microsoft-sql-server-and-connect-it-to-azure-arc-using-terraform>Deploy a GCP instance with Windows Server & Microsoft SQL Server and connect it to Azure Arc using Terraform</h2><p>The following README will guide you on how to use the provided <a href=https://www.terraform.io/>Terraform</a> plan to deploy a Windows Server installed with Microsoft SQL Server 2019 (Developer edition) in a Google Cloud Platform (GCP) virtual machine and connect it as an Azure Arc enabled SQL server resource.</p><p>By the end of the guide, you will have a GCP VM instance installed with Windows Server 2019 with SQL Server 2019, projected as an Azure Arc enabled SQL Server and a running SQL assessment with data injected to Azure Log Analytics workspace.</p><blockquote><p><strong>Note: Currently, Azure Arc enabled SQL Server is in <a href="https://docs.microsoft.com/en-us/sql/sql-server/azure-arc/overview?view=sql-server-ver15">public preview</a></strong>.</p></blockquote><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p><a href=https://cloud.google.com/free>Create a free Google Cloud account</a> if you don&rsquo;t have one already.</p></li><li><p><a href=https://learn.hashicorp.com/terraform/getting-started/install.html>Install Terraform >=0.12</a></p></li><li><p>Create Azure service principal (SP)</p><p>To connect the GCP virtual machine to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li></ul><h2 id=create-a-new-gcp-project-iam-role--service-account>Create a new GCP Project, IAM Role & Service Account</h2><p>In order to deploy resources in GCP, we will create a new GCP Project as well as a service account to allow Terraform to authenticate against GCP APIs and run the plan to deploy resources.</p><ul><li><p>Browse to <a href=https://console.cloud.google.com/>https://console.cloud.google.com/</a> and login with your Google Cloud account. Once logged in, <a href=https://cloud.google.com/resource-manager/docs/creating-managing-projects>create a new project</a> named &ldquo;Azure Arc Demo&rdquo;. After creating it, be sure to copy down the project id as it is usually different then the project name.</p><p><img src=./01.png alt="Screenshot showing GCP cloud console dashboard"></p><p><img src=./02.png alt="Screenshot showing GCP console new project creation"></p><p><img src=./03.png alt="Screenshot showing GCP console new project creation"></p></li><li><p>Enable the Compute Engine API for the project, create a project Owner service account credentials and download the private key JSON file and copy the file to the directory where Terraform files are located. Change the JSON file name (for example <em>account.json</em>). The Terraform plan will be using the credentials stored in this file to authenticate against your GCP project.</p><p><img src=./04.png alt="Screenshot showing enabling Compute Engine API in GCP"></p><p><img src=./05.png alt="Screenshot showing enabling Compute Engine API in GCP"></p><p><img src=./06.png alt="Screenshot showing creating a GCP service account"></p><p><img src=./07.png alt="Screenshot showing creating a GCP service account"></p><p><img src=./08.png alt="Screenshot showing creating a GCP service account"></p><p><img src=./09.png alt="Screenshot showing creating a GCP service account"></p><p><img src=./10.png alt="Screenshot showing creating a GCP service account"></p><p><img src=./11.png alt="Screenshot showing creating a GCP service account"></p><p><img src=./12.png alt="Screenshot showing creating a GCP service account key"></p><p><img src=./13.png alt="Screenshot showing creating a GCP service account key"></p><p><img src=./14.png alt="Screenshot showing creating a GCP service account key"></p><p><img src=./15.png alt="Screenshot showing creating a GCP service account key"></p><p><img src=./16.png alt="Screenshot GCP service account key saved to project folder in Visual Studio Code"></p></li><li><p>Enable the Kubernetes Engine API for the project</p><p><img src=./17.png alt="Screenshot showing enabling the Kubernetes Engine API"></p><p><img src=./18.png alt="Screenshot showing enabling the Kubernetes Engine API"></p></li></ul><h2 id=automation-flow>Automation Flow</h2><p>For you to get familiar with the automation and deployment flow, below is an explanation.</p><ol><li><p>User is exporting the Terraform environment variables (1-time export) which are being used throughout the deployment.</p></li><li><p>User is executing the Terraform plan which will deploy the VM as well as:</p><ol><li><p>Create an Administrator Windows user account and enabling WinRM on the VM</p></li><li><p>Generate and execute the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_sqlsrv_jumpstart/gcp/winsrv/terraform/scripts/sql.ps1.tmpl><em>sql.ps1</em></a> script. This script will:</p><ol><li><p>Install Azure CLI, Azure PowerShell module and SQL Server Management Studio (SSMS) <a href=https://chocolatey.org/>Chocolaty packages</a>.</p></li><li><p>Create a runtime logon script (<em>LogonScript.ps1</em>) which will run upon the user first logon to Windows. Runtime script will:</p><ul><li>Install SQL Server Developer Edition</li><li>Enable SQL TCP protocol on the default instance</li><li>Create SQL Server Management Studio Desktop shortcut</li><li>Restore <a href="https://docs.microsoft.com/en-us/sql/samples/adventureworks-install-configure?view=sql-server-ver15&tabs=ssms"><em>AdventureWorksLT2019</em></a> Sample Database</li><li>Onboard both the server and SQL to Azure Arc</li><li>Deploy Azure Log Analytics and a workspace</li><li>Install the <a href=https://docs.microsoft.com/en-us/services-hub/health/mma-setup>Microsoft Monitoring Agent (MMA) agent</a></li><li>Enable Log Analytics Solutions</li><li>Deploy MMA Azure Extension ARM Template from within the VM</li><li>Configure SQL Azure Assessment</li></ul></li><li><p>Disable and prevent Windows Server Manager from running on startup</p></li></ol></li></ol></li><li><p>Once Terraform plan deployment has completed and upon the user initial RDP login to Windows, <em>LogonScript.ps1</em> script will run automatically and execute all the above.</p></li></ol><h2 id=deployment>Deployment</h2><p>Before executing the Terraform plan, you must set the environment variables which will be used by the plan. These variables are based on the Azure service principal you&rsquo;ve just created, your Azure subscription and tenant, and your GCP project.</p><ul><li><p>Retrieve your Azure subscription ID and tenant ID using the <code>az account list</code> command.</p></li><li><p>The Terraform plan creates resources in both Microsoft Azure and GCP. It then executes a script on the virtual machine to install all the necessary artifacts.</p><p>Both the script and the Terraform plan itself requires certain information about your GCP and Azure environments. Edit variables according to your environment and export it using the below commands</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_subId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your Azure subscription ID&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_servicePrincipalAppId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your Azure service principal App ID&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_servicePrincipalSecret</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your Azure service principal App Password&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_servicePrincipalTenantId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your Azure tenant ID&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_location</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Azure Region&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_resourceGroup</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Azure resource group name&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_gcp_project_id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;GCP Project ID&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_gcp_credentials_filename</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;GCP Project credentials filename&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_gcp_region</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;GCP region where resource will be created&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_gcp_zone</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;GCP zone where resource will be created&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_gcp_instance_name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;GCP VM instance name&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_gcp_instance_machine_type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;GCP VM instance type&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_admin_user</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Guest OS Admin Username&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_admin_password</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Guest OS Admin Password&#39;</span>
</code></pre></div><p><img src=./19.png alt="Screenshot showing exporting environment variables in shell"></p></li><li><p>From the folder within your cloned repo where the Terraform binaries are, the below commands to download the needed TF providers and to run the plan.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>terraform init
terraform apply --auto-approve
</code></pre></div><p>Once the Terraform plan deployment has completed, a new Windows Server VM will be up & running as well as an empty Azure resource group will be created.</p><p><img src=./20.png alt="Screenshot showing terraform apply being run"></p><p><img src=./21.png alt="Screenshot showing GCP cloud console with server"></p><p><img src=./22.png alt="Screenshot showing Azure Portal with empty resource group"></p></li><li><p>Download the RDP file and log in to the VM (<strong>using data from the <em>TF_VAR_admin_user</em> and <em>TF_VAR_admin_password</em> environment variables</strong>) which will initiate the <em>LogonScript</em> run. Let the script to run it&rsquo;s course and which will also close the PowerShell session when completed.</p><p><img src=./23.png alt="Screenshot showing link to download RDP file in GCP cloud console"></p><blockquote><p><strong>Note: The script runtime will take ~10-15min to complete</strong></p></blockquote><p><img src=./24.png alt="Screenshot showing PowerShell script being run in server"></p><p><img src=./25.png alt="Screenshot showing PowerShell script being run in server"></p><p><img src=./26.png alt="Screenshot showing PowerShell script being run in server"></p><p><img src=./27.png alt="Screenshot showing PowerShell script being run in server"></p><p><img src=./28.png alt="Screenshot showing PowerShell script being run in server"></p><p><img src=./29.png alt="Screenshot showing PowerShell script being run in server"></p><p><img src=./30.png alt="Screenshot showing PowerShell script being run in server"></p><p><img src=./31.png alt="Screenshot showing PowerShell script being run in server"></p><p><img src=./32.png alt="Screenshot showing PowerShell script being run in server"></p></li><li><p>Open Microsoft SQL Server Management Studio (a Windows shortcut will be created for you) and validate the <em>AdventureWorksLT2019</em> sample database is deployed as well.</p><p><img src=./33.png alt="Screenshot showing SQL Management Studio"></p><p><img src=./34.png alt="Screenshot showing SQL Management Studio"></p></li><li><p>In the Azure Portal, notice you now have an Azure Arc enabled server resource (with the MMA agent installed via an Extension), Azure Arc enabled SQL resource and Azure Log Analytics deployed.</p><p><img src=./35.png alt="Screenshot showing Azure Portal with Azure Arc enabled SQL resources"></p><p><img src=./36.png alt="Screenshot showing Azure Portal with Azure Arc enabled SQL resources"></p><p><img src=./37.png alt="Screenshot showing Azure Portal with Azure Arc enabled SQL resources"></p><p><img src=./38.png alt="Screenshot showing Azure Portal with Azure Arc enabled SQL resources"></p></li></ul><h2 id=azure-sql-assessment>Azure SQL Assessment</h2><p>Now that you have both the server and SQL projected as Azure Arc resources, the last step is complete the initiation of the SQL Assessment run.</p><ul><li><p>On the SQL Azure Arc resource, click on &ldquo;Environment Health&rdquo; followed by clicking the &ldquo;Download configuration script&rdquo;.</p><p>Since the <em>LogonScript</em> run in the deployment step took care of deploying and installing the required binaries, you can safely and delete the downloaded <em>AddSqlAssessment.ps1</em> file.</p><p>Clicking the &ldquo;Download configuration script&rdquo; will simply send a REST API call to the Azure portal which will make &ldquo;Step3&rdquo; available and will result with a grayed-out &ldquo;View SQL Assessment Results&rdquo; button.</p><p><img src=./39.png alt="Screenshot showing Azure Arc enabled SQL Server Environment Health blade"></p><p><img src=./40.png alt="Screenshot showing Azure Arc enabled SQL Server Environment Health blade"></p><p><img src=./41.png alt="Screenshot showing Azure Arc enabled SQL Server Environment Health blade"></p></li><li><p>After few minutes you will notice how the &ldquo;View SQL Assessment Results&rdquo; button is available for you to click on. At this point, the SQL assessment data and logs are getting injected to Azure Log Analytics.</p><p>Initially, the amount of data will be limited as it take a while for the assessment to complete a full cycle but after few hours you should be able to see much more data coming in.</p><p><img src=./42.png alt="Screenshot showing SQL Assessment Results in Azure Portal"></p><p><img src=./43.png alt="Screenshot showing SQL Assessment Results in Azure Portal"></p></li></ul><h2 id=cleanup>Cleanup</h2><p>To delete the environment, use the <em><code>terraform destroy --auto-approve</code></em> command which will delete the GCP and the Azure resources.</p><p><img src=./44.png alt="Screenshot showing terraform destroy being run"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-c2f7cf1f325670d4b3c331a6b7955873>4 - VMware vSphere</h1><div class=lead>If you are working with an on-premises VMware vSphere infrastructure, you can deploy new Windows Server virtual machine installed with SQL Server in an automated fashion using Terraform and onboard it as Azure Arc enabled SQL Server.</div></div><div class=td-content><h1 id=pg-d522c677fb3694c8b330c3549f9e9cb2>4.1 - SQL Server VM</h1><h2 id=deploy-a-vmware-vsphere-based-windows-server-with-sql-and-connect-it-to-azure-arc-using-terraform>Deploy a VMware vSphere-based Windows Server with SQL and connect it to Azure Arc using Terraform</h2><p>The following README will guide you on how to use the provided <a href=https://www.terraform.io/>Terraform</a> plan to deploy a Windows Server installed with Microsoft SQL Server 2019 (Developer edition) in a VMware vSphere virtual machine and connect it as an Azure Arc enabled SQL server resource.</p><p>By the end of the guide, you will have a VMware vSphere VM installed with Windows Server 2019 with SQL Server 2019, projected as an Azure Arc enabled SQL Server and a running SQL assessment with data injected to Azure Log Analytics workspace.</p><blockquote><p><strong>Note: Currently, Azure Arc enabled SQL Server is in <a href="https://docs.microsoft.com/en-us/sql/sql-server/azure-arc/overview?view=sql-server-ver15">public preview</a></strong>.</p></blockquote><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p><a href=https://learn.hashicorp.com/terraform/getting-started/install.html>Install Terraform >=0.12</a></p></li><li><p>A VMware vCenter Server user with <a href=https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.vm_admin.doc/GUID-8254CD05-CC06-491D-BA56-A773A32A8130.html>permissions to deploy</a> a Virtual Machine from a Template in the vSphere Web Client.</p></li><li><p>Create Azure service principal (SP)</p><p>To connect the VMware vSphere virtual machine to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li></ul><h3 id=preparing-a-window-server-vmware-vsphere-vm-template>Preparing a Window Server VMware vSphere VM Template</h3><p>Before using the below guide to deploy a Windows Server VM and connect it to Azure Arc, a VMware vSphere Template is required. <a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>The following README</a> will instruct you how to easily create such a template using VMware vSphere 6.5 and above.</p><p><strong>The Terraform plan uses the <em>remote-exec</em> provisioner which uses the WinRM protocol to copy and execute the required Azure Arc script. To allow WinRM connectivity to the VM, run the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_sqlsrv_jumpstart/vmware/winsrv/terraform/scripts/allow_winrm.ps1><em>allow_winrm</em></a> PowerShell script on your VM before converting it to template.</strong></p><blockquote><p><strong>Note: If you already have a Windows Server VM template it is still recommended to use the guide as a reference.</strong></p></blockquote><h2 id=automation-flow>Automation Flow</h2><p>For you to get familiar with the automation and deployment flow, below is an explanation.</p><ol><li><p>User is exporting the Terraform environment variables (1-time export) which are being used throughout the deployment.</p></li><li><p>User is executing the Terraform plan which will deploy the VM as well as generate and execute the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_sqlsrv_jumpstart/vmware/winsrv/terraform/scripts/sql.ps1.tmpl><em>sql.ps1</em></a> script. This script will:</p><ol><li><p>Install Azure CLI, Azure PowerShell module and SQL Server Management Studio (SSMS) <a href=https://chocolatey.org/>Chocolaty packages</a>.</p></li><li><p>Create a runtime logon script (<em>LogonScript.ps1</em>) which will run upon the user first logon to Windows. Runtime script will:</p><ul><li>Install SQL Server Developer Edition</li><li>Enable SQL TCP protocol on the default instance</li><li>Create SQL Server Management Studio Desktop shortcut</li><li>Restore <a href="https://docs.microsoft.com/en-us/sql/samples/adventureworks-install-configure?view=sql-server-ver15&tabs=ssms"><em>AdventureWorksLT2019</em></a> Sample Database</li><li>Onboard both the server and SQL to Azure Arc</li><li>Deploy Azure Log Analytics and a workspace</li><li>Install the <a href=https://docs.microsoft.com/en-us/services-hub/health/mma-setup>Microsoft Monitoring Agent (MMA) agent</a></li><li>Enable Log Analytics Solutions</li><li>Deploy MMA Azure Extension ARM Template from within the VM</li><li>Configure SQL Azure Assessment</li></ul></li><li><p>Disable Windows Firewall</p></li><li><p>Disable and prevent Windows Server Manager from running on startup</p></li></ol></li><li><p>Once Terraform plan deployment has completed and upon the user initial RDP login to Windows, <em>LogonScript.ps1</em> script will run automatically and execute all the above.</p></li></ol><h2 id=deployment>Deployment</h2><p>Before executing the Terraform plan, you must set the environment variables which will be used by the plan. These variables are based on the Azure service principal you&rsquo;ve just created, your Azure subscription and tenant, and your VMware vSphere environment.</p><ul><li><p>Retrieve your Azure subscription ID and tenant ID using the <code>az account list</code> command.</p></li><li><p>The Terraform plan creates resources in both Microsoft Azure and VMware vSphere. It then executes a script on the virtual machine to install all the necessary artifacts.</p></li><li><p>Both the script and the Terraform plan itself requires certain information about your VMware vSphere and Azure environments. Edit variables according to your environment and export it using the below commands</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_subId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your Azure subscription ID&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_servicePrincipalAppId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your Azure service principal App ID&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_servicePrincipalSecret</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your Azure service principal App Password&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_servicePrincipalTenantId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Your Azure tenant ID&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_location</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Azure Region&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_resourceGroup</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Azure resource group name&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_vsphere_datacenter</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;VMware vSphere Datacenter Name&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_vsphere_datastore</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;VMware vSphere Datastore Name&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_vsphere_resource_pool</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;VMware vSphere Cluster or Resource Pool Name&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_network_cards</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;VMware vSphere Network Name&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_vsphere_folder</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;VMware vSphere Folder Name&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_vsphere_vm_template_name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;VMware vSphere VM Template Name&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_vsphere_virtual_machine_name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;VMware vSphere VM Name&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_vsphere_virtual_machine_cpu_count</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;VMware vSphere VM CPU Count&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_vsphere_virtual_machine_memory_size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;VMware vSphere VM Memory Size in Megabytes&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_domain</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Domain&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_vsphere_user</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;VMware vSphere vCenter Admin Username&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_vsphere_password</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;VMware vSphere vCenter Admin Password&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_vsphere_server</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;VMware vSphere vCenter server FQDN/IP&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_admin_user</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Guest OS Admin Username&#39;</span>
<span style=color:#204a87>export</span> <span style=color:#000>TF_VAR_admin_password</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Guest OS Admin Password&#39;</span>
</code></pre></div><blockquote><p><strong>Note: Use the Terraform plan <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_sqlsrv_jumpstart/vmware/winsrv/terraform/variables.tf><em>variables.tf</em></a> file for more details around VMware vSphere vars structure if needed</strong></p></blockquote><p><img src=./01.jpg alt="Screenshot of environment variables exporting in shell"></p></li><li><p>From the folder within your cloned repo where the Terraform binaries are, the below commands to download the needed TF providers and to run the plan.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>terraform init
terraform apply --auto-approve
</code></pre></div><p>Once the Terraform plan deployment has completed, a new Windows Server VM will be up & running as well as an empty Azure resource group will be created.</p><p><img src=./02.jpg alt="Screenshot of terraform plan completing"></p><p><img src=./03.jpg alt="Screenshot of SQL Server in vCenter"></p><p><img src=./04.jpg alt="Screenshot of Azure Portal showing empty resource group"></p></li><li><p>Log in to the VM (<strong>using data from the <em>TF_VAR_admin_user</em> and <em>TF_VAR_admin_password</em> environment variables</strong>) which will initiate the <em>LogonScript</em> run. Let the script to run it&rsquo;s course and which will also close the PowerShell session when completed.</p><blockquote><p><strong>Note: The script runtime will take ~10-15min to complete</strong></p></blockquote><p><img src=./05.jpg alt="Screenshot of PowerShell script being run"></p><p><img src=./06.jpg alt="Screenshot of PowerShell script being run"></p><p><img src=./07.jpg alt="Screenshot of PowerShell script being run"></p><p><img src=./08.jpg alt="Screenshot of PowerShell script being run"></p><p><img src=./09.jpg alt="Screenshot of PowerShell script being run"></p><p><img src=./10.jpg alt="Screenshot of PowerShell script being run"></p><p><img src=./11.jpg alt="Screenshot of PowerShell script being run"></p><p><img src=./12.jpg alt="Screenshot of PowerShell script being run"></p><p><img src=./13.jpg alt="Screenshot of PowerShell script being run"></p></li><li><p>Open Microsoft SQL Server Management Studio (a Windows shortcut will be created for you) and validate the <em>AdventureWorksLT2019</em> sample database is deployed as well.</p><p><img src=./14.jpg alt="Screenshot of SQL Server Management Studio"></p><p><img src=./15.jpg alt="Screenshot of SQL Server Management Studio"></p></li><li><p>In the Azure Portal, notice you now have an Azure Arc enabled Server resource (with the MMA agent installed via an Extension), Azure Arc enabled SQL resource and Azure Log Analytics deployed.</p><p><img src=./16.jpg alt="Screenshot of Azure Portal showing Azure Arc enabled SQL server resources"></p><p><img src=./17.jpg alt="Screenshot of Azure Portal showing Azure Arc enabled SQL server resources"></p><p><img src=./18.jpg alt="Screenshot of Azure Portal showing Azure Arc enabled SQL server resources"></p><p><img src=./19.jpg alt="Screenshot of Azure Portal showing Azure Arc enabled SQL server resources"></p></li></ul><h2 id=azure-sql-assessment>Azure SQL Assessment</h2><p>Now that you have both the server and SQL projected as Azure Arc resources, the last step is complete the initiation of the SQL Assessment run.</p><ul><li><p>On the SQL Azure Arc resource, click on &ldquo;Environment Health&rdquo; followed by clicking the &ldquo;Download configuration script&rdquo;.</p><p>Since the <em>LogonScript</em> run in the deployment step took care of deploying and installing the required binaries, you can safely and delete the downloaded <em>AddSqlAssessment.ps1</em> file.</p><p>Clicking the &ldquo;Download configuration script&rdquo; will simply send a REST API call to the Azure portal which will make &ldquo;Step3&rdquo; available and will result with a grayed-out &ldquo;View SQL Assessment Results&rdquo; button.</p><p><img src=./20.jpg alt="Screenshot showing Azure Arc enabled SQL Server Environment Health"></p><p><img src=./21.jpg alt="Screenshot showing Azure Arc enabled SQL Server Environment Health"></p><p><img src=./22.jpg alt="Screenshot showing Azure Arc enabled SQL Server Environment Health"></p></li><li><p>After few minutes you will notice how the &ldquo;View SQL Assessment Results&rdquo; button is available for you to click on. At this point, the SQL assessment data and logs are getting injected to Azure Log Analytics.</p><p>Initially, the amount of data will be limited as it take a while for the assessment to complete a full cycle but after few hours you should be able to see much more data coming in.</p><p><img src=./23.jpg alt="Screenshot showing Azure Arc enabled SQL Server Environment Health"></p><p><img src=./24.jpg alt="Screenshot showing Azure Arc enabled SQL Server Environment Health"></p><p><img src=./25.jpg alt="Screenshot showing Azure Arc enabled SQL Server Environment Health"></p></li></ul><h2 id=cleanup>Cleanup</h2><p>To delete the environment, use the <em><code>terraform destroy --auto-approve</code></em> command which will delete the VMware vSphere VM and the Azure resource group along with it&rsquo;s resources.</p><p><img src=./26.jpg alt="Screenshot showing terraform destroy being run"></p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/stack><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/lujiansong/azure_arc><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 The Docsy Authors All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank>Privacy Policy</a></small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.b5fc1b29d2465835844254bd4d804738eaf24c0cec53009b4c6899989be55a47.js integrity="sha256-tfwbKdJGWDWEQlS9TYBHOOryTAzsUwCbTGiZmJvlWkc=" crossorigin=anonymous></script></body></html>