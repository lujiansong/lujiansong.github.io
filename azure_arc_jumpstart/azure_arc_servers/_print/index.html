<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.80.0"><link rel=canonical type=text/html href=/azure_arc_jumpstart/azure_arc_servers/><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Azure Arc enabled servers | Goldydocs</title><meta property="og:title" content="Azure Arc enabled servers"><meta property="og:description" content="The deployment scenarios in this section will guide you through onboarding various Windows and Linux server distributions as Azure Arc enabled servers."><meta property="og:type" content="website"><meta property="og:url" content="/azure_arc_jumpstart/azure_arc_servers/"><meta property="og:site_name" content="Goldydocs"><meta itemprop=name content="Azure Arc enabled servers"><meta itemprop=description content="The deployment scenarios in this section will guide you through onboarding various Windows and Linux server distributions as Azure Arc enabled servers."><meta name=twitter:card content="summary"><meta name=twitter:title content="Azure Arc enabled servers"><meta name=twitter:description content="The deployment scenarios in this section will guide you through onboarding various Windows and Linux server distributions as Azure Arc enabled servers."><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-00000000-0','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preload href=/scss/main.min.4aec00cbc82dae02258a2ba135990358146339f666dc47346f0f1e49d7a6fa42.css as=style><link href=/scss/main.min.4aec00cbc82dae02258a2ba135990358146339f666dc47346f0f1e49d7a6fa42.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zM197.0804 232.033c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zM197.0839 232.0372c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zM197.0839 232.0372c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zM197.0804 177.6188c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zM197.0839 177.623c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zM197.0839 177.623c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zM197.5309 286.4723c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zM197.5344 286.4765c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zM197.5344 286.4765c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zM197.0804 340.5784c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zM197.0839 340.5826c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zM197.0839 340.5826c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Goldydocs</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/no/>Norsk</a>
<a class=dropdown-item href=/fa/>فارسی</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="print();return false;">Click here to print</a>.</p><p><a href=/azure_arc_jumpstart/azure_arc_servers/>Return to the regular view of this page</a>.</p></div><h1 class=title>Azure Arc enabled servers</h1><div class=lead>The deployment scenarios in this section will guide you through onboarding various Windows and Linux server distributions as Azure Arc enabled servers.</div><ul><li>1: <a href=#pg-f50dbb11f22a2dab04f22fe2fb8d6e85>Onboarding</a></li><ul><li>1.1: <a href=#pg-b0d3d4fad0fd4018d3b43ec4bde91047>Existing Linux server</a></li><ul></ul><li>1.2: <a href=#pg-41648d31abfbcdd577d255c0d8740968>Existing Windows server</a></li><ul></ul></ul><li>2: <a href=#pg-824fa04b9d283e1e5725dc43e7215bc2>Microsoft Azure</a></li><ul><li>2.1: <a href=#pg-4786344b95bcdfe23de1ab08ae70a0a6>Linux Virtual Machine</a></li><ul></ul><li>2.2: <a href=#pg-38881774a1c7c94d3b31a8907926b998>Windows Server Virtual Machine</a></li><ul></ul></ul><li>3: <a href=#pg-42ec827fb753e202548a5a81de66076c>HashiCorp Vagrant</a></li><ul><li>3.1: <a href=#pg-6977b8e9fbf0de3c5e928d5025026e8c>Ubuntu Vagrant box</a></li><ul></ul><li>3.2: <a href=#pg-bc5683d9bbb43663a4b1455cd48f61ea>Windows Vagrant box</a></li><ul></ul></ul><li>4: <a href=#pg-9a3473e6423ee4c24673e9cd153d9658>Amazon Web Services</a></li><ul><li>4.1: <a href=#pg-fc1f094c01d528ff3519c6ccebdccfff>Ubuntu EC2 instance</a></li><ul></ul><li>4.2: <a href=#pg-95541056e5a6754e9f9e64a085445d0f>Amazon Linux 2 EC2 instance</a></li><ul></ul></ul><li>5: <a href=#pg-7064577bc1b93c68f79cd424bda7f426>Google Cloud Platform</a></li><ul><li>5.1: <a href=#pg-d042d13faf89faf82810b281cfa42258>Ubuntu GCP instance</a></li><ul></ul><li>5.2: <a href=#pg-a692f8c5cd59332abe3227bb76485698>Windows GCP instance</a></li><ul></ul></ul><li>6: <a href=#pg-5b91b658f8abbc63f40d299548f9cb0e>VMware vSphere</a></li><ul><li>6.1: <a href=#pg-e56462edb69ef5a1281ec6e2129b4745>Ubuntu VM</a></li><ul><li>6.1.1: <a href=#pg-35f5273e1310f62b1fd14f656ada12a2>Create Ubuntu vSphere template</a></li><ul></ul></ul><li>6.2: <a href=#pg-7ede8ac96598e3cbc19ecd306e0933fe>Windows VM</a></li><ul><li>6.2.1: <a href=#pg-445074e741930bddb3d57e908f6dcc90>Create Windows vSphere template</a></li><ul></ul></ul></ul><li>7: <a href=#pg-0234ac16eaff72421179b07a80c54256>Unified Operations Use Cases</a></li><ul><li>7.1: <a href=#pg-f662c3c6424f0e3f7be88762438f027f>Inventory Tagging</a></li><ul></ul><li>7.2: <a href=#pg-caccbcbc963315fae066659de1818715>Monitoring Agent Extension</a></li><ul></ul><li>7.3: <a href=#pg-8a7b8f2b3e4ec67d3a0eede84e3eae93>Custom Script Extension</a></li><ul></ul><li>7.4: <a href=#pg-4bcf5ee34563db9860f2594f7c5d636a>Azure Policy</a></li><ul></ul><li>7.5: <a href=#pg-1960d9874e7502df863af9a46f8cae84>Key Vault Integration</a></li><ul></ul><li>7.6: <a href=#pg-eda68bcba3c1263207b730fff996799e>Security Center</a></li><ul></ul><li>7.7: <a href=#pg-50dbeacfd1099752a6b9ae86ffca6b70>Azure Sentinel</a></li><ul></ul><li>7.8: <a href=#pg-16e609be239099590da0beb9af17b4c5>Update Management</a></li><ul></ul></ul><li>8: <a href=#pg-8683b32c638509b66c8a8d83ce8e8dd1>Scaled Deployment</a></li><ul><li>8.1: <a href=#pg-3232c0522cad0a1e82efd628559a3a01>VMware vSphere Windows Server VMs</a></li><ul></ul><li>8.2: <a href=#pg-6505de5782967c0e0060cc85e4dbaf9a>VMware vSphere Linux VMs</a></li><ul></ul><li>8.3: <a href=#pg-c74d41f4582660136f72b61a4784fa21>AWS EC2 dynamic inventory with Ansible</a></li><ul></ul></ul></ul><div class=content></div></div><div class=td-content><h1 id=pg-f50dbb11f22a2dab04f22fe2fb8d6e85>1 - Onboarding</h1><div class=lead>The scenarios in this section can be used to onboard your existing Windows or Linux servers as Azure Arc enabled servers.</div></div><div class=td-content><h1 id=pg-b0d3d4fad0fd4018d3b43ec4bde91047>1.1 - Existing Linux server</h1><h2 id=connect-an-existing-linux-server-to-azure-arc>Connect an existing Linux server to Azure Arc</h2><p>The following README will guide you on how to connect an Linux server to Azure Arc using a simple shell script.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p>Create Azure service principal (SP)</p><p>To connect a server to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li><li><p>Create a new Azure resource group where you want your server(s) to show up.</p><p><img src=./01.png alt="Screenshot showing Azure Portal with empty resource group"></p></li><li><p>Download the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/scripts/az_connect_linux.sh>az_connect_linux</a> shell script.</p></li><li><p>Change the environment variables according to your environment.</p><p><img src=./02.png alt="Screenshot showing az_connect_linux shell script"></p></li><li><p>Copy the script to the designated server using your preferred tool of choice (or copy/paste the script to a new file inside the server). Below example shows copy the script from MacOS to the server using SCP.</p><p><img src=./03.png alt="Screenshot showing scp being run"></p></li></ul><h2 id=deployment>Deployment</h2><p>Run the script using the <code>. ./az_connect_linux.sh</code> command.</p><blockquote><p><strong>Note: The extra dot is due to the script has an <em>export</em> function and needs to have the vars exported in the same shell session as the rest of the commands.</strong></p></blockquote><p>Upon completion, you will have your Linux server, connected as a new Azure Arc resource inside your resource group.</p><p><img src=./04.png alt="Screenshot showing az_connect_linux script being run"></p><p><img src=./05.png alt="Screenshot showing Azure Portal with Azure Arc enabled resource"></p><p><img src=./06.png alt="Screenshot showing Azure Portal with Azure Arc enabled resource detail"></p><h2 id=delete-the-deployment>Delete the deployment</h2><p>The most straightforward way is to delete the server via the Azure Portal, just select server and delete it.</p><p><img src=./07.png alt="Screenshot showing delete resource function in Azure Portal"></p><p>If you want to nuke the entire environment, just delete the Azure resource group.</p><p><img src=./08.png alt="Screenshot showing delete resource group function in Azure Portal"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-41648d31abfbcdd577d255c0d8740968>1.2 - Existing Windows server</h1><h2 id=connect-an-existing-windows-server-to-azure-arc>Connect an existing Windows server to Azure Arc</h2><p>The following README will guide you on how to connect an Windows machine to Azure Arc using a simple PowerShell script.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p>Create Azure service principal (SP)</p><p>To connect a server to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li><li><p>Create a new Azure resource group where you want your machine(s) to show up.</p><p><img src=./01.png alt="Screenshot showing Azure Portal with empty resource group"></p></li><li><p>Download the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/scripts/az_connect_win.ps1>az_connect_win</a> PowerShell script.</p></li><li><p>Change the environment variables according to your environment and copy the script to the designated machine.</p><p><img src=./02.png alt="Screenshot showing PowerShell script"></p></li></ul><h2 id=deployment>Deployment</h2><p>On the designated machine, Open PowerShell ISE <strong>as Administrator</strong> and run the script. Note the script is using <em>$env:ProgramFiles</em> as the agent installation path so make sure <strong>you are not using PowerShell ISE (x86)</strong>.</p><p><img src=./03.png alt="Screenshot showing PowerShell script"></p><p><img src=./04.png alt="Screenshot showing PowerShell script"></p><p>Upon completion, you will have your Windows server, connected as a new Azure Arc resource inside your resource group.</p><p><img src=./05.png alt="Screenshot showing PowerShell script being run"></p><p><img src=./06.png alt="Screenshot showing Azure Portal with Azure Arc enabled server resource"></p><p><img src=./07.png alt="Screenshot showing Azure Portal with Azure Arc enabled server resource detail"></p><h2 id=delete-the-deployment>Delete the deployment</h2><p>The most straightforward way is to delete the server via the Azure Portal, just select server and delete it.</p><p><img src=./08.png alt="Screenshot showing delete resource function in Azure Portal"></p><p>If you want to delete the entire environment, just delete the Azure resource group.</p><p><img src=./09.png alt="Screenshot showing delete resource group function in Azure Portal"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-824fa04b9d283e1e5725dc43e7215bc2>2 - Microsoft Azure</h1><div class=lead>The scenarios in this section will walk you through how to project an Azure VM as an Azure Arc enabled server in an automated fashion using either ARM templates or Terraform. These scenarios, using Azure VM as the targeted Azure Arc server are designed <strong>for demo and testing purposes ONLY and are not supported.</strong>
In each scenario, you will find a detailed, technical explanation of the mechanism and why <strong>it is not expected to project an Azure VM as an Azure Arc enabled server.</strong></div></div><div class=td-content><h1 id=pg-4786344b95bcdfe23de1ab08ae70a0a6>2.1 - Linux Virtual Machine</h1><h2 id=deploy-an-ubuntu-azure-virtual-machine-and-connect-it-to-azure-arc-using-arm-template>Deploy an Ubuntu Azure Virtual Machine and connect it to Azure Arc using ARM Template</h2><p>The following README will guide you on how to automatically onboard a Azure Ubuntu VM on to Azure Arc using <a href=https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/overview>Azure ARM Template</a>. The provided ARM template is responsible of creating the Azure resources as well as executing the Azure Arc onboard script on the VM.</p><p>Azure VMs are leveraging the <a href=https://docs.microsoft.com/en-us/azure/virtual-machines/windows/instance-metadata-service>Azure Instance Metadata Service (IMDS)</a> by default. By projecting an Azure VM as an Azure Arc enabled server, a &ldquo;conflict&rdquo; is created which will not allow for the Azure Arc server resources to be represented as one when the IMDS is being used and instead, the Azure Arc server will still &ldquo;act&rdquo; as a native Azure VM.</p><p>However, <strong>for demo purposes only</strong>, the below guide will allow you to use and onboard Azure VMs to Azure Arc and by doing so, you will be able to simulate a server which is deployed outside of Azure (i.e &ldquo;on-premises&rdquo; or in other cloud platforms)</p><blockquote><p><strong>Note: It is not expected for an Azure VM to be projected as an Azure Arc enabled server. The below scenario is unsupported and should ONLY be used for demo and testing purposes.</strong></p></blockquote><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p>In case you don&rsquo;t already have one, you can <a href=https://azure.microsoft.com/en-us/free/>Create a free Azure account</a>.</p></li><li><p>Create Azure service principal (SP).</p><p>In order for you to deploy the Azure resources using the ARM template, Azure service principal assigned with the &ldquo;contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: it is optional, but highly recommended, to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a>.</strong></p></blockquote></li></ul><h2 id=automation-flow>Automation Flow</h2><p>For you to get familiar with the automation and deployment flow, below is an explanation.</p><ol><li><p>User is editing the ARM template parameters file (1-time edit). These parameters values are being used throughout the deployment.</p></li><li><p>The ARM template includes an Azure VM custom script extension which will deploy the the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/azure/linux/arm_template/scripts/install_arc_agent.sh><em>install_arc_agent.sh</em></a> Shell script.</p></li><li><p>In order to allow the Azure VM to successfully be projected as an Azure Arc enabled server, the script will:</p><ol><li><p>Set local OS environment variables.</p></li><li><p>Generate a ~/.bash_profile file that will be initialized at user&rsquo;s first login to configure the environment. This script will:</p><ul><li><p>Stop and disable the &ldquo;Linux Azure Guest Agent&rdquo; service.</p></li><li><p>Create a new OS Firewall rule to block Azure IMDS outbound traffic to the <em>169.254.169.254</em> remote address.</p></li><li><p>Install the Azure Arc connected machine agent.</p></li><li><p>Remove the ~/.bash_profile file so it will not run after first login.</p></li></ul></li></ol></li><li><p>User SSH to Linux VM which will start the <em>~/.bash_profile</em> script execution and will onboard the VM to Azure Arc</p><blockquote><p><strong>Note: The <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/azure/linux/arm_template/scripts/install_arc_agent.sh><em>install_arc_agent.sh</em></a> shell script will enable the OS firewall and set up new rules for incoming and outgoing connections. By default all incoming and outgoing traffic will be allowed, except blocking Azure IMDS outbound traffic to the <em>169.254.169.254</em> remote address.</strong></p></blockquote></li></ol><h2 id=deployment>Deployment</h2><p>As mentioned, this deployment will leverage ARM templates. You will deploy a single template, responsible for creating all the Azure resources in a single resource group as well onboarding the created VM to Azure Arc.</p><ul><li><p>Before deploying the ARM template, login to Azure using AZ CLI with the <code>az login</code> command.</p></li><li><p>The deployment is using the ARM template parameters file. Before initiating the deployment, edit the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/azure/linux/arm_template/azuredeploy.parameters.json><em>azuredeploy.parameters.json</em></a> file located in your local cloned repository folder. An example parameters file is located <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/azure/linux/arm_template/azuredeploy.parameters.example.json>here</a>.</p></li><li><p>To deploy the ARM template, navigate to the local cloned <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/azure/linux/arm_template>deployment folder</a> and run the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az group create --name &lt;Name of the Azure resource group&gt; --location &lt;Azure region&gt; --tags <span style=color:#4e9a06>&#34;Project=jumpstart_azure_arc_servers&#34;</span>
az deployment group create <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--name &lt;The name of this deployment&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--template-uri https://raw.githubusercontent.com/microsoft/azure_arc/main/azure_arc_servers_jumpstart/azure/linux/arm_template/azuredeploy.json <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--parameters &lt;The *azuredeploy.parameters.json* parameters file location&gt;
</code></pre></div><blockquote><p><strong>Note: make sure that you are using the same Azure resource group name as the one you&rsquo;ve just used in the <em>azuredeploy.parameters.json</em> file</strong></p></blockquote><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az group create --name Arc-Servers-Linux-Demo --location <span style=color:#4e9a06>&#34;westeurope&#34;</span> --tags <span style=color:#4e9a06>&#34;Project=jumpstart_azure_arc_servers&#34;</span>
az deployment group create <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--resource-group Arc-Servers-Linux-Demo <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--name arclinuxdemo <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--template-uri https://raw.githubusercontent.com/microsoft/azure_arc/main/azure_arc_servers_jumpstart/azure/linux/arm_template/azuredeploy.json <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--parameters azuredeploy.parameters.json
</code></pre></div></li><li><p>Once Azure resources has been provisioned, you will be able to see it in Azure portal.</p><p><img src=./01.png alt="Screenshot output of ARM template"></p><p><img src=./02.png alt="Screenshot resources in resource group"></p></li></ul><h2 id=linux-login--post-deployment>Linux Login & Post Deployment</h2><ul><li><p>Now that the Linux VM is created, it is time to login to it. Using its public IP, SSH to the VM.</p><p><img src=./03.png alt="Screenshot Azure VM public IP address"></p></li><li><p>At first login, as mentioned in the &ldquo;Automation Flow&rdquo; section, a logon script will get executed. This script was created as part of the automated deployment process.</p></li><li><p>Let the script to run its course and <strong>do not close</strong> the SSH session, this will be done for you once completed.</p><p><img src=./04.png alt="Screenshot script output"></p><p><img src=./05.png alt="Screenshot script output"></p><p><img src=./06.png alt="Screenshot script output"></p></li><li><p>Upon successful run, a new Azure Arc enabled server will be added to the resource group.</p><p><img src=./07.png alt="Screenshot Azure Arc resource on the Azure portal"></p><p><img src=./08.png alt="Screenshot details of Azure Arc enabled server on Azure portal"></p></li></ul><h2 id=cleanup>Cleanup</h2><p>To delete the entire deployment, simply delete the resource group from the Azure portal.</p><p><img src=./09.png alt="Screenshot how to delete resource group"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-38881774a1c7c94d3b31a8907926b998>2.2 - Windows Server Virtual Machine</h1><h2 id=deploy-a-windows-azure-virtual-machine-and-connect-it-to-azure-arc-using-an-arm-template>Deploy a Windows Azure Virtual Machine and connect it to Azure Arc using an ARM Template</h2><p>The following README will guide you on how to automatically onboard a Azure Windows VM on to Azure Arc using <a href=https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/overview>Azure ARM Template</a>. The provided ARM template is responsible of creating the Azure resources as well as executing the Azure Arc onboard script on the VM.</p><p>Azure VMs are leveraging the <a href=https://docs.microsoft.com/en-us/azure/virtual-machines/windows/instance-metadata-service>Azure Instance Metadata Service (IMDS)</a> by default. By projecting an Azure VM as an Azure Arc enabled server, a &ldquo;conflict&rdquo; is created which will not allow for the Azure Arc server resources to be represented as one when the IMDS is being used and instead, the Azure Arc server will still &ldquo;act&rdquo; as a native Azure VM.</p><p>However, <strong>for demo purposes only</strong>, the below guide will allow you to use and onboard Azure VMs to Azure Arc and by doing so, you will be able to simulate a server which is deployed outside of Azure (i.e &ldquo;on-premises&rdquo; or in other cloud platforms)</p><blockquote><p><strong>Note: It is not expected for an Azure VM to be projected as an Azure Arc enabled server. The below scenario is unsupported and should ONLY be used for demo and testing purposes.</strong></p></blockquote><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p>In case you don&rsquo;t already have one, you can <a href=https://azure.microsoft.com/en-us/free/>Create a free Azure account</a>.</p></li><li><p>Create Azure service principal (SP)</p><p>In order for you to deploy the Azure resources using the ARM template, Azure service principal assigned with the &ldquo;contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional, but highly recommended, to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a>.</strong></p></blockquote></li></ul><h2 id=automation-flow>Automation Flow</h2><p>For you to get familiar with the automation and deployment flow, below is an explanation.</p><ol><li><p>User is editing the ARM template parameters file (one time edit). These parameters values are being used throughout the deployment.</p></li><li><p>The ARM template incl. an Azure VM custom script extension which will deploy the the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/azure/windows/arm_template/scripts/install_arc_agent.ps1><em>install_arc_agent.ps1</em></a> PowerShell script.</p></li><li><p>In order to allow the Azure VM to successfully be projected as an Azure Arc enabled server, the script will:</p><ol><li><p>Set local OS environment variables.</p></li><li><p>Generate a local OS logon script named <em>LogonScript.ps1</em>. This script will:</p><ul><li><p>Create the <em>LogonScript.log</em> file.</p></li><li><p>Stop and disable the &ldquo;Windows Azure Guest Agent&rdquo; service.</p></li><li><p>Create a new Windows Firewall rule to block Azure IMDS outbound traffic to the <em>169.254.169.254</em> remote address.</p></li><li><p>Unregister the logon script Windows schedule task so it will not run after first login.</p></li></ul></li><li><p>Disable and prevent Windows Server Manager from running on startup.</p></li></ol></li><li><p>User RDP to Windows VM which will start the <em>LogonScript</em> script execution and will onboard the VM to Azure Arc.</p></li></ol><h2 id=deployment>Deployment</h2><p>As mentioned, this deployment will leverage ARM templates. You will deploy a single template, responsible for creating all the Azure resources in a single resource group as well onboarding the created VM to Azure Arc.</p><ul><li><p>Before deploying the ARM template, login to Azure using Azure CLI with the <code>az login</code> command.</p></li><li><p>The deployment is using the ARM template parameters file. Before initiating the deployment, edit the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/azure/windows/arm_template/azuredeploy.parameters.json><em>azuredeploy.parameters.json</em></a> file located in your local cloned repository folder. An example parameters file is located <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/azure/windows/arm_template/azuredeploy.parameters.example.json>here</a>.</p></li><li><p>To deploy the ARM template, navigate to the local cloned <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/azure/windows/arm_template>deployment folder</a> and run the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az group create --name &lt;Name of the Azure resource group&gt; --location &lt;Azure Region&gt; --tags <span style=color:#4e9a06>&#34;Project=jumpstart_azure_arc_servers&#34;</span>
az deployment group create <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--name &lt;The name of this deployment&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--template-uri https://raw.githubusercontent.com/microsoft/azure_arc/main/azure_arc_servers_jumpstart/azure/windows/arm_template/azuredeploy.json <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--parameters &lt;The *azuredeploy.parameters.json* parameters file location&gt;
</code></pre></div><blockquote><p><strong>Note: Make sure that you are using the same Azure resource group name as the one you&rsquo;ve just used in the <em>azuredeploy.parameters.json</em> file</strong></p></blockquote><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az group create --name Arc-Servers-Win-Demo --location <span style=color:#4e9a06>&#34;East US&#34;</span> --tags <span style=color:#4e9a06>&#34;Project=jumpstart_azure_arc_servers&#34;</span>
az deployment group create <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--resource-group Arc-Servers-Win-Demo <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--name arcwinsrvdemo <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--template-uri https://raw.githubusercontent.com/microsoft/azure_arc/main/azure_arc_servers_jumpstart/azure/windows/arm_template/azuredeploy.json <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--parameters azuredeploy.parameters.json
</code></pre></div></li><li><p>Once Azure resources has been provisioned, you will be able to see it in Azure portal.</p><p><img src=./01.jpg alt="Screenshot ARM template output"></p><p><img src=./02.jpg alt="Screenshot resources in resource group"></p></li></ul><h2 id=windows-login--post-deployment>Windows Login & Post Deployment</h2><ul><li><p>Now that the Windows Server VM is created, it is time to login to it. Using its public IP, RDP to the VM.</p><p><img src=./03.jpg alt="Screenshot Azure VM public IP address"></p></li><li><p>At first login, as mentioned in the &ldquo;Automation Flow&rdquo; section, a logon script will get executed. This script was created as part of the automated deployment process.</p></li><li><p>Let the script to run its course and <strong>do not close</strong> the Powershell session, this will be done for you once completed.</p><blockquote><p><strong>Note: The script run time is ~1-2min long.</strong></p></blockquote><p><img src=./04.jpg alt="Screenshot script output"></p><p><img src=./05.jpg alt="Screenshot script output"></p><p><img src=./06.jpg alt="Screenshot script output"></p><p><img src=./07.jpg alt="Screenshot script output"></p></li><li><p>Upon successful run, a new Azure Arc enabled server will be added to the resource group.</p></li></ul><p><img src=./08.jpg alt="Screenshot Azure Arc enabled server on resource group"></p><p><img src=./09.jpg alt="Screenshot Azure Arc enabled server details"></p><h2 id=cleanup>Cleanup</h2><p>To delete the entire deployment, simply delete the resource group from the Azure portal.</p><p><img src=./10.jpg alt="Screenshot delete resource group"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-42ec827fb753e202548a5a81de66076c>3 - HashiCorp Vagrant</h1><div class=lead>If you don&rsquo;t have any existing servers available, the scenarios in this section will guide you on using HashiCorp Vagrant to host a new server locally in order to simulate an &ldquo;on-premises&rdquo; server and onboard it as an Azure Arc enabled server.</div></div><div class=td-content><h1 id=pg-6977b8e9fbf0de3c5e928d5025026e8c>3.1 - Ubuntu Vagrant box</h1><h2 id=deploy-a-local-ubuntu-server-hosted-with-vagrant-and-connect-it-azure-arc>Deploy a local Ubuntu server hosted with Vagrant and connect it Azure Arc</h2><p>The following README will guide you on how to deploy a local <strong>Ubuntu</strong> virtual machine using <a href=https://www.vagrantup.com/>Vagrant</a> and connect it as an Azure Arc enabled server resource.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p>Vagrant relies on an underlying hypervisor. For the purpose of this guide, we will be using &ldquo;Oracle VM VirtualBox&rdquo;.</p><ul><li><p>Install <a href=https://www.virtualbox.org/wiki/Downloads>VirtualBox</a>.</p><ul><li>If you are an OSX user, simply run <code>brew cask install virtualbox</code></li><li>If you are a Windows user, you can use the <a href=https://chocolatey.org/packages/virtualbox>Chocolatey package</a></li><li>If you are a Linux user, all package installation methods can be found <a href=https://www.virtualbox.org/wiki/Linux_Downloads>here</a></li></ul></li><li><p>Install <a href=https://www.vagrantup.com/docs/installation/>Vagrant</a></p><ul><li>If you are an OSX user, simply run <code>brew cask install vagrant</code></li><li>If you are a Windows user, you can use the <a href=https://chocolatey.org/packages/vagrant>Chocolatey package</a></li><li>If you are a Linux user, look <a href=https://www.vagrantup.com/downloads.html>here</a></li></ul></li></ul></li><li><p>Create Azure service principal (SP)</p><p>To connect the Vagrant virtual machine to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li><li><p>The Vagrantfile executes a script on the VM OS to install all the needed artifacts as well to inject environment variables. Edit the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/local/vagrant/ubuntu/scripts/vars.sh><em>scripts/vars.sh</em></a> shell script to match the Azure service principal you&rsquo;ve just created.</p><ul><li>subscriptionId=Your Azure subscription ID</li><li>appId=Your Azure service principal name</li><li>password=Your Azure service principal password</li><li>tenantId=Your Azure tenant ID</li><li>resourceGroup=Azure resource group name</li><li>location=Azure region</li></ul></li></ul><h2 id=deployment>Deployment</h2><p>Like any Vagrant deployment, a <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/local/vagrant/ubuntu/Vagrantfile><em>Vagrantfile</em></a> and a <a href=https://www.vagrantup.com/docs/boxes.html>Vagrant Box</a> is needed. At a high-level, the deployment will:</p><ol><li>Download the Ubuntu 16.04 image file <a href=https://app.vagrantup.com/ubuntu/boxes/xenial64>Vagrant Box</a></li><li>Execute the installation script</li></ol><p>After editing the <em><strong>scripts/vars.sh</strong></em> script to match your environment, from the <em>Vagrantfile</em> folder, run <code>vagrant up</code>. As this is the first time you are creating the VM, the first run will be <strong>much slower</strong> than the ones to follow. This is because the deployment is downloading the Ubuntu box for the first time.</p><p><img src=./01.png alt="Screenshot of vagrant up being run"></p><p>Once the download is complete, the actual provisioning will start. As you can see in the screenshot below, the process takes no longer than 3 minutes.</p><p><img src=./02.png alt="Screenshot of completed vagrant up"></p><p>Upon completion, you will have a local Ubuntu VM deployed, connected as a new Azure Arc enabled server inside a new resource group.</p><p><img src=./03.png alt="Screenshot of Azure portal showing Azure Arc enabled server"></p><p><img src=./04.png alt="Screenshot of Azure portal showing Azure Arc enabled server detail"></p><h2 id=semi-automated-deployment-optional>Semi-Automated Deployment (Optional)</h2><p>As you may noticed, the last step of the run is to register the VM as a new Azure Arc enabled server resource.</p><p><img src=./05.png alt="Screenshot of vagrant up being run"></p><p>In a case you want to demo/control the actual registration process, to the following:</p><ul><li><p>In the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/local/vagrant/ubuntu/scripts/install_arc_agent.sh><em>install_arc_agent</em></a> shell script, comment out the &ldquo;Run connect command&rdquo; section and save the file. You can also comment out or change the creation of the resource group.</p><p><img src=./06.png alt="Screenshot of the azcmagent connect command"></p><p><img src=./07.png alt="Screenshot of the az group create command"></p></li><li><p>SSH the VM using the <code>vagrant ssh</code> command.</p><p><img src=./08.png alt="Screenshot of of SSH to the Vagrant machine"></p></li><li><p>Run the same <em>azcmagent connect</em> command you&rsquo;ve just commented out using your environment variables.</p><p><img src=./09.png alt="Screenshot of the azcmagent connect"></p></li></ul><h2 id=delete-the-deployment>Delete the deployment</h2><p>To delete the entire deployment, run the <code>vagrant destroy -f</code> command. The Vagrantfile includes a <em>before: destroy</em> Vagrant trigger which will run a script to delete the Azure resource group before destroying the actual VM. That way, you will be starting fresh next time.</p><p><img src=./10.png alt="Screenshot of vagrant destroy being run"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-bc5683d9bbb43663a4b1455cd48f61ea>3.2 - Windows Vagrant box</h1><h2 id=deploy-a-local-windows-server-hosted-with-vagrant-and-connect-it-to-azure-arc>Deploy a local Windows server hosted with Vagrant and connect it to Azure Arc</h2><p>The following README will guide you on how to deploy a local <strong>Windows 10</strong> virtual machine using <a href=https://www.vagrantup.com/>Vagrant</a> and connect it as an Azure Arc enabled server resource.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p>Vagrant relies on an underlying hypervisor. For the purpose of this guide, we will be using &ldquo;Oracle VM VirtualBox&rdquo;.</p><ul><li><p>Install <a href=https://www.virtualbox.org/wiki/Downloads>VirtualBox</a>.</p><ul><li>If you are an OSX user, simply run <code>brew cask install virtualbox</code></li><li>If you are a Windows user, you can use the <a href=https://chocolatey.org/packages/virtualbox>Chocolatey package</a></li><li>If you are a Linux user, all package installation methods can be found <a href=https://www.virtualbox.org/wiki/Linux_Downloads>here</a></li></ul></li><li><p>Install <a href=https://www.vagrantup.com/docs/installation/>Vagrant</a></p><ul><li>If you are an OSX user, simply run <code>brew cask install vagrant</code></li><li>If you are a Windows user, you can use the <a href=https://chocolatey.org/packages/vagrant>Chocolatey package</a></li><li>If you are a Linux user, look <a href=https://www.vagrantup.com/downloads.html>here</a></li></ul></li></ul></li><li><p>Create Azure service principal (SP)</p><p>To connect the Vagrant virtual machine to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li><li><p>The Vagrantfile executes a script on the VM OS to install all the needed artifacts as well to inject environment variables. Edit the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/local/vagrant/windows/scripts/vars.ps1><em>scripts/vars.ps1</em></a> PowerShell script to match the Azure service principal you&rsquo;ve just created.</p><ul><li>subscriptionId=Your Azure subscription ID</li><li>appId=Your Azure service principal name</li><li>password=Your Azure service principal password</li><li>tenantId=Your Azure tenant ID</li><li>resourceGroup=Azure resource group name</li><li>location=Azure region</li></ul></li></ul><h2 id=deployment>Deployment</h2><p>Like any Vagrant deployment, a <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/local/vagrant/windows/Vagrantfile><em>Vagrantfile</em></a> and a <a href=https://www.vagrantup.com/docs/boxes.html>Vagrant Box</a> is needed. At a high-level, the deployment will:</p><ol><li>Download the Windows 10 image file <a href=https://app.vagrantup.com/StefanScherer/boxes/windows_10>Vagrant Box</a></li><li>Execute the Arc installation script</li></ol><p>After editing the <em><strong>scripts/vars.ps1</strong></em> script to match your environment, from the <em>Vagrantfile</em> folder, run <code>vagrant up</code>. As this is the first time you are creating the VM, the first run will be <strong>much slower</strong> than the ones to follow. This is because the deployment is downloading the Windows 10 box for the first time.</p><p><img src=./01.png alt="Screenshot of running vagrant up"></p><p>Once the download is complete, the actual provisioning will start. As you can see in the screenshot below, the process takes can take somewhere between 7 to 10 minutes.</p><p><img src=./02.png alt="Screenshot of completed vagrant up"></p><p>Upon completion, you will have a local Windows 10 VM deployed, connected as a new Azure Arc enabled server inside a new resource group.</p><p><img src=./03.png alt="Screenshot of the Azure portal showing Azure Arc enabled server"></p><p><img src=./04.png alt="Screenshot of the Azure portal showing Azure Arc enabled server detail"></p><h2 id=semi-automated-deployment-optional>Semi-Automated Deployment (Optional)</h2><p>As you may noticed, the last step of the run is to register the VM as a new Azure Arc enabled server resource.</p><p><img src=./05.png alt="Screenshot of vagrant up being completed"></p><p>In a case you want to demo/control the actual registration process, to the following:</p><ul><li><p>In the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/local/vagrant/windows/scripts/install_arc_agent.ps1><em>install_arc_agent</em></a> PowerShell script, comment out the &ldquo;Run connect command&rdquo; section and save the file. You can also comment out or change the creation of the resource group.</p><p><img src=./06.png alt="Screenshot of the install_arc_agent PowerShell script"></p><p><img src=./07.png alt="Screenshot of az group create being run"></p></li><li><p>RDP the VM using the <code>vagrant rdp</code> command. Use <em>vagrant/vagrant</em> as the username/password.</p><p><img src=./08.png alt="Screenshot of RDP into a Vagrant server"></p></li><li><p>Open PowerShell ISE <strong>as Administrator</strong> and edit the <em>C:\runtime\vars.ps1</em> with your environment variables.</p><p><img src=./09.png alt="Screenshot of PowerShell ISE"></p></li><li><p>Paste the <code>Invoke-Expression "C:\runtime\vars.ps1"</code> commmand, the <code>az group create --location $env:location --name $env:resourceGroup --subscription $env:subscriptionId</code> command and the same <em>azcmagent connect</em> command you&rsquo;ve just commented and execute the script.</p><p><img src=./10.png alt="Screenshot of PowerShell ISE running a script"></p></li></ul><h2 id=delete-the-deployment>Delete the deployment</h2><p>To delete the entire deployment, run the <code>vagrant destroy -f</code> command. The Vagrantfile includes a <em>before: destroy</em> Vagrant trigger which will run the command to delete the Azure resource group before destroying the actual VM. That way, you will be starting fresh next time.</p><p><img src=./11.png alt="Screenshot of vagrant destroy being run"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-9a3473e6423ee4c24673e9cd153d9658>4 - Amazon Web Services</h1><div class=lead>If you are working in a multi-cloud environment, you can deploy new AWS EC2 instances in an automated fashion using Terraform and onboard it as Azure Arc enabled servers.</div></div><div class=td-content><h1 id=pg-fc1f094c01d528ff3519c6ccebdccfff>4.1 - Ubuntu EC2 instance</h1><h2 id=deploy-an-aws-ubuntu-ec2-instance-and-connect-it-to-azure-arc-using-a-terraform-plan>Deploy an AWS Ubuntu EC2 instance and connect it to Azure Arc using a Terraform plan</h2><p>The following README will guide you on how to use the provided <a href=https://www.terraform.io/>Terraform</a> plan to deploy an AWS EC2 virtual machine and connect it as an Azure Arc enabled server resource.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p><a href=https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/>Generate SSH Key</a> (or use existing ssh key)</p></li><li><p><a href=https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/>Create free AWS account</a></p></li><li><p><a href=https://learn.hashicorp.com/terraform/getting-started/install.html>Install Terraform >=0.12</a></p></li><li><p>Create Azure service principal (SP)</p><p>To connect the AWS virtual machine to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcAWS&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcAWS&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcAWS&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li></ul><h2 id=create-an-aws-identity>Create an AWS identity</h2><p>In order for Terraform to create resources in AWS, we will need to create a new AWS IAM role with appropriate permissions and configure Terraform to use it.</p><ul><li><p>Login to the <a href=https://console.aws.amazon.com>AWS management console</a></p></li><li><p>After logging in, click the &ldquo;Services&rdquo; dropdown in the top left. Under &ldquo;Security, Identity, and Compliance&rdquo; select &ldquo;IAM&rdquo; to access the <a href=https://console.aws.amazon.com/iam/home>Identity and Access Management page</a></p><p><img src=./01.png alt="Screenshot of AWS cloud console"></p><p><img src=./02.png alt="Screenshot of IAM AWS cloud console"></p></li><li><p>Click on &ldquo;Users&rdquo; from the left menu and then click on &ldquo;Add user&rdquo; to create a new IAM user.</p><p><img src=./03.png alt="Screenshot of new user creation in AWS cloud console"></p></li><li><p>On the &ldquo;Add User&rdquo; screen, name the user &ldquo;terraform&rdquo; and select the &ldquo;Programmatic Access&rdquo; checkbox then click &ldquo;Next&rdquo;</p><p><img src=./04.png alt="Screenshot of new user creation in AWS cloud console"></p></li><li><p>On the next &ldquo;Set Permissions&rdquo; screen, select &ldquo;Attach existing policies directly&rdquo; and then check the box next to AmazonEC2FullAccess as seen in the screenshot then click &ldquo;Next&rdquo;</p><p><img src=./05.png alt="Screenshot showing new user in AWS cloud console"></p></li><li><p>On the tags screen, assign a tag with a key of &ldquo;azure-arc-demo&rdquo; and click &ldquo;Next&rdquo; to proceed to the Review screen.</p><p><img src=./06.png alt="Screenshot showing tags in AWS cloud console"></p></li><li><p>Double check that everything looks correct and click &ldquo;Create user&rdquo; when ready.</p><p><img src=./07.png alt="Screenshot showing creating a user in AWS cloud console"></p></li><li><p>After the user is created, you will see the user&rsquo;s Access key ID and Secret access key. Copy these values down before clicking the Close button. In the screen below, you can see an example of what this should look like. Once you have these keys, you will be able to use them with Terraform to create AWS resources.</p><p><img src=./08.png alt="Screenshot showing created user in AWS cloud console"></p></li></ul><h2 id=configure-terraform>Configure Terraform</h2><p>Before executing the Terraform plan, you must export the environment variables which will be used by the plan. These variables are based on your Azure subscription and tenant, the Azure service principal, and the AWS IAM user and keys you just created.</p><ul><li><p>Retrieve your Azure subscription ID and tenant ID using the <code>az account list</code> command.</p></li><li><p>The Terraform plan creates resources in both Microsoft Azure and AWS. It then executes a script on an AWS EC2 virtual machine to install the Azure Arc agent and all necessary artifacts. This script requires certain information about your AWS and Azure environments. Edit <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/ubuntu/terraform/scripts/vars.sh><em>scripts/vars.sh</em></a> and update each of the variables with the appropriate values.</p><ul><li>TF_VAR_subscription_id=Your Azure subscription ID</li><li>TF_VAR_client_id=Your Azure service principal app id</li><li>TF_VAR_client_secret=Your Azure service principal password</li><li>TF_VAR_tenant_id=Your Azure tenant ID</li><li>AWS_ACCESS_KEY_ID=AWS access key</li><li>AWS_SECRET_ACCESS_KEY=AWS secret key</li></ul></li><li><p>From CLI, navigate to the &ldquo;azure_arc_servers_jumpstart/aws/ubuntu/terraform&rdquo; directory of the cloned repo.</p></li><li><p>Export the environment variables you edited by running <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/ubuntu/terraform/scripts/vars.sh><em>scripts/vars.sh</em></a> with the source command as shown below. Terraform requires these to be set for the plan to execute properly. Note that this script will also be automatically executed remotely on the AWS virtual machine as part of the Terraform deployment.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#204a87>source</span> ./scripts/vars.sh
</code></pre></div></li><li><p>Make sure your SSH keys are available in <em>~/.ssh</em> and named <em>id_rsa.pub</em> and <em>id_rsa</em>. If you followed the ssh-keygen guide above to create your key then this should already be setup correctly. If not, you may need to modify <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/ubuntu/terraform/main.tf><em>main.tf</em></a> to use a key with a different path.</p></li><li><p>Run the <code>terraform init</code> command which will download the Terraform AzureRM provider.</p><p><img src=./09.png alt="Screenshot of terraform init being run"></p></li></ul><h2 id=deployment>Deployment</h2><ul><li><p>Run the <code>terraform apply --auto-approve</code> command and wait for the plan to finish. Upon completion, you will have an AWS Amazon Linux 2 EC2 instance deployed and connected as a new Azure Arc enabled server inside a new resource group.</p></li><li><p>Open the Azure portal and navigate to the resource group &ldquo;Arc-AWS-Demo&rdquo;. The virtual machine created in AWS will be visible as a resource.</p><p><img src=./10.png alt="Screenshot of Azure portal showing Azure Arc enabled server"></p><p><img src=./19.png alt="Screenshot of AWS cloud console showing EC2 instance"></p></li></ul><h2 id=semi-automated-deployment-optional>Semi-Automated Deployment (Optional)</h2><p>As you may have noticed, the last step of the run is to register the VM as a new Azure Arc enabled server resource.
<img src=./11.png alt="Screenshot showing azcmagent connect script"></p><p>If you want to demo/control the actual registration process, do the following:</p><ul><li><p>In the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/ubuntu/terraform/scripts/install_arc_agent.sh.tmpl><em>install_arc_agent.sh.tmpl</em></a> script template, comment out the &ldquo;Run connect command&rdquo; section and save the file.</p><p><img src=./12.png alt="Screenshot showing azcmagent connect script commented out"></p></li><li><p>Get the public IP of the AWS VM by running <code>terraform output</code></p><p><img src=./13.png alt="Screenshot of terraform output being run"></p></li><li><p>SSH the VM using the <code>ssh ubuntu@x.x.x.x</code> where x.x.x.x is the host ip.</p><p><img src=./14.png alt="Screenshot of SSH into EC2 server"></p></li><li><p>Export all the environment variables in <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/ubuntu/terraform/scripts/vars.sh><em>vars.sh</em></a></p><p><img src=./15.png alt="Screenshot showing export of environment variables in var.sh"></p></li><li><p>Run the following command</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>azcmagent connect --service-principal-id <span style=color:#000>$TF_VAR_client_id</span> --service-principal-secret <span style=color:#000>$TF_VAR_client_secret</span> --resource-group <span style=color:#4e9a06>&#34;Arc-AWS-Demo&#34;</span> --tenant-id <span style=color:#000>$TF_VAR_tenant_id</span> --location <span style=color:#4e9a06>&#34;westus2&#34;</span> --subscription-id <span style=color:#000>$TF_VAR_subscription_id</span>
</code></pre></div><p><img src=./16.png alt="Screenshot of azcmagent connect being run"></p></li><li><p>When complete, your VM will be registered with Azure Arc and visible in the resource group inside Azure Portal.</p></li></ul><h2 id=delete-the-deployment>Delete the deployment</h2><p>To delete all the resources you created as part of this demo use the <code>terraform destroy --auto-approve</code> command as shown below.
<img src=./17.png alt="Screenshot showing terraform destroy being run"></p><p>Alternatively, you can delete the AWS EC2 instance directly by terminating it from the <a href=https://console.aws.amazon.com/ec2/v2/home>AWS Console</a>. Note that it will take a few minutes for the instance to actually be removed.
<img src=./18.png alt="Screenshot of AWS cloud console showing terminating instance"></p><p>If you delete the instance manually, then you should also delete <em>./scripts/install_arc_agent.sh</em> which is created by the Terraform plan.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-95541056e5a6754e9f9e64a085445d0f>4.2 - Amazon Linux 2 EC2 instance</h1><h2 id=deploy-an-aws-amazon-linux-2-ec2-instance-and-connect-it-to-azure-arc-using-a-terraform-plan>Deploy an AWS Amazon Linux 2 EC2 instance and connect it to Azure Arc using a Terraform plan</h2><p>The following README will guide you on how to use the provided <a href=https://www.terraform.io/>Terraform</a> plan to deploy an AWS Amazon Linux 2 EC2 instance and connect it as an Azure Arc enabled server resource.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p><a href=https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/>Generate SSH Key</a> (or use existing ssh key)</p></li><li><p><a href=https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/>Create free AWS account</a></p></li><li><p><a href=https://learn.hashicorp.com/terraform/getting-started/install.html>Install Terraform >=0.12</a></p></li><li><p>Create Azure service principal (SP)</p><p>To connect the AWS virtual machine to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the following commands:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcAWS&#34;</span> --role contributor
</code></pre></div><p>Output should look similar to this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcAWS&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcAWS&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li></ul><h2 id=create-an-aws-identity>Create an AWS identity</h2><p>In order for Terraform to create resources in AWS, we will need to create a new AWS IAM role with appropriate permissions and configure Terraform to use it.</p><ul><li><p>Login to the <a href=https://console.aws.amazon.com>AWS management console</a></p></li><li><p>After logging in, click the &ldquo;Services&rdquo; dropdown in the top left. Under &ldquo;Security, Identity, and Compliance&rdquo; select &ldquo;IAM&rdquo; to access the <a href=https://console.aws.amazon.com/iam/home>Identity and Access Management page</a></p><p><img src=./01.png alt="Screenshot of AWS cloud console"></p><p><img src=./02.png alt="Screenshot of IAM AWS cloud console"></p></li><li><p>Click on &ldquo;Users&rdquo; from the left menu and then click on &ldquo;Add user&rdquo; to create a new IAM user.</p><p><img src=./03.png alt="Screenshot of new user creation in AWS cloud console"></p></li><li><p>On the &ldquo;Add User&rdquo; screen, name the user &ldquo;terraform&rdquo; and select the &ldquo;Programmatic Access&rdquo; checkbox then click &ldquo;Next&rdquo;</p><p><img src=./04.png alt="Screenshot of new user creation in AWS cloud console"></p></li><li><p>On the next &ldquo;Set Permissions&rdquo; screen, select &ldquo;Attach existing policies directly&rdquo; and then check the box next to AmazonEC2FullAccess as seen in the screenshot then click &ldquo;Next&rdquo;</p><p><img src=./05.png alt="Screenshot showing new user in AWS cloud console"></p></li><li><p>On the tags screen, assign a tag with a key of &ldquo;azure-arc-demo&rdquo; and click &ldquo;Next&rdquo; to proceed to the Review screen.</p><p><img src=./06.png alt="Screenshot showing tags in AWS cloud console"></p></li><li><p>Double check that everything looks correct and click &ldquo;Create user&rdquo; when ready.</p><p><img src=./07.png alt="Screenshot showing creating a user in AWS cloud console"></p></li><li><p>After the user is created, you will see the user&rsquo;s Access key ID and Secret access key. Copy these values down before clicking the Close button. In the screen below, you can see an example of what this should look like. Once you have these keys, you will be able to use them with Terraform to create AWS resources.</p><p><img src=./08.png alt="Screenshot showing created user in AWS cloud console"></p></li></ul><h2 id=configure-terraform>Configure Terraform</h2><p>Before executing the Terraform plan, you must export the environment variables which will be used by the plan. These variables are based on your Azure subscription and tenant, the Azure service principal, and the AWS IAM user and keys you just created.</p><ul><li><p>Retrieve your Azure subscription ID and tenant ID using the <code>az account list</code> command.</p></li><li><p>The Terraform plan creates resources in both Microsoft Azure and AWS. It then executes a script on an AWS EC2 virtual machine to install the Azure Arc agent and all necessary artifacts. This script requires certain information about your AWS and Azure environments. Edit <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/AL2/terraform/scripts/vars.sh><em>scripts/vars.sh</em></a> and update each of the variables with the appropriate values.</p><ul><li>TF_VAR_subscription_id=Your Azure subscription ID</li><li>TF_VAR_client_id=Your Azure service principal app id</li><li>TF_VAR_client_secret=Your Azure service principal password</li><li>TF_VAR_tenant_id=Your Azure tenant ID</li><li>AWS_ACCESS_KEY_ID=AWS access key</li><li>AWS_SECRET_ACCESS_KEY=AWS secret key</li></ul></li><li><p>From CLI, navigate to the <em>azure_arc_servers_jumpstart/aws/al2/terraform</em> directory of the cloned repo.</p></li><li><p>Export the environment variables you edited by running <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/AL2/terraform/scripts/vars.sh><em>scripts/vars.sh</em></a> with the source command as shown below. Terraform requires these to be set for the plan to execute properly. Note that this script will also be automatically executed remotely on the AWS virtual machine as part of the Terraform deployment.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#204a87>source</span> ./scripts/vars.sh
</code></pre></div></li><li><p>Make sure your SSH keys are available in <em>~/.ssh</em> and named <em>id_rsa.pub</em> and <em>id_rsa</em>. If you followed the ssh-keygen guide above to create your key then this should already be setup correctly. If not, you may need to modify <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/AL2/terraform/main.tf><em>main.tf</em></a> to use a key with a different path.</p></li><li><p>Run the <code>terraform init</code> command which will download the Terraform AzureRM provider.</p><p><img src=./09.png alt="Screenshot showing terraform init being run"></p></li></ul><h2 id=deployment>Deployment</h2><ul><li><p>Run the <code>terraform apply --auto-approve</code> command and wait for the plan to finish. Upon completion, you will have an AWS Amazon Linux 2 EC2 instance deployed and connected as a new Azure Arc enabled server inside a new resource group.</p></li><li><p>Open the Azure portal and navigate to the resource group &ldquo;Arc-Servers-Demo&rdquo;. The virtual machine created in AWS will be visible as a resource.</p><p><img src=./10.png alt="Screenshot showing Azure Portal and Azure Arc enabled server"></p></li></ul><h2 id=semi-automated-deployment-optional>Semi-Automated Deployment (Optional)</h2><p>As you may have noticed, the last step of the run is to register the VM as a new Azure Arc enabled server resource.
<img src=./11.png alt="Screenshot showing azcmagent connect script"></p><p>If you want to demo/control the actual registration process, do the following:</p><ul><li><p>In the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/AL2/terraform/scripts/install_arc_agent.sh.tmpl><em>install_arc_agent.sh.tmpl</em></a> script template, comment out the &ldquo;Run connect command&rdquo; section and save the file.</p><p><img src=./12.png alt="Screenshot showing azcmagent connect script commented out"></p></li><li><p>Get the public IP of the AWS VM by running <code>terraform output</code></p><p><img src=./13.png alt="Screenshot showing terraform output"></p></li><li><p>SSH the VM using the <code>ssh ec2-user@x.x.x.x</code> where x.x.x.x is the host ip.</p><p><img src=./14.png alt="Screenshot showing SSH into EC2 server"></p></li><li><p>Export all the environment variables in <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/AL2/terraform/scripts/vars.sh><em>vars.sh</em></a></p><p><img src=./15.png alt="Screenshot showing export of environment variables in vars.sh"></p></li><li><p>Run the following command</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>azcmagent connect --service-principal-id <span style=color:#000>$TF_VAR_client_id</span> --service-principal-secret <span style=color:#000>$TF_VAR_client_secret</span> --resource-group <span style=color:#4e9a06>&#34;Arc-Servers-Demo&#34;</span> --tenant-id <span style=color:#000>$TF_VAR_tenant_id</span> --location <span style=color:#4e9a06>&#34;westus2&#34;</span> --subscription-id <span style=color:#000>$TF_VAR_subscription_id</span>
</code></pre></div><p><img src=./16.png alt="Screenshot showing azcmagent connect being run"></p></li><li><p>When complete, your VM will be registered with Azure Arc and visible in the resource group inside Azure Portal.</p></li></ul><h2 id=delete-the-deployment>Delete the deployment</h2><p>To delete all the resources you created as part of this demo use the <code>terraform destroy --auto-approve</code> command as shown below.
<img src=./17.png alt="Screenshot showing terraform destroy being run"></p><p>Alternatively, you can delete the AWS EC2 instance directly by terminating it from the <a href=https://console.aws.amazon.com/ec2/v2/home>AWS Console</a>.
<img src=./18.png alt="Screenshot showing AWS Console with terminating instance"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-7064577bc1b93c68f79cd424bda7f426>5 - Google Cloud Platform</h1><div class=lead>If you are working in a multi-cloud environment, you can deploy new GCP instances in an automated fashion using Terraform and onboard it as Azure Arc enabled servers.</div></div><div class=td-content><h1 id=pg-d042d13faf89faf82810b281cfa42258>5.1 - Ubuntu GCP instance</h1><h2 id=deploy-a-gcp-ubuntu-instance-and-connect-it-to-azure-arc-using-a-terraform-plan>Deploy a GCP Ubuntu instance and connect it to Azure Arc using a Terraform plan</h2><p>The following README will guide you on how to use the provided <a href=https://www.terraform.io/>Terraform</a> plan to deploy an Ubuntu Server GCP virtual machine and connect it as an Azure Arc enabled server resource.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p><a href=https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/>Generate SSH Key</a> (or use existing ssh key)</p></li><li><p><a href=(https://cloud.google.com/free)>Create free Google Cloud account</a></p></li><li><p><a href=https://learn.hashicorp.com/terraform/getting-started/install.html>Install Terraform >=0.12</a></p></li><li><p>Create Azure service principal (SP)</p><p>To connect the GCP virtual machine to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcGCP&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcGCP&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcGCP&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li></ul><h2 id=create-a-new-gcp-project>Create a new GCP Project</h2><ul><li><p>Browse to <a href=https://console.developers.google.com>https://console.developers.google.com</a> and login with your Google Cloud account. Once logged in, <a href=https://cloud.google.com/resource-manager/docs/creating-managing-projects>create a new project</a> named &ldquo;Azure Arc Demo&rdquo;. After creating it, be sure to copy down the project id as it is usually different then the project name.</p><p><img src=./01.png alt="Screenshot of GCP Cloud console create project screen"></p><p><img src=./02.png alt="Screenshot of GCP cloud new project screen"></p></li><li><p>Once the new project is created and selected in the dropdown at the top of the page, you must enable Compute Engine API access for the project. Click on &ldquo;+Enable APIs and Services&rdquo; and search for &ldquo;Compute Engine&rdquo;. Then click Enable to enable API access.</p><p><img src=./03.png alt="Screenshot of GCP console showing enabling Compute Engine API"></p><p><img src=./04.png alt="Screenshot of GCP console showing enabling Compute Engine API"></p></li><li><p>Next, set up a service account key, which Terraform will use to create and manage resources in your GCP project. Go to the <a href=https://console.cloud.google.com/apis/credentials/serviceaccountkey>create service account key page</a>. Select &ldquo;New Service Account&rdquo; from the dropdown, give it a name, select Project then Owner as the role, JSON as the key type, and click Create. This downloads a JSON file with all the credentials that will be needed for Terraform to manage the resources. Copy the downloaded JSON file to the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/gcp/ubuntu/terraform><em>azure_arc_servers_jumpstart/gcp/ubuntu/terraform</em></a> directory.</p><p><img src=./05.png alt="Screenshot of GCP cloud console showing creation of service account"></p></li><li><p>Finally, make sure your SSH keys are available in <em>~/.ssh</em> and named <em>id_rsa.pub</em> and <em>id_rsa</em>. If you followed the ssh-keygen guide above to create your key then this should already be setup correctly. If not, you may need to modify <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/gcp/ubuntu/terraform/main.tf><em>main.tf</em></a> to use a key with a different path.</p></li></ul><h2 id=deployment>Deployment</h2><p>Before executing the Terraform plan, you must export the environment variables which will be used by the plan. These variables are based on the Azure service principal you&rsquo;ve just created, your Azure subscription and tenant, and the GCP project name.</p><ul><li><p>Retrieve your Azure subscription ID and tenant ID using the <code>az account list</code> command.</p></li><li><p>The Terraform plan creates resources in both Microsoft Azure and Google Cloud. It then executes a script on a Google Cloud virtual machine to install the Azure Arc agent and all necessary artifacts. This script requires certain information about your Google Cloud and Azure environments. Edit <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/gcp/ubuntu/terraform/scripts/vars.sh><em>scripts/vars.sh</em></a> and update each of the variables with the appropriate values.</p><ul><li>TF_VAR_subscription_id=Your Azure subscription ID</li><li>TF_VAR_client_id=Your Azure service principal app id</li><li>TF_VAR_client_secret=Your Azure service principal password</li><li>TF_VAR_tenant_id=Your Azure tenant ID</li><li>TF_VAR_gcp_project_id=GCP project id</li><li>TF_VAR_gcp_credentials_filename=GCP credentials json filename</li></ul></li><li><p>From CLI, navigate to the <em>azure_arc_servers_jumpstart/gcp/ubuntu/terraform</em> directory of the cloned repo.</p></li><li><p>Export the environment variables you edited by running <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/gcp/ubuntu/terraform/scripts/vars.sh><em>scripts/vars.sh</em></a> with the source command as shown below. Terraform requires these to be set for the plan to execute properly. Note that this script will also be automatically executed remotely on the GCP virtual machine as part of the Terraform deployment.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#204a87>source</span> ./scripts/vars.sh
</code></pre></div></li><li><p>Run the <code>terraform init</code> command which will download the Terraform AzureRM provider.</p><p><img src=./08.png alt="Screenshot showing terraform init being run"></p></li><li><p>Next, run the <code>terraform apply --auto-approve</code> command and wait for the plan to finish. Upon completion, you will have a GCP Ubuntu VM deployed and connected as a new Azure Arc enabled server inside a new resource group.</p></li><li><p>Open the Azure portal and navigate to the resource group &ldquo;Arc-GCP-Demo&rdquo;. The virtual machine created in GCP will be visible as a resource.</p><p><img src=./18.png alt="Screenshot of Azure Portal showing Azure Arc enabled server"></p></li></ul><h2 id=semi-automated-deployment-optional>Semi-Automated Deployment (Optional)</h2><p>As you may have noticed, the last step of the run is to register the VM as a new Azure Arc enabled server resource.
<img src=./10.png alt="Screenshot showing azcmagent connect script"></p><p>If you want to demo/control the actual registration process, do the following:</p><ul><li><p>In the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/gcp/ubuntu/terraform/scripts/install_arc_agent.sh.tmpl><em>install_arc_agent.sh.tmpl</em></a> script template, comment out the &ldquo;Run connect command&rdquo; section and save the file.</p><p><img src=./11.png alt="Screenshot showing azcmagent connect commented out"></p></li><li><p>Get the public IP of the GCP VM by running <code>terraform output</code></p><p><img src=./12.png alt="Screenshot showing terraform output"></p></li><li><p>SSH the VM using the <code>ssh arcadmin@x.x.x.x</code> where x.x.x.x is the host ip.</p><p><img src=./13.png alt="Screenshot showing SSH into GCP server"></p></li><li><p>Export all the environment variables in <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/gcp/ubuntu/terraform/scripts/vars.sh><em>vars.sh</em></a></p><p><img src=./14.png alt="Screenshot showing export of environment variables from vars.sh"></p></li><li><p>Run the following command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>azcmagent connect --service-principal-id <span style=color:#000>$TF_VAR_client_id</span> --service-principal-secret <span style=color:#000>$TF_VAR_client_secret</span> --resource-group <span style=color:#4e9a06>&#34;Arc-GCP-Demo&#34;</span> --tenant-id <span style=color:#000>$TF_VAR_tenant_id</span> --location <span style=color:#4e9a06>&#34;westus2&#34;</span> --subscription-id <span style=color:#000>$TF_VAR_subscription_id</span>
</code></pre></div><p><img src=./15.png alt="Screenshot of azcmagent connect being run"></p></li><li><p>When complete, your VM will be registered with Azure Arc and visible in the resource group inside Azure Portal.</p></li></ul><h2 id=delete-the-deployment>Delete the deployment</h2><p>To delete all the resources you created as part of this demo use the <code>terraform destroy --auto-approve</code> command as shown below.</p><p><img src=./17.png alt="Screenshot of terraform destroy being run"></p><p>Alternatively, you can delete the GCP VM directly from <a href=https://console.cloud.google.com/compute/instances>GCP Console</a>.</p><p><img src=./16.png alt="Screenshot of deleting VM from GCP cloud console"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-a692f8c5cd59332abe3227bb76485698>5.2 - Windows GCP instance</h1><h2 id=deploy-a-gcp-windows-instance-and-connect-it-to-azure-arc-using-a-terraform-plan>Deploy a GCP Windows instance and connect it to Azure Arc using a Terraform plan</h2><p>The following README will guide you on how to use the provided <a href=https://www.terraform.io/>Terraform</a> plan to deploy a Windows Server GCP virtual machine and connect it as an Azure Arc enabled server resource.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p><a href=https://learn.hashicorp.com/terraform/getting-started/install.html>Install Terraform >=0.12</a></p></li><li><p>Google Cloud account with billing enabled - <a href=https://cloud.google.com/free>Create a free trial account</a>. To create Windows Server virtual machines, you must upgraded your account to enable billing. Click Billing from the menu and then select Upgrade in the lower right.</p><p><img src=./29.png alt="Screenshot showing how to enable billing on GCP account"></p><p><img src=./30.png alt="Screenshot showing how to enable billing on GCP account"></p><p><img src=./32.png alt="Screenshot showing how to enable billing on GCP account"></p><p><em><strong>Disclaimer</strong></em> - <strong>To prevent unexpected charges, please follow the &ldquo;Delete the deployment&rdquo; section at the end of this README</strong></p></li><li><p>Create Azure service principal (SP)</p><p>To connect the GCP virtual machine to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcGCP&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcGCP&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcGCP&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li></ul><h2 id=create-a-new-gcp-project>Create a new GCP Project</h2><ul><li><p>Browse to <a href=https://console.cloud.google.com>https://console.cloud.google.com</a> and login with your Google Cloud account. Once logged in, <a href=https://cloud.google.com/resource-manager/docs/creating-managing-projects>create a new project</a> named &ldquo;Azure Arc Demo&rdquo;. After creating it, be sure to copy down the project id as it is usually different then the project name.</p><p><img src=./01.png alt="Screenshot of GCP Cloud console create project screen"></p><p><img src=./02.png alt="Screenshot of GCP cloud new project screen"></p></li><li><p>Once the new project is created and selected in the dropdown at the top of the page, you must enable Compute Engine API access for the project. Click on &ldquo;+Enable APIs and Services&rdquo; and search for &ldquo;Compute Engine&rdquo;. Then click Enable to enable API access.</p><p><img src=./03.png alt="Screenshot of GCP console showing enabling Compute Engine API"></p><p><img src=./04.png alt="Screenshot of GCP console showing enabling Compute Engine API"></p></li><li><p>Next, set up a service account key, which Terraform will use to create and manage resources in your GCP project. Go to the <a href=https://console.cloud.google.com/apis/credentials/serviceaccountkey>create service account key page</a>. Select &ldquo;New Service Account&rdquo; from the dropdown, give it a name, select Project then Owner as the role, JSON as the key type, and click Create. This downloads a JSON file with all the credentials that will be needed for Terraform to manage the resources. Copy the downloaded JSON file to the <em>azure_arc_servers_jumpstart/gcp/windows/terraform</em> directory.</p><p><img src=./05.png alt="Screenshot of GCP cloud console showing creation of service account"></p></li></ul><h2 id=deployment>Deployment</h2><p>Before executing the Terraform plan, you must set and then export the environment variables which will be used by the plan. These variables are based on the Azure service principal you&rsquo;ve just created, your Azure subscription and tenant, and the GCP project name.</p><ul><li><p>Retrieve your Azure subscription ID and tenant ID using the <code>az account list</code> command.</p></li><li><p>The Terraform plan creates resources in both Microsoft Azure and Google Cloud. It then executes a script on a Google Cloud virtual machine to install the Azure Arc agent and all necessary artifacts. This script requires certain information about your Google Cloud and Azure environments. Edit <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/gcp/windows/terraform/scripts/vars.sh><em>scripts/vars.sh</em></a> and update each of the variables with the appropriate values.</p><ul><li>TF_VAR_subscription_id=Your Azure subscription ID</li><li>TF_VAR_client_id=Your Azure service principal app id</li><li>TF_VAR_client_secret=Your Azure service principal password</li><li>TF_VAR_tenant_id=Your Azure tenant ID</li><li>TF_VAR_gcp_project_id=GCP project id</li><li>TF_VAR_gcp_credentials_filename=GCP credentials json filename</li></ul></li><li><p>From CLI, navigate to the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/gcp/windows/terraform><em>azure_arc_servers_jumpstart/gcp/windows/terraform</em></a> directory of the cloned repo.</p></li><li><p>Export the environment variables you edited by running <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/gcp/windows/terraform/scripts/vars.sh><em>scripts/vars.sh</em></a> with the source command as shown below. Terraform requires these to be set for the plan to execute properly.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#204a87>source</span> ./scripts/vars.sh
</code></pre></div></li><li><p>Run the <code>terraform init</code> command which will download the Terraform AzureRM provider.</p><p><img src=./08.png alt="Screenshot showing terraform init being run"></p></li><li><p>Next, run the <code>terraform apply --auto-approve</code> command and wait for the plan to finish. Upon completion of the Terraform script, you will have deployed a GCP Windows Server 2019 VM and initiated a script to download the Azure Arc agent to the VM and connect the VM as a new Azure Arc enabled server inside a new Azure resource group. It will take a few minutes for the agent to finish provisioning so grab a coffee.</p><p><img src=./09.png alt="Screenshot of terraform apply being run"></p></li><li><p>After a few minutes, you should be able to open the Azure portal and navigate to the resource group &ldquo;Arc-GCP-Demo&rdquo;. The Windows Server virtual machine created in GCP will be visible as a resource.</p><p><img src=./33.png alt="Screenshot of Azure Portal showing Azure Arc enabled server"></p></li></ul><h2 id=semi-automated-deployment-optional>Semi-Automated Deployment (Optional)</h2><p>The Terraform plan automatically installs the Azure Arc agent and connects the VM to Azure as a managed resource by executing a PowerShell script when the VM is first booted.
<img src=./12.png alt="Screenshot showing azcmagent connect script"></p><p>If you want to demo/control the actual registration process, do the following:</p><ul><li><p>Before running the <code>terraform apply</code> command, open <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/gcp/windows/terraform/main.tf><em>main.tf</em></a> and comment out the <code>windows-startup-script-ps1 = local_file.install_arc_agent_ps1.content</code> line and save the file.</p><p><img src=./13.png alt="Screenshot showing main.tf being commented to disable automatic onboarding of Azure Arc agent"></p></li><li><p>Run <code>terraform apply --auto-approve</code> as instructed above.</p></li><li><p>Open the Google Cloud console and navigate to the <a href=https://console.cloud.google.com/compute/instances>Compute Instance page</a>, then click on the VM that was created.</p><p><img src=./14.png alt="Screenshot showing GCP cloud console with GCP server"></p><p><img src=./15.png alt="Screenshot showing how to reset password of GCP Windows server"></p></li><li><p>Create a user and password for the VM by clicking &ldquo;Set Password&rdquo; and specifying a username.</p><p><img src=./17.png alt="Screenshot showing setting username and password of GCP server"></p></li><li><p>RDP into the VM by clicking the RDP button from the VM page in Google Cloud console, and login with the username and password you just created.</p><p><img src=./18.png alt="Screenshot showing how to RDP into GCP instance"></p></li><li><p>Once logged in, open PowerShell ISE <strong>as Administrator</strong>. Make sure you are running the x64 version of PowerShell ISE and not x86. Once open, select File->New to create an empty .ps1 file. Then paste in the entire contents of <em>./scripts/install_arc_agent.ps1]</em>. Click the play button to execute the script. When complete, you should see the output showing successful onboarding of the machine.</p><p><img src=./19.png alt="Screenshot showing Powershell ISE with Azure Arc agent connection script"></p></li></ul><h2 id=delete-the-deployment>Delete the deployment</h2><p>To delete all the resources you created as part of this demo use the <code>terraform destroy --auto-approve</code> command as shown below.
<img src=./11.png alt="Screenshot showing terraform destroy being run"></p><p>Alternatively, you can delete the GCP VM directly from <a href=https://console.cloud.google.com/compute/instances>GCP Console</a>.
<img src=./16.png alt="Screenshot showing how to delete GCP VM from cloud console"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-5b91b658f8abbc63f40d299548f9cb0e>6 - VMware vSphere</h1><div class=lead>If you are working with an on-premises VMware vSphere infrastructure, you can deploy new Windows or Linux virtual machines in an automated fashion using Terraform and onboard it as Azure Arc enabled servers.</div></div><div class=td-content><h1 id=pg-e56462edb69ef5a1281ec6e2129b4745>6.1 - Ubuntu VM</h1><h2 id=deploy-a-vmware-ubuntu-vm-and-connect-it-to-azure-arc-using-terraform>Deploy a VMware Ubuntu VM and connect it to Azure Arc using Terraform</h2><p>The following README will guide you on how to use the provided <a href=https://www.terraform.io/>Terraform</a> plan to deploy an Ubuntu Server, VMware vSphere virtual machine and connect it as an Azure Arc enabled server resource.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p><a href=https://learn.hashicorp.com/terraform/getting-started/install.html>Install Terraform >=0.12</a></p></li><li><p>A VMware vCenter Server user with <a href=https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.vm_admin.doc/GUID-8254CD05-CC06-491D-BA56-A773A32A8130.html>permissions to deploy</a> a Virtual Machine from a Template in the vSphere Web Client.</p></li><li><p>Create Azure service principal (SP)</p><p>To connect the VMware vSphere virtual machine to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li></ul><h3 id=preparing-an-ubuntu-server-vmware-vsphere-vm-template>Preparing an Ubuntu Server VMware vSphere VM Template</h3><p>Before using the below guide to deploy an Ubuntu Server VM and connect it to Azure Arc, a VMware vSphere Template is required. <a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/vmware_ubuntu_template/>The following README</a> will instruct you how to easily create such a template using VMware vSphere 6.5 and above.</p><blockquote><p><strong>Note: If you already have an Ubuntu Server VM template it is still recommended to use the guide as a reference.</strong></p></blockquote><h2 id=deployment>Deployment</h2><p>Before executing the Terraform plan, you must set the environment variables which will be used by the plan. These variables are based on the Azure service principal you&rsquo;ve just created, your Azure subscription and tenant, and your VMware vSphere credentials.</p><ul><li><p>Retrieve your Azure subscription ID and tenant ID using the <code>az account list</code> command.</p></li><li><p>The Terraform plan creates resources in both Microsoft Azure and VMware vSphere. It then executes a script on the virtual machine to install the Azure Arc agent and all necessary artifacts. This script requires certain information about your VMware vSphere and Azure environments. Edit <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/vmware/ubuntu/terraform/scripts/vars.sh><em>scripts/vars.sh</em></a> and update each of the variables with the appropriate values.</p><ul><li>TF_VAR_subscription_id=Your Azure subscription ID</li><li>TF_VAR_client_id=Your Azure service principal name</li><li>TF_VAR_client_secret=Your Azure service principal password</li><li>TF_VAR_tenant_id=Your Azure tenant ID</li><li>TF_VAR_resourceGroup=Azure resource group name</li><li>TF_VAR_location=Azure Region</li><li>TF_VAR_vsphere_user=vCenter Admin Username</li><li>TF_VAR_vsphere_password=vCenter Admin Password</li><li>TF_VAR_vsphere_server=vCenter server FQDN/IP</li><li>TF_VAR_admin_user=OS Admin Username</li><li>TF_VAR_admin_password=OS Admin Password</li></ul></li><li><p>From CLI, navigate to the <em>azure_arc_servers_jumpstart/vmware/ubuntu/terraform</em> directory of the cloned repo.</p></li><li><p>Export the environment variables you edited by running <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/vmware/ubuntu/terraform/scripts/vars.sh><em>scripts/vars.sh</em></a> with the source command as shown below. Terraform requires these to be set for the plan to execute properly. Note that this script will also be automatically executed remotely on the virtual machine as part of the Terraform deployment.</p><p><code>source ./scripts/vars.sh</code></p></li><li><p>In addition to the <em>TF_VAR</em> environment variables you&rsquo;ve just exported, edit the Terraform variables in the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/vmware/ubuntu/terraform/terraform.tfvars><em>terraform.tfvars</em></a> to match your VMware vSphere environment.</p><p><img src=./01.png alt="TF_VAR environment variables"></p></li><li><p>Run the <code>terraform init</code> command which will download the Terraform AzureRM, Local and vSphere providers.</p><p><img src=./02.png alt="terraform init"></p></li><li><p>Run the <code>terraform apply --auto-approve</code> command and wait for the plan to finish.</p></li><li><p>Once the Terraform deployment is completed, a new Ubuntu Server VM will be up & running and will be projected as an Azure Arc enabled server resource in a newly created Azure resource group.</p><p><img src=./03.png alt="terraform apply"></p><p><img src=./04.png alt="New VMware vSphere Ubuntu Server VM"></p><p><img src=./05.png alt="Azure Arc enabled server in an Azure resource group"></p><p><img src=./06.png alt="Azure Arc enabled server in an Azure resource group"></p></li></ul><h2 id=delete-the-deployment>Delete the deployment</h2><ul><li><p>The most straightforward way is to delete the Azure Arc resource via the Azure Portal, just select the resource and delete it. In addition, delete the VMware vSphere VM.</p><p><img src=./07.png alt="Delete Azure Arc enabled server"></p><p>If you delete the instance manually, then you should also delete <em>install_arc_agent.sh</em> which is created by the Terraform plan.</p></li><li><p>If you want to nuke the entire environment use the <code>terraform destroy --auto-approve</code> command as shown below.</p><p><img src=./08.png alt="terraform destroy"></p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-35f5273e1310f62b1fd14f656ada12a2>6.1.1 - Create Ubuntu vSphere template</h1><h2 id=create-a-vmware-vsphere-template-for-ubuntu-server-1804>Create a VMware vSphere template for Ubuntu Server 18.04</h2><p>The following README will guide you on how to create an Ubuntu Server 18.04 VMware vSphere virtual machine template.</p><h2 id=prerequisites>Prerequisites</h2><blockquote><p><strong>Note: This guide assumes that you have some VMware vSphere familiarity. It is also does not designed to go over either VMware and/or Ubuntu best-practices.</strong></p></blockquote><ul><li><p><a href=https://releases.ubuntu.com/18.04/>Download the latest Ubuntu Server 18.04 ISO file</a></p></li><li><p>VMware vSphere 6.5 and above</p></li><li><p>Although it can be used locally, for faster deployment, it is recommended to upload the file to a vSphere datastore or to vCenter Content Library.</p></li></ul><h2 id=creating-ubuntu-1804-vm-template>Creating Ubuntu 18.04 VM Template</h2><h3 id=deploying--installing-ubuntu>Deploying & Installing Ubuntu</h3><ul><li><p>Deploy new virtual machine</p><p><img src=./01.png alt="Create new VMware vSphere VM"></p><p><img src=./02.png alt="Create new VMware vSphere VM"></p><p><img src=./03.png alt="Create new VMware vSphere VM"></p><p><img src=./04.png alt="Create new VMware vSphere VM"></p><p><img src=./05.png alt="Create new VMware vSphere VM"></p><p><img src=./06.png alt="Create new VMware vSphere VM"></p></li><li><p>Make sure to select <em>Ubuntu Linux (64-bit)</em> as the Guest OS.</p><p><img src=./07.png alt="Ubuntu Linux (64-bit) Guest OS"></p></li><li><p>Point to the Ubuntu Server ISO file location.</p><p><img src=./08.png alt="Create new VMware vSphere VM"></p><p><img src=./09.png alt="Create new VMware vSphere VM"></p></li><li><p>Power-on the VM and start the Ubuntu installation. No specific instructions here but:</p><ul><li><p>(Optional) Consider using static IP</p></li><li><p>Install OpenSSH server</p><p><img src=./10.png alt="Power-on the VM"></p><p><img src=./11.png alt="Ubuntu installation"></p><p><img src=./12.png alt="Ubuntu installation"></p><p><img src=./13.png alt="Ubuntu installation"></p><p><img src=./14.png alt="Ubuntu installation"></p><p><img src=./15.png alt="Ubuntu installation"></p><p><img src=./16.png alt="Ubuntu installation"></p><p><img src=./17.png alt="Ubuntu installation"></p><p><img src=./18.png alt="Ubuntu installation"></p><p><img src=./19.png alt="Ubuntu installation"></p><p><img src=./20.png alt="Ubuntu installation"></p><p><img src=./21.png alt="Ubuntu installation"></p><p><img src=./22.png alt="Ubuntu installation"></p><p><img src=./23.png alt="Ubuntu installation"></p><p><img src=./24.png alt="Ubuntu installation"></p><p><img src=./25.png alt="Ubuntu installation"></p><p><img src=./26.png alt="Ubuntu installation"></p><p><img src=./27.png alt="Ubuntu installation"></p><p><img src=./28.png alt="Ubuntu installation"></p><p><img src=./29.png alt="Ubuntu installation"></p><p><img src=./30.png alt="Ubuntu installation"></p></li></ul></li></ul><h3 id=post-installation>Post-installation</h3><p>Before converting the VM to a template, few actions are needed.</p><ul><li><p>It&rsquo;s better to have your OS packages up-to-date</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>sudo apt-get update
sudo apt-get upgrade -y
</code></pre></div></li><li><p>Prevent cloudconfig from preserving the original hostname and reset the hostname</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>sudo sed -i <span style=color:#4e9a06>&#39;s/preserve_hostname: false/preserve_hostname: true/g&#39;</span> /etc/cloud/cloud.cfg
sudo truncate -s0 /etc/hostname
sudo hostnamectl set-hostname localhost
</code></pre></div></li><li><p>Remove the current network configuration</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>sudo rm /etc/netplan/50-cloud-init.yaml
</code></pre></div></li><li><p>Clean shell history and shutdown the VM</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cat /dev/null &gt; ~/.bash_history <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#204a87>history</span> -c
sudo shutdown now
</code></pre></div></li></ul><h3 id=convert-to-template>Convert to Template</h3><p>Reduce the VM CPU count & memory resources to the minimum and convert the VM to template, switch the CD/DVD drive to client device as well disconnect it and convert the VM to template.</p><p><img src=./31.png alt="Reduce the VM CPU count & Memory"></p><p><img src=./32.png alt="Convert the VM to template"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-7ede8ac96598e3cbc19ecd306e0933fe>6.2 - Windows VM</h1><h2 id=deploy-a-vmware-windows-vm-and-connect-it-to-azure-arc-using-terraform>Deploy a VMware Windows VM and connect it to Azure Arc using Terraform</h2><p>The following README will guide you on how to use the provided <a href=https://www.terraform.io/>Terraform</a> plan to deploy a Windows Server, VMware vSphere virtual machine and connect it as an Azure Arc enabled server resource.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p><a href=https://learn.hashicorp.com/terraform/getting-started/install.html>Install Terraform >=0.12</a></p></li><li><p>A VMware vCenter Server user with <a href=https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.vm_admin.doc/GUID-8254CD05-CC06-491D-BA56-A773A32A8130.html>permissions to deploy</a> a Virtual Machine from a Template in the vSphere Web Client.</p></li><li><p>Create Azure service principal (SP)</p><p>To connect the VMware vSphere virtual machine to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li></ul><h3 id=preparing-a-window-server-vmware-vsphere-vm-template>Preparing a Window Server VMware vSphere VM Template</h3><p>Before using the below guide to deploy a Windows Server VM and connect it to Azure Arc, a VMware vSphere Template is required. <a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/vmware_winsrv2k19_template/>The following README</a> will instruct you how to easily create such a template using VMware vSphere 6.5 and above.</p><p><strong>The Terraform plan leveraged the <em>remote-exec</em> provisioner which uses the WinRM protocol to copy and execute the required Azure Arc script. To allow WinRM connectivity to the VM, run the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/vmware/winsrv/terraform/scripts/allow_winrm.ps1><em>allow_winrm</em></a> PowerShell script on your VM before converting it to template.</strong></p><blockquote><p><strong>Note: If you already have a Windows Server VM template it is still recommended to use the guide as a reference.</strong></p></blockquote><h2 id=deployment>Deployment</h2><p>Before executing the Terraform plan, you must set the environment variables which will be used by the plan. These variables are based on the Azure service principal you&rsquo;ve just created, your Azure subscription and tenant, and your VMware vSphere credentials.</p><ul><li><p>Retrieve your Azure subscription ID and tenant ID using the <code>az account list</code> command.</p></li><li><p>The Terraform plan creates resources in both Microsoft Azure and VMware vSphere. It then executes a script on the virtual machine to install the Azure Arc agent and all necessary artifacts. This script requires certain information about your VMware vSphere and Azure environments. Edit <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/vmware/winsrv/terraform/scripts/vars.sh><em>scripts/vars.sh</em></a> and update each of the variables with the appropriate values.</p><ul><li>TF_VAR_subscription_id=Your Azure subscription ID</li><li>TF_VAR_client_id=Your Azure service principal name</li><li>TF_VAR_client_secret=Your Azure service principal password</li><li>TF_VAR_tenant_id=Your Azure tenant ID</li><li>TF_VAR_resourceGroup=Azure resource group name</li><li>TF_VAR_location=Azure Region</li><li>TF_VAR_vsphere_user=vCenter Admin Username</li><li>TF_VAR_vsphere_password=vCenter Admin Password</li><li>TF_VAR_vsphere_server=vCenter server FQDN/IP</li><li>TF_VAR_admin_user=OS Admin Username</li><li>TF_VAR_admin_password=OS Admin Password</li></ul></li><li><p>From CLI, navigate to the <em>azure_arc_servers_jumpstart/vmware/winsrv/terraform</em> directory of the cloned repo.</p></li><li><p>Export the environment variables you edited by running <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/vmware/winsrv/terraform/scripts/vars.sh><em>scripts/vars.sh</em></a> with the source command as shown below. Terraform requires these to be set for the plan to execute properly. Note that this script will also be automatically executed remotely on the virtual machine as part of the Terraform deployment.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#204a87>source</span> ./scripts/vars.sh
</code></pre></div></li><li><p>In addition to the <em>TF_VAR</em> environment variables you&rsquo;ve just exported, edit the Terraform variables in the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/vmware/winsrv/terraform/terraform.tfvars><em>terraform.tfvars</em></a> to match your VMware vSphere environment.</p><p><img src=./01.png alt="TF_VAR environment variables"></p></li><li><p>Run the <code>terraform init</code> command which will download the Terraform AzureRM, Local and vSphere providers.</p><p><img src=./02.png alt="terraform init"></p></li><li><p>Run the <code>terraform apply --auto-approve</code> command and wait for the plan to finish.Once the Terraform deployment is completed, a new Windows Server VM will be up & running and will be projected as an Azure Arc server resource in a newly created Azure resource group.</p><p><img src=./03.png alt="terraform apply completed"></p><p><img src=./04.png alt="New VMware vSphere Windows Server VM"></p><p><img src=./05.png alt="Azure Arc enabled server in an Azure resource group"></p><p><img src=./06.png alt="Azure Arc enabled server in an Azure resource group"></p></li></ul><h2 id=delete-the-deployment>Delete the deployment</h2><ul><li><p>The most straightforward way is to delete the Azure Arc resource via the Azure Portal, just select the resource and delete it. In addition, delete the VMware vSphere VM.</p><p><img src=./07.png alt="Delete Azure Arc enabled server"></p></li><li><p>If you delete the instance manually, then you should also delete <em>install_arc_agent.ps1</em> which is created by the Terraform plan.</p></li><li><p>If you want to nuke the entire environment use the <code>terraform destroy --auto-approve</code> command as shown below.</p><p><img src=./08.png alt="terraform destroy"></p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-445074e741930bddb3d57e908f6dcc90>6.2.1 - Create Windows vSphere template</h1><h2 id=create-a-vmware-vsphere-template-for-windows-server-2019>Create a VMware vSphere template for Windows Server 2019</h2><p>The following README will guide you on how to create a Windows Server 2019 VMware vSphere virtual machine template.</p><h2 id=prerequisites>Prerequisites</h2><blockquote><p><strong>Note: This guide assumes that you have some VMware vSphere familiarity and you have knowledge on how to install Windows Server. It is also does not designed to go over either VMware and/or Windows best-practices.</strong></p></blockquote><ul><li><p><a href=https://www.microsoft.com/en-us/windows-server/trial>Download the latest Windows Server ISO file</a></p></li><li><p>VMware vSphere 6.5 and above</p></li><li><p>Although it can be used locally, for faster deployment, it is recommended to upload the file to a vSphere datastore or to vCenter Content Library.</p></li></ul><h2 id=creating-windows-server-2019-vm-template>Creating Windows Server 2019 VM Template</h2><h3 id=deploying--installing-windows-server>Deploying & Installing Windows Server</h3><ul><li><p>Deploy new virtual machine</p><p><img src=./01.png alt="Create new VMware vSphere VM"></p><p><img src=./02.png alt="Create new VMware vSphere VM"></p><p><img src=./03.png alt="Create new VMware vSphere VM"></p><p><img src=./04.png alt="Create new VMware vSphere VM"></p><p><img src=./05.png alt="Create new VMware vSphere VM"></p><p><img src=./06.png alt="Create new VMware vSphere VM"></p></li><li><p>Make sure to select <em>Microsoft Windows Server 2016 or later (64-bit)</em> as the Guest OS.</p><p><img src=./07.png alt="Windows Server Guest OS"></p></li><li><p>Point to the Windows Server ISO file location.</p><p><img src=./08.png alt="Create new VMware vSphere VM"></p><p><img src=./09.png alt="Create new VMware vSphere VM"></p></li><li><p>Power-on the VM and start the Windows Server installation.</p><p><img src=./10.png alt="Power-on the VM"></p><p><img src=./11.png alt="Windows Server installation"></p><p><img src=./12.png alt="Windows Server installation"></p><p><img src=./13.png alt="Windows Server installation"></p><p><img src=./14.png alt="Windows Server installation"></p><p><img src=./15.png alt="Windows Server installation"></p><p><img src=./16.png alt="Windows Server installation"></p></li></ul><h3 id=post-installation>Post-installation</h3><p>Before converting the VM to a template, few actions needs to be taken.</p><ul><li><p>Install VMware Tools & Restart</p><p><img src=./17.png alt="Install VMware Tools"></p><p><img src=./18.png alt="Install VMware Tools"></p><p><img src=./19.png alt="Install VMware Tools"></p><p><img src=./20.png alt="Install VMware Tools"></p><p><img src=./21.png alt="Install VMware Tools"></p><p><img src=./22.png alt="Install VMware Tools"></p><p><img src=./23.png alt="Install VMware Tools"></p><p><img src=./24.png alt="Install VMware Tools"></p><p><img src=./25.png alt="Install VMware Tools"></p></li><li><p>Perform Windows Updates</p></li><li><p>Change PowerShell Execution Policy to &ldquo;bypass&rdquo; by running the <code>Set-ExecutionPolicy -ExecutionPolicy Bypass</code> command in PowerShell (can be later tuned on via Group Policy or a PowerShell script).</p></li><li><p>Allow WinRM communication to the OS buy running the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/vmware/winsrv/terraform/scripts/allow_winrm.ps1><em>allow_winrm</em></a> PowerShell script.</p></li><li><p>None of the below are mandatory but should be considered for a Windows Template:</p><ul><li><p>Disabling User Account Control (can be later tuned on via Group Policy or a PowerShell script)</p></li><li><p>Turn off Windows Defender FW (can be later tuned on via Group Policy or a PowerShell script)</p></li><li><p>Disabling Internet Explorer Enhanced Security Configuration (ESC) (can be later tuned on via Group Policy or a PowerShell script)</p></li><li><p>Enable Remote Desktop</p></li><li><p>In PowerShell, install <a href=https://chocolatey.org/install>Chocolaty</a></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#204a87>Set-ExecutionPolicy</span> <span style=color:#000>Bypass</span> <span style=color:#000>-Scope</span> <span style=color:#204a87;font-weight:700>Process</span> <span style=color:#000>-Force</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>[System.Net.ServicePointManager]</span><span style=color:#000;font-weight:700>::</span><span style=color:#000>SecurityProtocol</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>[System.Net.ServicePointManager]</span><span style=color:#000;font-weight:700>::</span><span style=color:#000>SecurityProtocol</span> <span style=color:#ce5c00;font-weight:700>-bor</span> <span style=color:#000>3072</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>iex </span><span style=color:#000;font-weight:700>((</span><span style=color:#204a87>New-Object</span> <span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Net</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WebClient</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>DownloadString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;https://chocolatey.org/install.ps1&#39;</span><span style=color:#000;font-weight:700>))</span>
</code></pre></div></li><li><p>Install all baseline apps you may want to include in your template.</p></li></ul></li></ul><h3 id=convert-to-template>Convert to Template</h3><p>Reduce the VM CPU count & memory resources to the minimum and convert the VM to template, switch the CD/DVD drive to client device as well disconnect it and convert the VM to template.</p><p><img src=./26.png alt="Reduce the VM CPU count & Memory"></p><p><img src=./27.png alt="Convert the VM to template"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-0234ac16eaff72421179b07a80c54256>7 - Unified Operations Use Cases</h1><div class=lead>Once you have server resources projected into Azure with Azure Arc, you can start to use native Azure tooling to manage the servers as native Azure resources. The following scenarios show examples of using Azure management tools such as resource tags, Azure Policy, Log Analytics, and more with Azure Arc enabled servers.</div></div><div class=td-content><h1 id=pg-f662c3c6424f0e3f7be88762438f027f>7.1 - Inventory Tagging</h1><h2 id=apply-inventory-tagging-to-azure-arc-enabled-servers>Apply inventory tagging to Azure Arc enabled servers</h2><p>The following README will guide you on how to use Azure Arc enabled servers to provide server inventory management capabilities across hybrid multi-cloud and on-premises environments.</p><p>Azure Arc enabled servers allows you to manage your Windows and Linux machines hosted outside of Azure on your corporate network or other cloud provider, similarly to how you manage native Azure virtual machines. When a hybrid machine is connected to Azure, it becomes a connected machine and is treated as a resource in Azure. Each connected machine has a Resource ID, is managed as part of a resource group inside a subscription, and benefits from standard Azure constructs such as Azure Policy and applying tags. The ability to easily organize and manage server inventory using Azure as a management engine greatly reduces administrative complexity and provides a consistent strategy for hybrid and multi-cloud environments.</p><p>In this guide, we will use <a href=https://docs.microsoft.com/en-us/azure/governance/resource-graph/first-query-portal>Resource Graph Explorer</a> and <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">AZ CLI</a> to demonstrate tagging and querying server inventory across multiple clouds from a single pane of glass in Azure.</p><blockquote><p><strong>Note: This guide assumes you already deployed VMs or servers that are running on-premises or other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li></ul><h2 id=verify-that-your-arc-connected-servers-are-ready-for-tagging>Verify that your Arc connected servers are ready for tagging</h2><p>We will be using Resource Graph Explorer during this exercise to query and view resources in Azure.</p><ul><li><p>Enter &ldquo;Resource Graph Explorer&rdquo; in the top search bar in the Azure portal and select it.</p><p><img src=./01.png alt="Screenshot showing Resource Graph Explorer in Azure Portal"></p></li><li><p>In the query window, enter the following query and then click &ldquo;Run Query&rdquo;:</p><pre><code class=language-kusto data-lang=kusto>Resources
| where type =~ 'Microsoft.HybridCompute/machines'
</code></pre></li><li><p>If you have correctly created Azure Arc enabled servers, they should be listed in the Results pane of Resource Graph Explorer. You can also view the Azure Arc enabled serves from the Azure portal.</p><p><img src=./02.png alt="Screenshot showing Resource Graph Explorer query"></p><p><img src=./10.png alt="Screenshot showing Azure Portal with Azure Arc enabled server"></p><p><img src=./11.png alt="Screenshot showing Azure Arc enabled server details"></p></li></ul><h2 id=create-a-basic-azure-tag-taxonomy>Create a basic Azure tag taxonomy</h2><ul><li><p>Open AZ CLI and run the following commands to create a basic taxonomy structure that will allow us to easily query and report on where our server resources are hosted (i.e., Azure vs AWS vs GCP vs On-premises). For more guidance on building out a tag taxonomy please review the <a href=https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/decision-guides/resource-tagging/>Resource naming and tagging decision guide</a>.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az tag create --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span>
az tag add-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;Azure&#34;</span>
az tag add-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;AWS&#34;</span>
az tag add-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;GCP&#34;</span>
az tag add-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;On-premises&#34;</span>
</code></pre></div><p><img src=./05.png alt="Screenshot showing output of az tag create"></p></li></ul><h2 id=tag-arc-resources>Tag Arc resources</h2><p>Now that we have created a basic taxonomy structure, we will apply tags to our Azure Arc enabled server resources. In this guide, we will demonstrate tagging resources in both AWS and GCP. If you only have resources in one of these providers, you can skip to the appropriate section for AWS or GCP.</p><h3 id=tag-arc-connected-aws-ubuntu-ec2-instance>Tag Arc-connected AWS Ubuntu EC2 instance</h3><ul><li><p>In AZ CLI, run the following commands to apply the &ldquo;Hosting Platform : AWS&rdquo; tag to your AWS Azure Arc enabled servers.</p><blockquote><p><strong>Note: If you connected your AWS EC2 instances using a method other than the one described in <a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>this tutorial</a>, then you will need to adjust the values for <code>awsResourceGroup</code> and <code>awsMachineName</code> to match values specific to your environment.</strong></p></blockquote><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#204a87>export</span> <span style=color:#000>awsResourceGroup</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;arc-aws-demo&#34;</span>
<span style=color:#204a87>export</span> <span style=color:#000>awsMachineName</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;arc-aws-demo&#34;</span>
<span style=color:#204a87>export</span> <span style=color:#000>awsMachineResourceId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>az resource show --resource-group <span style=color:#000>$awsResourceGroup</span> --name <span style=color:#000>$awsMachineName</span> --resource-type <span style=color:#4e9a06>&#34;Microsoft.HybridCompute/machines&#34;</span> --query id<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
<span style=color:#204a87>export</span> <span style=color:#000>awsMachineResourceId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span><span style=color:#204a87>echo</span> <span style=color:#000>$awsMachineResourceId</span> <span style=color:#000;font-weight:700>|</span> tr -d <span style=color:#4e9a06>&#34;\&#34;&#34;</span> <span style=color:#000;font-weight:700>|</span> tr -d <span style=color:#4e9a06>&#39;\r&#39;</span><span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
az resource tag --ids <span style=color:#000>$awsMachineResourceId</span> --tags <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;AWS&#34;</span>
</code></pre></div><p><img src=./07.png alt="Screenshot showing output of az resource tag"></p></li></ul><h3 id=tag-arc-connected-gcp-ubuntu-server>Tag Arc-connected GCP Ubuntu server</h3><ul><li><p>In AZ CLI, run the following commands to apply the &ldquo;Hosting Platform : GCP&rdquo; tag to your GCP Azure Arc enabled servers.</p><blockquote><p><strong>Note: If you connected your GCP instances using a method other than the one described in <a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>this tutorial</a>, then you will need to adjust the values for <code>gcpResourceGroup</code> and <code>gcpMachineName</code> to match values specific to your environment.</strong></p></blockquote><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#204a87>export</span> <span style=color:#000>gcpResourceGroup</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;arc-gcp-demo&#34;</span>
<span style=color:#204a87>export</span> <span style=color:#000>gcpMachineName</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;arc-gcp-demo&#34;</span>
<span style=color:#204a87>export</span> <span style=color:#000>gcpMachineResourceId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>az resource show --resource-group <span style=color:#000>$gcpResourceGroup</span> --name <span style=color:#000>$gcpMachineName</span> --resource-type <span style=color:#4e9a06>&#34;Microsoft.HybridCompute/machines&#34;</span> --query id<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
<span style=color:#204a87>export</span> <span style=color:#000>gcpMachineResourceId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span><span style=color:#204a87>echo</span> <span style=color:#000>$gcpMachineResourceId</span> <span style=color:#000;font-weight:700>|</span> tr -d <span style=color:#4e9a06>&#34;\&#34;&#34;</span> <span style=color:#000;font-weight:700>|</span> tr -d <span style=color:#4e9a06>&#39;\r&#39;</span><span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
az resource tag --resource-group <span style=color:#000>$gcpResourceGroup</span> --ids <span style=color:#000>$gcpMachineResourceId</span> --tags <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;GCP&#34;</span>
</code></pre></div><p><img src=./08.png alt="Screenshot showing output of az resource tag"></p></li></ul><h2 id=query-resources-by-tag-using-resource-graph-explorer>Query resources by tag using Resource Graph Explorer</h2><p>Now that we have applied tags to our resources that are hosted in multiple clouds, we can use Resource Graph Explorer to query them and get insight into our multi-cloud landscape.</p><ul><li><p>In the query window, enter the following query:</p><pre><code class=language-kusto data-lang=kusto>Resources
| where type =~ 'Microsoft.HybridCompute/machines'
| where isnotempty(tags['Hosting Platform'])
| project name, location, resourceGroup, tags
</code></pre><p><img src=./04.png alt="Screenshot showing Resource Graph Explorer query"></p></li><li><p>Click &ldquo;Run Query&rdquo; and then select the Formatted Results toggle. If done correctly, you should see all Azure Arc enabled servers and their assigned &ldquo;Hosting Platform&rdquo; tag values.</p><p><img src=./06.png alt="Screenshot showing results of Resource Graph Explorer query"></p></li><li><p>We can also view the tags on the projected servers from Azure Portal.</p><p><img src=./12.png alt="Screenshot showing tags on Azure Arc enabled server"></p><p><img src=./13.png alt="Screenshot showing tags on Azure Arc enabled server"></p></li></ul><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><ul><li><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></p></li><li><p>Remove tags created as part of this guide by executing the following script in AZ CLI.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az tag remove-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;Azure&#34;</span>
az tag remove-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;AWS&#34;</span>
az tag remove-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;GCP&#34;</span>
az tag remove-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;On-premises&#34;</span>
az tag create --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span>
</code></pre></div></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-caccbcbc963315fae066659de1818715>7.2 - Monitoring Agent Extension</h1><h2 id=deploy-monitoring-agent-extension-on-azure-arc-linux-and-windows-servers-using-extension-management>Deploy Monitoring Agent Extension on Azure Arc Linux and Windows servers using Extension Management</h2><p>The following README will guide you on how to manage extensions on Azure Arc enabled servers. Virtual machine extensions are small applications that provide post-deployment configuration and automation tasks such as software installation, anti-virus protection, or a mechanism to run a custom script.</p><p>Azure Arc enabled servers, enables you to deploy Azure VM extensions to non-Azure Windows and Linux VMs, giving you a hybrid or multi-cloud management experience that levels to Azure VMs.</p><p>You can use the Azure portal, Azure CLI, an ARM template, PowerShell script or Azure policies to manage the extension deployment to Azure Arc enabled servers, both Linux and Windows. In this guide, you will use an ARM template deploy the Microsoft Monitoring Agent (MMA) to your servers so they are onboard on Azure services that leverage this agent: Azure Monitor, Azure Security Center, Azure Sentinel, etc.</p><blockquote><p><strong>Note: This guide assumes you already deployed VMs or servers that are running on-premises or other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><p>Please review the <a href=https://docs.microsoft.com/en-us/azure/azure-monitor/insights/vminsights-enable-overview#supported-operating-systems>Azure Monitor supported OS documentation</a> and ensure that the VMs you will use for this exercise are supported. For Linux VMs, check both the Linux distribution and kernel to ensure you are using a supported configuration.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p>As mentioned, this guide starts at the point where you already deployed and connected VMs or servers to Azure Arc. In the screenshots below you can see a GCP server has been connected with Azure Arc and is visible as a resource in Azure.</p><p><img src=./01.png alt="Screenshot Azure Arc enabled server on resource group"></p><p><img src=./02.png alt="Screenshot Azure Arc enabled server connected status"></p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI</a>. Azure CLI should be running version 2.7** or later. Use <code>az --version</code> to check your current installed version.</p></li><li><p>Create Azure Service Principal (SP)</p><p>To connect a VM or bare-metal server to Azure Arc, Azure service principal assigned with the &ldquo;contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a>.</strong></p></blockquote></li><li><p>You will also need to have a Log Analytics workspace deployed. You can automate the deployment by editing the ARM template <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/extensions/arm/log_analytics-template.parameters.json>parameters file</a> and provide a name and location for your workspace.</p><p><img src=./03.png alt="Screenshot ARM template parameters file"></p><p>To deploy the ARM template, navigate to the &ldquo;deployment folder&rdquo; <em><strong>../extensions/arm</strong></em> and run the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az deployment group create --resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--template-file &lt;The *log_analytics-template.json* template file location&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--parameters &lt;The *log_analytics-template.parameters.json* template file location&gt;
</code></pre></div></li></ul><h2 id=azure-arc-enabled-servers-microsoft-monitoring-agent-extension-deployment>Azure Arc enabled servers Microsoft Monitoring Agent Extension Deployment</h2><ul><li><p>Edit the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/extensions/arm/mma-template.parameters.json><em>extensions parameters file</em></a></p><p><img src=./04.png alt="Screenshot ARM template parameters file"></p></li><li><p>To match your configuration you will need to provide:</p><ul><li><p>The VM name as it is registered in Azure Arc.</p><p><img src=./05.png alt="Screenshot Azure Arc enabled server computer name"></p></li><li><p>The location of the resource group where you registered the Azure Arc enabled server.</p><p><img src=./06.png alt="Screenshot Azure Arc enabled server location"></p></li><li><p>Information of the Log Analytics workspace you previously created: workspace ID and key. These parameters will be used to configure the MMA agent. You can get this information by going to your Log Analytics workspace and under &ldquo;Settings&rdquo; select &ldquo;Agent management&rdquo;.</p><p><img src=./07.png alt="Screenshot Azure Arc enabled server Agent management"></p><p><img src=./08.png alt="Screenshot workspace configuration"></p></li></ul></li><li><p>Choose the ARM template that matches your operating system, for <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/extensions/arm/mma-template-windows.json><em>Windows</em></a> and <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/extensions/arm/mma-template-linux.json><em>Linux</em></a>, deploy the template by running the following command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az deployment group create --resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--template-file &lt;The *mma-template.json* template file location&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--parameters &lt;The *mma-template.parameters.json* template file location&gt;
</code></pre></div></li><li><p>Once the template has completed its run, you should see an output as follows:</p><p><img src=./09.png alt="Screenshot ARM template execution output"></p></li><li><p>You will have the Microsoft Monitoring agent deployed on your Windows or Linux system and reporting to the Log Analytics workspace that you have selected. You can verify by going back to the &ldquo;Agents management&rdquo; section of your workspace and choosing either Windows or Linux, you should see now an additional connected VM.</p><p><img src=./10.png alt="Screenshot Windows connected agents"></p><p><img src=./11.png alt="Screenshot Linux connected agents"></p></li></ul><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p><ul><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></p></li><li><p>Remove the Log Analytics workspace by executing the following command in AZ CLI. Provide the workspace name you used when creating the Log Analytics Workspace.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az monitor log-analytics workspace delete --resource-group &lt;Name of the Azure resource group&gt; --workspace-name &lt;Log Analytics Workspace Name&gt; --yes
</code></pre></div></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8a7b8f2b3e4ec67d3a0eede84e3eae93>7.3 - Custom Script Extension</h1><h2 id=deploy-custom-script-extension-on-azure-arc-linux-and-windows-servers-using-extension-management>Deploy Custom Script Extension on Azure Arc Linux and Windows servers using Extension Management</h2><p>The following README will guide you on how to execute custom scripts on Azure Arc enabled servers by using Virtual Machine extensions. Virtual machine extensions are small applications that provide post-deployment configuration and automation tasks such as software installation, anti-virus protection, or a mechanism to run a custom script.</p><p>You can use the Azure portal, Azure CLI, an ARM template, PowerShell or Linux Shell script, or Azure policies to manage the extension deployment to Azure Arc enabled servers. In this guide, we will use an ARM template to deploy the custom script extension. This extension downloads and executes scripts on virtual machines and it is useful for post deployment configuration, software installation, or any other configuration or management tasks.</p><blockquote><p><strong>Note: This guide assumes you already deployed VMs or servers that are running on-premises or other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p>As mentioned, this guide starts at the point where you already deployed and connected VMs or servers to Azure Arc. In the screenshots below you can see a GCP server has been connected with Azure Arc and is visible as a resource in Azure.</p><p><img src=./01.png alt="Screenshot Azure Arc enabled server on resource group"></p><p><img src=./02.png alt="Screenshot Azure Arc enabled server on connected status"></p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI</a>. Azure CLI should be running version 2.7** or later. Use <code>az --version</code> to check your current installed version.</p></li><li><p>Create Azure Service Principal (SP)</p><p>To connect a VM or bare-metal server to Azure Arc, Azure service principal assigned with the &ldquo;contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a>.</strong></p></blockquote></li><li><p>In order to demonstrate the custom script extension, we will use the below Linux and Windows scripts.</p><ul><li><a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/scripts/custom_script_linux.sh><em>Linux</em></a>: The script will modify the message of the day (MOTD) on the operating system.</li><li><a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/scripts/custom_script_windows.ps1><em>Windows</em></a>: The script will install Windows Terminal, Microsoft Edge, 7zip and Visual Studio Code <a href=https://chocolatey.org/>Chocolaty</a> packages on the VM.</li></ul></li></ul><h2 id=azure-arc-enabled-servers-custom-script-extension-deployment>Azure Arc enabled servers Custom Script Extension Deployment</h2><ul><li><p>Edit the extensions parameters file for <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/extensions/arm/customscript-templatewindows.parameters.json><em>Windows</em></a> or for <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/extensions/arm/customscript-templatelinux.parameters.json><em>Linux</em></a></p><p><img src=./03.png alt="Screenshot parameters file"></p></li><li><p>To match your environment configuration, you will need to provide the following information:</p><ul><li><p>The VM name as it is registered in Azure Arc.</p><p><img src=./04.png alt="Screenshot Azure Arc enabled server machine name"></p></li><li><p>The location of the resource group where you registered the Azure Arc enabled server.</p><p><img src=./05.png alt="Screenshot Azure region"></p></li><li><p>A public Uri for the script that you would like to run on the servers, in this case use the URL for the script in raw format.</p><ul><li>For Windows: <a href=https://raw.githubusercontent.com/microsoft/azure_arc/main/azure_arc_servers_jumpstart/scripts/custom_script_windows.ps1>Public Uri</a></li><li>For Linux: <a href=https://raw.githubusercontent.com/microsoft/azure_arc/main/azure_arc_servers_jumpstart/scripts/custom_script_linux.sh>Public Uri</a></li></ul></li><li><p>To run either script, use the below commands:</p><ul><li><p>Windows:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#000>powershell</span> <span style=color:#000>-ExecutionPolicy</span> <span style=color:#000>Unrestricted</span> <span style=color:#ce5c00;font-weight:700>-File</span> <span style=color:#000>custom_script_windows</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ps1</span>
</code></pre></div></li><li><p>Linux:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./custom_script_linux.sh
</code></pre></div></li></ul></li></ul></li><li><p>To deploy the ARM template for Linux or Windows, navigate to the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/extensions/arm>deployment folder</a> and run the below command with the templates that match your operating system:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>az deployment group create --resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--template-file &lt;The *customscript-template.json* template file location <span style=color:#204a87;font-weight:700>for</span> Linux or Windows&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--parameters &lt;The *customscript-template.parameters.json* template file location&gt;
</code></pre></div></li><li><p>Once the template deployment has completed it&rsquo;s run, you should see an output as follows:</p><p><img src=./06.png alt="Screenshot ARM template output"></p></li><li><p>To verify a successful deployment on the Azure Arc enabled server, in the Azure Portal, by clicking on &ldquo;Extensions&rdquo; settings. You should see the Custom Script extension installed.</p><p><img src=./07.png alt="Screenshot custom script extension"></p></li><li><p>Another way to verify successful custom script execution is by connecting to the VMs and verifying that the operating system has been configured.</p><ul><li><p>For the Linux VM, use SSH to connect the VM and check out the message of the day which was customized by the script:</p><p><img src=./08.png alt="Screenshot message of the day changed"></p></li><li><p>For the Windows VM, use RDP to connect the VM and verify that the additional software has been installed: Microsoft Edge, 7zip and Visual Studio Code.</p><p><img src=./09.png alt="Screenshot additional software installed"></p></li></ul></li></ul><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-4bcf5ee34563db9860f2594f7c5d636a>7.4 - Azure Policy</h1><h2 id=deploy-monitoring-agent-extension-to-azure-arc-linux-and-windows-servers-using-azure-policy>Deploy Monitoring Agent Extension to Azure Arc Linux and Windows servers using Azure Policy</h2><p>The following README will guide you on how to use Azure Arc enabled servers to assign Azure Policies to VMs outside of Azure, whether they are on-premises or other clouds. With this feature you can now use Azure Policy to audit settings in the operating system of an Azure Arc enabled server, if a setting is not compliant you can also trigger a remediation task.</p><p>In this case, you will assign a policy to audit if the Azure Arc connected machine has the (Microsoft Monitoring Agent) MMA agent installed, if not, you will use the extensions feature to automatically deploy it to the VM, an enrollment experience that levels to Azure VMs. This approach can be used to make sure all your servers are onboard to services such as Azure Monitor, Azure Security Center, Azure Sentinel, etc.</p><p>You can use the Azure Portal, an ARM template or PowerShell script to assign policies to Azure subscriptions or resource groups. In this guide, you will use an ARM template to assign built-in policies.</p><blockquote><p><strong>Note: This guide assumes you already deployed VMs or servers that are running on-premises or other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><p>Please review the <a href=https://docs.microsoft.com/en-us/azure/azure-monitor/insights/vminsights-enable-overview#supported-operating-systems>Azure Monitor supported OS documentation</a> and ensure that the VMs you will use for this guide are supported. For Linux VMs, check both the Linux distribution and kernel to ensure you are using a supported configuration.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p>As mentioned, this guide starts at the point where you already deployed and connected VMs or servers to Azure Arc. In the screenshots below we can see a GCP server has been connected with Azure Arc and is visible as a resource in Azure.</p><p><img src=./01.png alt="Screenshot Azure Arc enabled server on resource group"></p><p><img src=./02.png alt="Screenshot Azure Arc enabled server connected status"></p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI</a>. Azure CLI should be running version 2.7** or later. Use <code>az --version</code> to check your current installed version.</p></li><li><p>Create Azure service principal (SP)</p><p>To connect a VM or bare-metal server to Azure Arc, Azure service principal assigned with the &ldquo;contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a>.</strong></p></blockquote></li><li><p>You will also need to have a Log Analytics workspace deployed. You can automate the deployment by editing the ARM template <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/policies/arm/log_analytics-template.parameters.json>parameters file</a>, provide a name and location for your workspace.</p><p><img src=./03.png alt="Screenshot ARM template parameters file"></p><p>To deploy the ARM template, navigate to the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/policies/arm>deployment folder</a> and run the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>  az deployment group create --resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --template-file &lt;The *log_analytics-template.json* template file location&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --parameters &lt;The *log_analytics-template.parameters.json* template file location&gt;
</code></pre></div></li></ul><h2 id=azure-policies-on-azure-arc-connected-machines>Azure Policies on Azure Arc connected machines</h2><ul><li><p>Now that you have all the prerequisites set, you can assign policies to our Arc connected machines. Edit the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/policies/arm/policy.json>parameters file</a> to provide your subscription ID as well as the Log Analytics workspace.</p><p><img src=./04.png alt="Screenshot ARM template parameter file"></p><p>To start the deployment, use the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az policy assignment create --name <span style=color:#4e9a06>&#39;Enable Azure Monitor for VMs&#39;</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--scope <span style=color:#4e9a06>&#39;/subscriptions/&lt;Your subscription ID&gt;/resourceGroups/&lt;Name of the Azure resource group&gt;&#39;</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--policy-set-definition <span style=color:#4e9a06>&#39;55f3eceb-5573-4f18-9695-226972c6d74a&#39;</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>-p &lt;The *policy.json* template file location&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--assign-identity --location &lt;Azure Region&gt;
</code></pre></div><p>The flag <em>policy-set-definition</em> points to the initiative &ldquo;Enable Azure Monitor&rdquo; definition ID.</p></li><li><p>Once the initiative is assigned, it takes around 30 minutes for the assignment to be applied to the defined scope. After those 30 minutes, Azure Policy will start the evaluation cycle against the Azure Arc connected machine and recognize it as &ldquo;Non-compliant&rdquo; (since it still does not have the Log Analytics Agent configuration deployed). To check this, go to the Azure Arc connected Machine under the Policies section.</p><p><img src=./05.png alt="Screenshot Azure Policy non-compliant"></p></li><li><p>Now, you will assign a remediation task to the non-compliant resource to put into a compliant state.</p><p><img src=./06.png alt="Screenshot Azure Policy remediation task"></p></li><li><p>Under &lsquo;Policy to remediate&rsquo; choose &lsquo;[Preview] Deploy Log Analytics Agent to Linux Azure Arc machines&rsquo; and select &lsquo;Remediate&rsquo;. This remediation task is instructing Azure Policy to run the deployIfNotExists effect and use the Azure Arc extension management capabilities to deploy the Log Analytics agent on the VM</p><p><img src=./07.png alt="Screenshot Azure Policy remediation task"></p></li><li><p>Once you have assigned remediation task, the policy will be evaluated again and show that the server on GCP is compliant and that the Microsoft Monitoring Agent extension is installed on the Azure Arc machine.</p><p><img src=./08.png alt="Screenshot remediation task configuration"></p><p><img src=./09.png alt="Screenshot Azure Policy compliant status"></p></li></ul><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><p>Remove the Azure Policy assignment by executing the following script in Azure CLI.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az policy assignment delete --name <span style=color:#4e9a06>&#39;Enable Azure Monitor for VMs&#39;</span> --resource-group &lt;resource_group&gt;
</code></pre></div><p>Remove the Log Analytics workspace by executing the following script in Azure CLI. Provide the workspace name you used when creating the Log Analytics workspace.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az monitor log-analytics workspace delete --resource-group &lt;Name of the Azure resource group&gt; --workspace-name &lt;Log Analytics workspace Name&gt; --yes
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-1960d9874e7502df863af9a46f8cae84>7.5 - Key Vault Integration</h1><h2 id=deploy-azure-key-vault-extension-to-azure-arc-enabled-ubuntu-server-and-use-a-key-vault-managed-certificate-with-nginx>Deploy Azure Key Vault Extension to Azure Arc enabled Ubuntu server and use a Key Vault managed certificate with Nginx</h2><p>The scenario will show you how to onboard the <a href=https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/key-vault-linux>Azure Key Vault</a> extension on an Azure Arc enabled server, and then use a certificate managed by Azure Key Vault to secure web traffic with TLS on a web server.</p><p>In this guide, we will focus on securing an Ubuntu web server. The only prerequisite you need to complete for this scenario is an existing Azure Arc enabled server running Ubuntu 18.04 (other Ubuntu releases may also work but have not been tested).</p><blockquote><p><strong>Note: This guide assumes you already deployed an Ubuntu server that is running on-premises or in other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li></ul><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p>As mentioned, this guide starts at the point where you already deployed and connected VMs or bare-metal servers to Azure Arc. For this scenario, as can be seen in the screenshots below, we will be using an Amazon Web Services (AWS) EC2 instance that has been already connected to Azure Arc and is visible as a resource in Azure.</p><p><img src=./01.png alt="Screenshot showing EC2 instance in AWS console"></p><p><img src=./02.png alt="Screenshot showing Azure Arc enabled server"></p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li></ul><h2 id=create-an-azure-key-vault-and-a-new-self-signed-certificate>Create an Azure Key Vault and a new self-signed certificate</h2><p>First, we will create a new Azure resource group, Azure Key Vault and a self-signed certificate from an Az CLI.</p><ul><li><p>Create a new resource group to hold the key vault resource.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az group create --name &lt;name <span style=color:#204a87;font-weight:700>for</span> your resource group&gt; --location &lt;location <span style=color:#204a87;font-weight:700>for</span> your resource group&gt;
</code></pre></div><p><img src=./03.png alt="Screenshot of creating a resource group from Az CLI"></p></li><li><p>Create a new key vault resource. Note that key vault names must be globally unique.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az keyvault create --name &lt;name <span style=color:#204a87;font-weight:700>for</span> your keyvault&gt; --location &lt;location&gt; --resource-group &lt;name of your resource group&gt;
</code></pre></div><p><img src=./04.png alt="Screenshot of creating a keyvault from Az CLI"></p></li><li><p>Create a new self-signed certificate with keyvault.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az keyvault certificate create --vault-name arckeyvault1 -n cert1 -p <span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>az keyvault certificate get-default-policy<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
</code></pre></div><p><img src=./05.png alt="Screenshot of creating a self-signed certificate from Az CLI"></p></li></ul><h2 id=install-and-configure-nginx-on-your-azure-arc-enabled-ubuntu-server>Install and configure Nginx on your Azure Arc enabled Ubuntu server</h2><p>We will use the Azure Custom Script extension on your Azure Arc enabled server to install and configure an Nginx web server. Before installing Nginx, we must open the right inbound ports on our AWS EC2 instance&rsquo;s security group. Then we will deploy an ARM template that will use the custom script extension to install Nginx.</p><ul><li><p>Navigate to your EC2 instance on the AWS cloud console and open the &ldquo;allow-all-sg&rdquo; security group.</p><p><img src=./06.png alt="Screenshot of an EC2 instance in AWS cloud console"></p></li><li><p>Click on the &ldquo;Inbound&rdquo; tab of the security group and then click &ldquo;Edit&rdquo;.</p><p><img src=./07.png alt="Screenshot of a security group in AWS cloud console"></p><p><img src=./08.png alt="Screenshot of a security group in AWS cloud console"></p></li><li><p>Click &ldquo;Add Rule&rdquo; and add HTTP and HTTPS rules, keeping all the default seeings as seen in the screenshot. Click Save.</p><p><img src=./09.png alt="Screenshot of adding a security group rule in AWS cloud console"></p><p><img src=./10.png alt="Screenshot of added a security group rule in AWS cloud console"></p></li><li><p>Configure Key Vault to allow Azure Arc enabled server to access secrets</p><ul><li><p>Navigate to your Key Vault and open the &ldquo;Access Policies&rdquo; blade</p><p><img src=./11.png alt="Screenshot of the Access Policies blade in a Key Vault"></p></li><li><p>Click &ldquo;Add access policy&rdquo; and in the dropdown for &ldquo;Secret Permissions&rdquo; check Get and List.</p><p><img src=./12.png alt="Screenshot showing &ldquo;Add access policy&rdquo; for Key Vault"></p></li><li><p>Next to &ldquo;Select principal&rdquo; Click &ldquo;None selected&rdquo; and search for your Azure Arc enabled server machine name and select it.</p><p><img src=./13.png alt="Screenshot showing &ldquo;Add access policy&rdquo; for Key Vault"></p></li><li><p>Click &ldquo;Save&rdquo; to commit the changes.</p><p><img src=./14.png alt="Screenshot showing &ldquo;Add access policy&rdquo; for Key Vault"></p></li></ul></li><li><p>Use Custom Script extension to install Nginx and configure Key Vault extension</p><ul><li><p>Modify the values of nginx-keyvault.parameters.json for the following parameters with values for your environment:</p><p><img src=./15.png alt="Screenshot showing example parameters for nginx-keyvault.parameters.json"></p></li><li><p>Run the deployment with the following Az CLI command.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az deployment group create --resource-group &lt;name of your resource group&gt; --template-file nginx-keyvault.json --parameters nginx-keyvault.parameters.json
</code></pre></div><p><img src=./16.png alt="Screenshot showing ARM deployment completing"></p></li></ul></li><li><p>SSH into your Azure Arc enabled server to update the Nginx configuration to use the certificate.</p><p><img src=./17.png alt="Screenshot showing SSH into Azure Arc enabled server"></p><ul><li><p>Open <em>/etc/nginx/conf.d/ssl.conf</em> using nano or your preferred text editor.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>nano /etc/nginx/conf.d/ssl.conf
</code></pre></div><p><img src=./18.png alt="Screenshot showing nano editing /etc/nginx/conf.d/ssl.conf"></p></li><li><p>Edit the file updating the following lines with the correct path to your certificate.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>ssl_certificate /etc/ssl/certs/&lt;your cert filename&gt;<span style=color:#000;font-weight:700>;</span>
ssl_certificate_key /etc/ssl/certs/&lt;your cert filename&gt;<span style=color:#000;font-weight:700>;</span>
</code></pre></div><p>Your filename will be of the format &lsquo;keyvault_name&rsquo;.&lsquo;certificate_name&rsquo; (all lowercase). For example, if your Key Vault is named &ldquo;myKeyVault&rdquo; and your certificate is named &ldquo;cert1&rdquo; then your filename will be &ldquo;mykeyvault.cert1&rdquo;. See the screens below for a before and after example.</p><p><img src=./19.png alt="Screenshot showing unedited /etc/nginx/conf.d/ssl.conf"></p><p><img src=./20.png alt="Screenshot showing edited /etc/nginx/conf.d/ssl.conf"></p></li><li><p>Restart the nginx service by running the following command.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>sudo service nginx restart
</code></pre></div><p><img src=./21.png alt="Screenshot showing restart of nginx service"></p></li></ul></li><li><p>Test everything by accessing your Nginx webserver over HTTPS. Open a browser and enter &ldquo;https://XX.XX.XX.XX&rdquo; into the address bar, replacing the placeholder with the public IP address of your server.</p><ul><li><p>You should see a warning describing that your connection is not private or secure. The message will vary depending on which web browser you use.</p><p><img src=./22.png alt="Screenshot showing accessing web server in browser"></p></li><li><p>If you are using Microsoft Edge, you can validate that your certificate is being used by comparing the certificate thumbprint reported in the browser with your certificate thumbprint in Key Vault, as seen in the screenshots below. Click the &ldquo;Not secure&rdquo; box to the left of the address bar, then click &ldquo;Certificate (not valid)&rdquo; and open the &ldquo;Details&rdquo; tab to view the thumbprint.</p><p><img src=./23.png alt="Screenshot showing browser certificate thumbprint"></p><p><img src=./24.png alt="Screenshot showing browser certificate thumbprint"></p><p><img src=./25.png alt="Screenshot showing Key Vault certificate thumbprint"></p></li></ul></li></ul><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><ul><li><p>Delete the key vault resource by running the following command in Az CLI.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az keyvault delete --name &lt;name of your keyvault&gt;
</code></pre></div><p><img src=./26.png alt="Screenshot showing Key Vault being deleted from Az CLI"></p></li><li><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-eda68bcba3c1263207b730fff996799e>7.6 - Security Center</h1><h2 id=connect-azure-arc-enabled-servers-to-azure-security-center>Connect Azure Arc enabled servers to Azure Security Center</h2><p>The following README will guide you on how to onboard an Azure Arc enabled server on to <a href=https://docs.microsoft.com/en-us/azure/security-center/>Azure Security Center (ASC)</a>, so you can start collecting security-related configurations as well as event logs to recommend actions and improve your overall Azure security posture.</p><p>In this guide, you will enable and configure Azure Security Center Standard tier on your Azure subscription, which will provide you with advanced threat protection (ATP) and detection capabilities. To complete this process you will:</p><ul><li><p>Setup a Log Analytics Workspace where logs and events will be aggregated for analysis.</p></li><li><p>Assign Security Center’s default security policies.</p></li><li><p>Review Azure Security Center&rsquo;s recommendations.</p></li><li><p>Apply recommended configurations on Azure Arc enabled servers using the <em><strong>Quick Fix</strong></em> remediations.</p></li></ul><blockquote><p><strong>Note: This guide assumes you already deployed VMs or servers that are running on-premises or other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p>As mentioned, this guide starts at the point where you already deployed and connected VMs or bare-metal servers to Azure Arc. For this scenario, as can be seen in the screenshots below, we will be using a Google Cloud Platform (GCP) instance that has been already connected to Azure Arc and is visible as a resource in Azure.</p><p><img src=./01.png alt="Screenshot of Azure Portal showing Azure Arc enabled server"></p><p><img src=./02.png alt="Screenshot of Azure Portal showing Azure Arc enabled server detail"></p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI</a>. Azure CLI should be running version 2.7** or later. Use <code>az --version</code> to check your current installed version.</p></li><li><p>Create Azure service principal (SP)</p><p>To connect a VM or bare-metal server to Azure Arc, Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a>.</strong></p></blockquote></li></ul><h2 id=onboarding-azure-security-center>Onboarding Azure Security Center</h2><ul><li><p>Data collected by Azure Security Center is stored in a Log Analytics workspace. You can either use the default one created by ASC or a custom one created by you. If you want to create a dedicated workspace, you can automate the deployment by editing the ARM template <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/securitycenter/arm/log_analytics-template.parameters.json>parameters file</a>, provide a name and location for your workspace:</p><p><img src=./03.png alt="Screenshot showing Azure ARM template"></p></li><li><p>To deploy the ARM template, navigate to the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/securitycenter/arm>deployment folder</a> and run the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>  az deployment group create --resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --template-file &lt;The *log_analytics-template.json* template file location&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --parameters &lt;The *log_analytics-template.parameters.json* template file location&gt;
</code></pre></div></li><li><p>If you are going for an user-defined workspace, you should instruct Security Center to use it instead of the default one, use the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>  az security workspace-setting create --name default <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --target-workspace <span style=color:#4e9a06>&#39;/subscriptions/&lt;Your subscription ID&gt;/resourceGroups/&lt;Name of the Azure resource group&gt;/providers/Microsoft.OperationalInsights/workspaces/&lt;Name of the Log Analytics Workspace&gt;&#39;</span>
</code></pre></div></li><li><p>Select the Azure Security Center tier. The Free tier is enabled on all your Azure subscriptions by default and will provide continuous security assessment and actionable security recommendations. In this guide, you will use the Standard tier for Virtual Machines that extends these capabilities providing unified security management and threat protection across your hybrid cloud workloads. To enable the Standard tier of Azure Security Center for VMs run the command below:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az security pricing create -n VirtualMachines --tier <span style=color:#4e9a06>&#39;standard&#39;</span>
</code></pre></div></li><li><p>Now you need to assign the default Security Center policy initiative. ASC makes its security recommendations based on policies. There is an specific initiative that groups Security Center policies with the definition ID &lsquo;1f3afdf9-d0c9-4c3d-847f-89da613e70a8&rsquo;. The command below will assign the ASC initiative to your subscription:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az policy assignment create --name <span style=color:#4e9a06>&#39;ASC Default &lt;Your subscription ID&gt;&#39;</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--scope <span style=color:#4e9a06>&#39;/subscriptions/&lt;Your subscription ID&gt;&#39;</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--policy-set-definition <span style=color:#4e9a06>&#39;1f3afdf9-d0c9-4c3d-847f-89da613e70a8&#39;</span>
</code></pre></div></li></ul><h2 id=azure-arc-and-azure-security-center-integration>Azure Arc and Azure Security Center Integration</h2><p>Now that you have successfully onboard ASC, you will get recommendations to help you protect your resources, including your Azure Arc enabled servers. ASC will then periodically analyze the security state of your Azure resources to identify potential security vulnerabilities.</p><ul><li><p>In the &ldquo;Compute & apps&rdquo; section under &ldquo;VM and Servers&rdquo;, ASC will provide you with an overview of all the discovered security recommendations for your VMs and computers, including Azure VMs, Azure Classic VMs, servers and <strong>Azure Arc Machines</strong>.</p><p><img src=./04.png alt="Screenshot showing Azure Security Center compute and apps"></p></li><li><p>On the Azure Arc enabled servers, ASC will provide a recommendation to install the Log Analytics agent. In addition, each recommendation will include:</p><ul><li><p>A short description of what is being recommended.</p></li><li><p>A Secure Score impact, in this case, with a status of <em>High</em>.</p></li><li><p>The remediation steps to carry out in order to implement the recommendation. For specific recommendations, like this one, you will also get a <em><strong>Quick Fix</strong></em> that enables you to quickly remediate a recommendation on multiple resources.</p><p><img src=./05.png alt="Screenshot showing ASC recommendation on Azure Arc enabled server"></p><p><img src=./06.png alt="Screenshot showing ASC recommendation to install Log Analytics"></p></li></ul></li><li><p>This remediation <em><strong>Quick Fix</strong></em> is using an ARM template to deploy the Microsoft Monitoring Agent extension on the Azure Arc machine.</p><p><img src=./07.png alt="Screenshot showing ASC Quick Fix ARM template"></p></li><li><p>You can trigger the remediation with the ARM template from the Azure Security Center dashboard, by selecting the Log Analytics Workspace used for ASC and clicking on &ldquo;Remediate 1 resource&rdquo;.</p><p><img src=./08.png alt="Screenshot showing triggering of remediation step of ASC"></p></li><li><p>After you apply the recommendation on the Azure Arc enabled server the resource will be now marked as healthy.</p><p><img src=./09.png alt="Screenshot showing healthy Azure Arc enabled server"></p></li></ul><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><ul><li><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></p></li><li><p>Remove the Log Analytics workspace by executing the following script in AZ CLI. Provide the workspace name you used when creating the Log Analytics Workspace.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az monitor log-analytics workspace delete --resource-group &lt;Name of the Azure resource group&gt; --workspace-name &lt;Log Analytics Workspace Name&gt; --yes
</code></pre></div></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-50dbeacfd1099752a6b9ae86ffca6b70>7.7 - Azure Sentinel</h1><h2 id=connect-azure-arc-enabled-servers-to-azure-sentinel>Connect Azure Arc enabled servers to Azure Sentinel</h2><p>The following README will guide you on how to onboard Azure Arc enabled servers on to <a href=https://docs.microsoft.com/es-es/azure/sentinel/>Azure Sentinel</a>, so you can start collecting security-related events and start correlating them with other data sources.</p><p>In this guide, you will enable and configure Azure Sentinel on your Azure subscription. To complete this process you will:</p><ul><li><p>Setup a Log Analytics Workspace where logs and events will be aggregated for analysis and correlation.</p></li><li><p>Enable Azure Sentinel on the workspace.</p></li><li><p>Onboard Azure Arc enabled servers on Sentinel by using the extension management feature and Azure Policies.</p></li></ul><blockquote><p><strong>Note: This guide assumes you already deployed VMs or servers that are running on-premises or other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p>As mentioned, this guide starts at the point where you already deployed and connected VMs or bare-metal servers to Azure Arc. For this scenario, as can be seen in the screenshots below, we will be using a Google Cloud Platform (GCP) instance that has been already connected to Azure Arc and is visible as a resource in Azure.</p><p><img src=./01.png alt="Screenshot showing Azure Portal with Azure Arc enabled server"></p><p><img src=./02.png alt="Screenshot showing Azure Portal with Azure Arc enabled server detail"></p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI</a>. Azure CLI should be running version 2.7** or later. Use <code>az --version</code> to check your current installed version.</p></li><li><p>Create Azure service principal (SP).</p><p>To connect a VM or bare-metal server to Azure Arc, Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a>.</strong></p></blockquote></li></ul><h2 id=onboarding-azure-sentinel>Onboarding Azure Sentinel</h2><p>Azure Sentinel uses the Log Analytics agent to collect Windows and Linux server&rsquo;s log files and forwards them to Azure Sentinel, the data collected is stored in a Log Analytics workspace. Since you cannot use the default workspace created by Azure Security Center (ASC), a custom one is required and you could have raw events and alerts for ASC within the same custom workspace as Sentinel.</p><ul><li><p>You will need to create a dedicated Log Analytics workspace and enable the Azure Sentinel solution on the top of it. For that you can use this <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/azuresentinel/arm/sentinel-template.json>ARM template</a> that will create a new Log Analytics Workspace and define the Azure Sentinel solution and enable it for the workspace. To automate the deployment edit the ARM template <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/azuresentinel/arm/sentinel-template.parameters.json>parameters file</a>, provide a name and location for your workspace:</p><p><img src=./03.png alt="Screenshot showing Azure ARM template"></p></li><li><p>To deploy the ARM template, navigate to the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/azuresentinel/arm>deployment folder</a> and run the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az deployment group create --resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--template-file &lt;The *sentinel-template.json* template file location&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--parameters &lt;The *sentinel-template.parameters.json* template file location&gt;
</code></pre></div></li></ul><p>For example:</p><p><img src=./04.png alt="Screenshot showing az deployment group create command"></p><h2 id=azure-arc-enabled-vms-onboarding-on-azure-sentinel>Azure Arc enabled VMs onboarding on Azure Sentinel</h2><p>Once you have deployed Azure Sentinel on your Log Analytics workspace, you will need to connect data sources to it.</p><p>There are connectors for Microsoft services, third party solutions from the Security products ecosystem. You can also use Common Event Format (CEF), Syslog, or REST-API to connect your data sources with Azure Sentinel.</p><p>For servers and VMs, you can install the Microsoft Monitoring Agent (MMA) agent or the Sentinel agent which collects the logs and forwards them to Azure Sentinel. You can deploy the agent in multiple ways by leveraging Azure Arc:</p><ul><li>Using <strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/day2/arc_vm_extension_mma_arm/>Extension Management</a></strong></li></ul><p>This feature in Azure Arc enabled servers allows you to deploy the MMA agent VM extensions to a non-Azure Windows and/or Linux VMs. You can use the Azure Portal, Azure CLI, an ARM template as well as PowerShell script to manage extension deployment to Azure Arc enabled servers.</p><ul><li>Setting up <strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/day2/arc_policies_mma/>Azure Policies</a></strong></li></ul><p>Using this approach, you will assign an Azure Policy to audit if the Azure Arc enabled Server has the MMA agent installed. If the agent is not installed, you will use the Extensions feature to automatically deploy it to the VM using a Remediation task, an enrollment experience that compares to Azure VMs.</p><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><ul><li><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></p></li><li><p>Remove the Log Analytics workspace by executing the following script in AZ CLI. Provide the workspace name you used when creating the Log Analytics Workspace.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az monitor log-analytics workspace delete --resource-group &lt;Name of the Azure resource group&gt; --workspace-name &lt;Log Analytics Workspace Name&gt; --yes
</code></pre></div></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-16e609be239099590da0beb9af17b4c5>7.8 - Update Management</h1><h2 id=enable-update-management-on-azure-arc-enabled-servers>Enable Update Management on Azure Arc enabled servers</h2><p>The scenario will show you how to onboard Azure Arc enabled servers to <a href=https://docs.microsoft.com/en-us/azure/automation/update-management/overview>Update Management</a>, so that you can manage operating system updates for your Azure Arc enabled servers running Windows or Linux.</p><p>In this guide, you will create and configure an Azure Automation account and Log Analytics workspace to support Update Management for Azure Arc enabled servers by doing the following:</p><ul><li><p>Setup a new Log Analytics Workspace and Azure Automation account.</p></li><li><p>Enable Update Management on Azure Arc enabled servers.</p></li></ul><blockquote><p><strong>Note: This guide assumes you already deployed VMs or servers that are running on-premises or other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p>As mentioned, this guide starts at the point where you already deployed and connected VMs or bare-metal servers to Azure Arc. For this scenario, as can be seen in the screenshots below, we will be using an Amazon Web Services (AWS) EC2 instance that has been already connected to Azure Arc and is visible as a resource in Azure.</p><p><img src=./01.png alt="Screenshot showing AWS cloud console with EC2 instance"></p><p><img src=./02.png alt="Screenshot showing Azure Portal with Azure Arc enabled server"></p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI</a>. Azure CLI should be running version 2.14 or later. Use <code>az --version</code> to check your current installed version.</p></li></ul><h2 id=configuring-update-management>Configuring Update Management</h2><p>Update Management uses the Log Analytics agent to collect Windows and Linux server log files and the data collected is stored in a Log Analytics workspace.</p><ul><li><p>You will need to create a Log Analytics workspace. For that you can use this <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/updateManagement/law-template.json>ARM template</a> that will create a new Log Analytics Workspace and define the Update Management solution and enable it for the workspace.</p></li><li><p>First, create a new resource group for the Log Analytics workspace by running the below command, replacing the values in brackets with your own.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az group create --name &lt;Name <span style=color:#204a87;font-weight:700>for</span> your resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--location &lt;Location <span style=color:#204a87;font-weight:700>for</span> your resources&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--tags <span style=color:#4e9a06>&#34;Project=jumpstart_azure_arc_servers&#34;</span>
</code></pre></div><p><img src=./03.png alt="Screenshot showing az group create being run"></p></li><li><p>Next, edit the ARM template <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/updateManagement/law-template.parameters.json>parameters file</a>, providing a name for your Log Analytics workspace, a location, and a name for your Azure Automation account. You also need to supply the name of your Azure Arc enabled server, and the name of the resource group that contains the Arc enabled server as shown in the example below:</p><p><img src=./04.png alt="Screenshot showing Azure ARM template"></p></li><li><p>To deploy the ARM template, navigate to the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/updateManagement>deployment folder</a> and run the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az deployment group create --resource-group &lt;Name of the Azure resource group you created&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    --template-file law-template.json <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    --parameters law-template.parameters.json
</code></pre></div><p><img src=./05.png alt="Screenshot showing az deployment group create being run"></p></li><li><p>When the deployment is complete, you should be able to see the resource group with your Log Analytics workspace, automation account and Update Management solution from the Azure Portal. Drilling into the Log Analytics workspace Solutions blade should show the Update Management solution.</p><p><img src=./06.png alt="Screenshot showing Azure Portal with Log Analytics workspace"></p></li></ul><h2 id=confirm-that-the-update-management-solution-is-deployed-on-your-azure-arc-enabled-server>Confirm that the Update Management solution is deployed on your Azure Arc enabled server</h2><ul><li><p>Click on the Solutions blade of the Log Analytics workspace and then click the Updates solution from the list to check the progress of the Update Management assessment.</p><p><img src=./13.png alt="Screenshot showing Solutions Blade of Log Analytics workspace"></p></li><li><p>It may take several hours for Update Management to collect enough data to show an assessment for your VM. In the screen below we can see the assessment is being performed.</p><p><img src=./14.png alt="Screenshot showing Update Management overview blade"></p></li><li><p>When the assessment is complete, you will see an option to &ldquo;View summary&rdquo; on the Update Management blade.</p><p><img src=./15.png alt="Screenshot showing Update Management with summary"></p></li><li><p>Click View Summary and then click again to drill into the Update Management assessment. In the below example we can see there are updates missing on our Azure Arc enabled server.</p><p><img src=./16.png alt="Screenshot showing"></p></li></ul><h2 id=schedule-an-update>Schedule an Update</h2><p>Now that we have configured the Update Management solution, we can deploy updates on a set schedule for our Azure Arc enabled server.</p><ul><li><p>Navigate to the Automation Account we created previously and click on the Update Management blade as shown in the screenshot below. You should see your Azure Arc enabled server listed.</p><p><img src=./18.png alt="Screenshot showing Azure Automation account"></p></li><li><p>From the above screen, click &ldquo;Schedule update deployment&rdquo;. On the next screen, select the Operating System that your Azure Arc enabled server is using, and then select &ldquo;Machines to update&rdquo; as shown below.</p><p><img src=./19.png alt="Screenshot showing scheduling an update with Update Management"></p></li><li><p>From the &ldquo;Type&rdquo; dropdown, select &ldquo;Machines&rdquo; and then select your server and click Ok.</p><p><img src=./20.png alt="Screenshot showing scheduling an update with Update Management"></p></li><li><p>Click Schedule Settings and then provide a desired schedule.</p><p><img src=./21.png alt="Screenshot showing scheduling an update with Update Management"></p><p><img src=./22.png alt="Screenshot showing scheduling an update with Update Management"></p></li><li><p>Finally, provide a name for your Update deployment and then click Create.</p><p><img src=./23.png alt="Screenshot showing scheduling an update with Update Management"></p></li><li><p>From the Automation Account Update Management blade, you should be able to see your scheduled Update deployment from the Deployment Schedules tab.
<img src=./24.png alt="Screenshot showing scheduled update"></p></li></ul><p>The Update Management solution will now update your Azure Arc enabled servers in the deployment window based on the schedule you defined. There is a lot more you can do with <a href=https://docs.microsoft.com/en-us/azure/automation/update-management/overview>Update Management</a> that is outside the scope of this scenario. Review the <a href=https://docs.microsoft.com/en-us/azure/automation/update-management/overview>documentation</a> for more information.</p><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><ul><li><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></p></li><li><p>Delete the resource group.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az group delete --name &lt;Name of your resource group&gt;
</code></pre></div><p><img src=./26.png alt="Screenshot showing az group delete being run"></p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8683b32c638509b66c8a8d83ce8e8dd1>8 - Scaled Deployment</h1><div class=lead>The scenarios in this section are designed to provide scaled onboarding experience to Azure Arc of virtual machines deployed in various platforms and existing environments.</div></div><div class=td-content><h1 id=pg-3232c0522cad0a1e82efd628559a3a01>8.1 - VMware vSphere Windows Server VMs</h1><h2 id=scaled-onboarding-of-vmware-vsphere-windows-server-vms-to-azure-arc-using-vmware-powercli>Scaled onboarding of VMware vSphere Windows Server VMs to Azure Arc using VMware PowerCLI</h2><p>The following README will guide you on how to use the provided <a href=https://code.vmware.com/web/dp/tool/vmware-powercli/>VMware PowerCLI</a> script so you can perform an automated scaled deployment of the &ldquo;Azure Arc Connected Machine Agent&rdquo; in multiple VMware vSphere virtual machines and as a result, onboard these VMs as Azure Arc enabled servers.</p><p>This guide assumes you already have an exiting inventory of VMware Virtual Machines and will leverage the PowerCLI PowerShell module to automate the onboarding process of the VMs to Azure Arc.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p>Install VMware PowerCLI</p><blockquote><p><strong>Note: This guide was tested with the latest version of PowerCLI as of date (12.0.0) but earlier versions are expected to work as well</strong></p></blockquote><ul><li><p>Supported PowerShell Versions - VMware PowerCLI 12.0.0 is compatible with the following PowerShell versions:</p><ul><li>Windows PowerShell 5.1</li><li>PowerShell 7</li><li>Detailed installation instructions can be found <a href=https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.esxi.install.doc/GUID-F02D0C2D-B226-4908-9E5C-2E783D41FE2D.html>here</a> but the easiest way is to use the VMware.PowerCLI module from the PowerShell Gallery using the below command.</li></ul><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#204a87>Install-Module</span> <span style=color:#000>-Name</span> <span style=color:#000>VMware</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>PowerCLI</span>
</code></pre></div></li></ul></li><li><p>To be able to read the VM inventory from vCenter as well as invoke a script on the VM OS-level, the following permissions are needed:</p><ul><li><p><a href=https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.security.doc/GUID-6A952214-0E5E-4CCF-9D2A-90948FF643EC.html>VirtualMachine.GuestOperations</a> user account</p></li><li><p>VMware vCenter Server user assigned with a <a href=https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.security.doc/GUID-93B962A7-93FA-4E96-B68F-AE66D3D6C663.html>&ldquo;Read Only Role&rdquo;</a></p></li></ul></li><li><p>Create Azure service principal (SP)</p><p>To connect the VMware vSphere virtual machine to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li></ul><h2 id=automation-flow>Automation Flow</h2><p>Below you can find the automation flow for this scenario:</p><ol><li><p>User edit the <em>vars.ps1</em> PowerCLI script</p></li><li><p>The <em>scale_deploy.ps1</em> script execution will initiate authentication against vCenter and will scan the targeted VM folder where Azure Arc candidate VMs are located and will copy both the <em>vars.ps1</em> and the <em>install_arc_agent.ps1</em> PowerCLI scripts to VM Windows OS located in <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/vmware/scaled_deployment/powercli/windows>this folder</a> to each VM in that VM folder.</p></li><li><p>The <em>install_arc_agent.ps1</em> PowerCLI script will run on the VM guest OS and will install the &ldquo;Azure Arc Connected Machine Agent&rdquo; in order to onboard the VM to Azure Arc</p></li></ol><h2 id=pre-deployment>Pre-Deployment</h2><p>To demonstrate the before & after for this scenario, the below screenshots shows a dedicated, empty Azure Resources Group, a vCenter VM folder with candidate VMs and the &ldquo;Apps & features&rdquo; view in Windows showing no agent is installed.</p><p><img src=./01.png alt="An empty Azure resource group"></p><p><img src=./02.png alt="Vanilla VMware vSphere VM with no Azure Arc agent"></p><p><img src=./03.png alt="Vanilla VMware vSphere VM with no Azure Arc agent"></p><h2 id=deployment>Deployment</h2><p>Before running the PowerCLI script, you must set the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/vmware/scaled_deployment/powercli/windows/vars.ps1>environment variables</a> which will be used by the <em>install_arc_agent.ps1</em> script. These variables are based on the Azure service principal you&rsquo;ve just created, your Azure subscription and tenant, and your VMware vSphere credentials and data.</p><ul><li><p>Retrieve your Azure subscription ID and tenant ID using the <code>az account list</code> command</p></li><li><p>Use the Azure service principal ID and password created in the prerequisites section</p></li></ul><p><img src=./04.png alt="Export environment variables"></p><ul><li><p>From the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/vmware/scaled_deployment/powercli/windows><em>azure_arc_servers_jumpstart\vmware\scaled_deploy\powercli\windows</em></a> folder, open PowerShell session as an Administrator and run the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/vmware/scaled_deployment/powercli/windows/scale_deploy.ps1><em>scale_deploy.ps1</em></a> script.</p><p><img src=./05.png alt="scale_deploy PowerShell script"></p><p><img src=./06.png alt="scale_deploy PowerShell script"></p><p><img src=./07.png alt="scale_deploy PowerShell script"></p></li><li><p>Upon completion, the VM will have the &ldquo;Azure Arc Connected Machine Agent&rdquo; installed as well as the Azure resource group populated with the new Azure Arc enabled servers.</p><p><img src=./08.png alt="Azure Arc Connected Machine Agent installed"></p><p><img src=./09.png alt="New Azure Arc enabled servers in an Azure resource group"></p><p><img src=./10.png alt="New Azure Arc enabled servers in an Azure resource group"></p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6505de5782967c0e0060cc85e4dbaf9a>8.2 - VMware vSphere Linux VMs</h1><h2 id=scaled-onboarding-of-vmware-vsphere-linux-vms-to-azure-arc-using-vmware-powercli>Scaled onboarding of VMware vSphere Linux VMs to Azure Arc using VMware PowerCLI</h2><p>The following README will guide you on how to use the provided <a href=https://code.vmware.com/web/dp/tool/vmware-powercli/>VMware PowerCLI</a> script so you can perform an automated scaled deployment of the &ldquo;Azure Arc Connected Machine Agent&rdquo; in multiple VMware vSphere virtual machines and as a result, onboard these VMs as Azure Arc enabled servers.</p><p>This guide assumes you already have an exiting inventory of VMware Virtual Machines and will leverage the PowerCLI PowerShell module to automate the onboarding process of the VMs to Azure Arc.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p>Install VMware PowerCLI</p><blockquote><p><strong>Note: This guide was tested with the latest version of PowerCLI as of date (12.0.0) but earlier versions are expected to work as well</strong></p></blockquote><ul><li><p>Supported PowerShell Versions - VMware PowerCLI 12.0.0 is compatible with the following PowerShell versions:</p><ul><li>Windows PowerShell 5.1</li><li>PowerShell 7</li><li>Detailed installation instructions can be found <a href=https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.esxi.install.doc/GUID-F02D0C2D-B226-4908-9E5C-2E783D41FE2D.html>here</a> but the easiest way is to use the VMware.PowerCLI module from the PowerShell Gallery using the below command.</li></ul><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#204a87>Install-Module</span> <span style=color:#000>-Name</span> <span style=color:#000>VMware</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>PowerCLI</span>
</code></pre></div></li></ul></li><li><p>To be able to read the VM inventory from vCenter as well as invoke a script on the VM OS-level, the following permissions are needed:</p><ul><li><p><a href=https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.security.doc/GUID-6A952214-0E5E-4CCF-9D2A-90948FF643EC.html>VirtualMachine.GuestOperations</a> user account</p></li><li><p>VMware vCenter Server user assigned with a <a href=https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.security.doc/GUID-93B962A7-93FA-4E96-B68F-AE66D3D6C663.html>&ldquo;Read Only Role&rdquo;</a></p></li></ul></li><li><p>Create Azure service principal (SP)</p><p>To connect the VMware vSphere virtual machine to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li></ul><h2 id=automation-flow>Automation Flow</h2><p>Below you can find the automation flow for this scenario:</p><ol><li><p>User edit the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/vmware/scaled_deployment/powercli/linux/vars.ps1><em>vars.ps1</em></a> PowerCLI script</p></li><li><p>Upon execution of the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/vmware/scaled_deployment/powercli/linux/scale_deploy.ps1><em>scale_deploy.ps1</em></a> PowerShell script:</p><ul><li><p>The script will auto-generate a <em>vars.sh</em> shell script with the user&rsquo;s Azure environment variables.</p></li><li><p>The script execution will initiate authentication against vCenter and will scan the targeted VM folder where Azure Arc candidate VMs are located and will copy both the auto-generated <em>vars.sh</em> and the <em>install_arc_agent.sh</em> shell scripts to VM Linux OS located in <em>/vmware/scaled_deploy/powercli/linux</em> to each VM in that VM folder.</p></li></ul></li><li><p>The <em>install_arc_agent.sh</em> shell script will run on the VM guest OS and will install the &ldquo;Azure Arc Connected Machine Agent&rdquo; in order to onboard the VM to Azure Arc</p></li></ol><h2 id=pre-deployment>Pre-Deployment</h2><p>To demonstrate the before & after for this scenario, the below screenshots shows a dedicated, empty Azure resource group, a vCenter VM folder with candidate VMs and the <em>/var/opt/</em> directory showing no agent is installed.</p><p><img src=./01.png alt="An empty Azure resource group"></p><p><img src=./02.png alt="Vanilla VMware vSphere VM with no Azure Arc agent"></p><p><img src=./03.png alt="Vanilla VMware vSphere VM with no Azure Arc agent"></p><h2 id=deployment>Deployment</h2><p>Before running the PowerCLI script, you must set the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/vmware/scaled_deployment/powercli/linux/vars.ps1>environment variables</a> which will be used by the <em>install_arc_agent.sh</em> script. These variables are based on the Azure service principal you&rsquo;ve just created, your Azure subscription and tenant, and your VMware vSphere credentials and data.</p><ul><li><p>Retrieve your Azure subscription ID and tenant ID using the <code>az account list</code> command</p></li><li><p>Use the Azure service principal ID and password created in the prerequisites section</p><p><img src=./04.png alt="Export environment variables"></p></li><li><p>From the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/vmware/scaled_deployment/powercli/linux/><em>azure_arc_servers_jumpstart\vmware\scaled_deploy\powercli\linux</em></a> folder, open PowerShell session as an Administrator and run the <em>scale_deploy.ps1</em> script.</p><p><img src=./05.png alt="scale_deploy PowerShell script"></p><p><img src=./06.png alt="scale_deploy PowerShell script"></p><p><img src=./07.png alt="scale_deploy PowerShell script"></p></li><li><p>Upon completion, the VM will have the &ldquo;Azure Arc Connected Machine Agent&rdquo; installed as well as the Azure resource group populated with the new Azure Arc enabled servers.</p><p><img src=./08.png alt="Azure Arc Connected Machine Agent installed"></p><p><img src=./09.png alt="New Azure Arc enabled servers in an Azure resource group"></p><p><img src=./10.png alt="New Azure Arc enabled servers in an Azure resource group"></p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-c74d41f4582660136f72b61a4784fa21>8.3 - AWS EC2 dynamic inventory with Ansible</h1><h2 id=dynamic-scaled-onboarding-of-aws-ec2-instances-to-azure-arc-using-ansible>Dynamic scaled onboarding of AWS EC2 instances to Azure Arc using Ansible</h2><p>The following README will guide you on how to automatically perform scaled onboarding of AWS EC2 instances to Azure Arc by using <a href=https://www.ansible.com/>Ansible</a>.</p><p>This guide assumes that you have a basic understanding of Ansible. A basic Ansible playbook and configuration is provided that uses the <a href=https://docs.ansible.com/ansible/latest/collections/amazon/aws/aws_ec2_inventory.html>amazon.aws.aws_ec2</a> plugin for dynamic loading of EC2 server inventory.</p><p>This guide can be used even if you do not already have an existing Ansible test environment and includes a Terraform plan that will create a sample AWS EC2 server inventory comprised of four (4) Windows Server 2019 servers and four (4) Ubuntu servers along with a basic CentOS 7 Ansible control server with a simple configuration.</p><p><em><strong>Warning</strong></em>: <em>The provided Ansible sample workbook uses WinRM with password authentication and HTTP to configure Windows-based servers. This is not advisable for production environments. If you are planning to use Ansible with Windows hosts in a production environment then you should use <a href=https://docs.microsoft.com/en-us/troubleshoot/windows-client/system-management-components/configure-winrm-for-https>WinRM over HTTPS</a> with a certificate.</em></p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li><li><p><a href=https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/>Generate SSH Key</a> (or use existing ssh key)</p></li><li><p><a href=https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/>Create free AWS account</a></p></li><li><p><a href=https://learn.hashicorp.com/terraform/getting-started/install.html>Install Terraform >=0.13</a></p></li><li><p>Create Azure service principal (SP)</p><p>To connect the AWS virtual machine to Azure Arc, an Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcAWS&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcAWS&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcAWS&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a></strong></p></blockquote></li></ul><h2 id=create-an-aws-identity>Create an AWS identity</h2><p>In order for Terraform to create resources in AWS, we will need to create a new AWS IAM role with appropriate permissions and configure Terraform to use it.</p><ul><li><p>Login to the <a href=https://console.aws.amazon.com>AWS management console</a></p></li><li><p>After logging in, click the &ldquo;Services&rdquo; dropdown in the top left. Under &ldquo;Security, Identity, and Compliance&rdquo; select &ldquo;IAM&rdquo; to access the <a href=https://console.aws.amazon.com/iam/home>Identity and Access Management page</a></p><p><img src=./19.png alt="Screenshot of AWS cloud console"></p><p><img src=./20.png alt="Screenshot of IAM AWS cloud console"></p></li><li><p>Click on &ldquo;Users&rdquo; from the left menu and then click on &ldquo;Add user&rdquo; to create a new IAM user.</p><p><img src=./21.png alt="Screenshot of new user creation in AWS cloud console"></p></li><li><p>On the &ldquo;Add User&rdquo; screen, name the user &ldquo;terraform&rdquo; and select the &ldquo;Programmatic Access&rdquo; checkbox then click &ldquo;Next&rdquo;</p><p><img src=./22.png alt="Screenshot of new user creation in AWS cloud console"></p></li><li><p>On the next &ldquo;Set Permissions&rdquo; screen, select &ldquo;Attach existing policies directly&rdquo; and then check the box next to AmazonEC2FullAccess as seen in the screenshot then click &ldquo;Next&rdquo;</p><p><img src=./23.png alt="Screenshot showing new user in AWS cloud console"></p></li><li><p>On the tags screen, assign a tag with a key of &ldquo;azure-arc-demo&rdquo; and click &ldquo;Next&rdquo; to proceed to the Review screen.</p><p><img src=./24.png alt="Screenshot showing tags in AWS cloud console"></p></li><li><p>Double check that everything looks correct and click &ldquo;Create user&rdquo; when ready.</p><p><img src=./25.png alt="Screenshot showing creating a user in AWS cloud console"></p></li><li><p>After the user is created, you will see the user&rsquo;s Access key ID and Secret access key. Copy these values down before clicking the Close button. In the screen below, you can see an example of what this should look like. Once you have these keys, you will be able to use them with Terraform to create AWS resources.</p><p><img src=./26.png alt="Screenshot showing created user in AWS cloud console"></p></li></ul><h2 id=option-1--creating-a-sample-aws-server-inventory-and-ansible-control-server-using-terraform-and-onboarding-the-servers-to-azure-arc>Option 1- Creating a sample AWS server inventory and Ansible control server using Terraform and onboarding the servers to Azure Arc</h2><p><strong>Note: If you already have an existing AWS server inventory and Ansible server, skip below to Option 2.</strong></p><h3 id=configure-terraform>Configure Terraform</h3><p>Before executing the Terraform plan, you must export the environment variables which will be used by the plan. These variables are based on your Azure subscription and tenant, the Azure service principal, and the AWS IAM user and keys you just created.</p><ul><li><p>Retrieve your Azure subscription ID and tenant ID using the <code>az account list</code> command.</p></li><li><p>The Terraform plan creates resources in both Microsoft Azure and AWS. It then executes a script on an AWS EC2 virtual machine to install Ansible and all necessary artifacts. This Terraform plan requires certain information about your AWS and Azure environments which it accesses using environment variables. Edit <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/scaled_deployment/ansible/terraform/scripts/vars.sh><em>scripts/vars.sh</em></a> and update each of the variables with the appropriate values.</p><ul><li>TF_VAR_subscription_id=Your Azure subscription ID</li><li>TF_VAR_client_id=Your Azure service principal app id</li><li>TF_VAR_client_secret=Your Azure service principal password</li><li>TF_VAR_tenant_id=Your Azure tenant ID</li><li>AWS_ACCESS_KEY_ID=AWS access key</li><li>AWS_SECRET_ACCESS_KEY=AWS secret key</li></ul></li><li><p>From your shell, navigate to the <em>azure_arc_servers_jumpstart/aws/scaled_deployment/ansible/terraform</em>) directory of the cloned repo.</p></li><li><p>Export the environment variables you edited by running <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/scaled_deployment/ansible/terraform/scripts/vars.sh><em>scripts/vars.sh</em></a> with the source command as shown below. Terraform requires these to be set for the plan to execute properly.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#204a87>source</span> ./scripts/vars.sh
</code></pre></div></li><li><p>Make sure your SSH keys are available in <em>~/.ssh</em> and named <em>id_rsa.pub</em> and <em>id_rsa</em>. If you followed the ssh-keygen guide above to create your key then this should already be setup correctly. If not, you may need to modify <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/scaled_deployment/ansible/terraform/aws_infra.tf><em>aws_infra.tf</em></a> to use a key with a different path.</p></li><li><p>Run the <code>terraform init</code> command which will download the required Terraform providers.</p><p><img src=./01.png alt="Screenshot of terraform init being run"></p></li></ul><h3 id=deploy-server-infrastructure>Deploy server infrastructure</h3><ul><li><p>From the <em>azure_arc_servers_jumpstart/aws/scaled_deployment/ansible/terraform</em> directory, run <code>terraform apply --auto-approve</code> and wait for the plan to finish. Upon successful completion, you will have four (4) Windows Server 2019 servers, four (4) Ubuntu servers, and one (1) CentOS 7 Ansible control server.</p></li><li><p>Open the AWS console and verify you can see the created servers.</p><p><img src=./02.png alt="Screenshot of AWS console showing EC2 instances"></p></li></ul><h3 id=run-the-ansible-playbook-to-onboard-the-aws-ec2-instances-as-azure-arc-enabled-servers>Run the Ansible playbook to onboard the AWS EC2 instances as Azure Arc enabled servers</h3><ul><li><p>When the Terraform plan completes, it will display the public IP of the Ansible control server in an output variable named <em>ansible_ip</em>. SSH into the Ansible server by running the <code>ssh centos@XX.XX.XX.XX</code> where XX.XX.XX.XX is substituted for your Ansible server&rsquo;s IP address.</p><p><img src=./03.png alt="Screenshot of SSH into Ansible control server"></p></li><li><p>Change directory to the <em>ansible</em> directory by running <code>cd ansible</code>. This folder contains the sample Ansible configuration and the playbook we will use to onboard the servers to Azure Arc.</p><p><img src=./04.png alt="Screenshot of Ansible config folder in shell"></p></li><li><p>The aws_ec2 Ansible plugin requires AWS credentials to dynamically read your AWS server inventory. We will export these as environment variables. Run the commands below, replacing the values for AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY with AWS credentials you created earlier.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#204a87>export</span> <span style=color:#000>AWS_ACCESS_KEY_ID</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#204a87>export</span> <span style=color:#000>AWS_SECRET_ACCESS_KEY</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXX&#34;</span>
</code></pre></div></li><li><p>Replace the placeholder values for Azure tenant ID and subscription id in the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/scaled_deployment/ansible/terraform/ansible_config/group_vars/all.yml>group_vars/all.yml</a> with the appropriate values for your environment.</p><p><img src=./09.png alt="Screenshot of variables YAML file"></p></li><li><p>Run the Ansible playbook by executing the following command, substituting your Azure service principal id and service principal secret.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>ansible-playbook arc_agent.yml -i ansible_plugins/inventory_uswest2_aws_ec2.yml --extra-vars <span style=color:#4e9a06>&#39;{&#34;service_principal_id&#34;: &#34;XXXXXXX-XXXXX-XXXXXXX&#34;, &#34;service_principal_secret&#34;: &#34;XXXXXXXXXXXXXXXXXXXXXXXX&#34;}&#39;</span>
</code></pre></div><p>If the playbook run is successful, you should see output similar to the below screenshot.</p><p><img src=./05.png alt="Screenshot of Ansible playbook being run"></p></li><li><p>Open Azure Portal and navigate to the Arc-AWS-Demo resource group. You should see the Azure Arc enabled servers listed.</p><p><img src=./06.png alt="Screenshot of Azure Portal showing onboard Azure Arc enabled servers"></p></li></ul><h3 id=clean-up-environment-by-deleting-resources>Clean up environment by deleting resources</h3><p>To delete all the resources you created as part of this demo use the <code>terraform destroy --auto-approve</code> command as shown below.</p><p><img src=./07.png alt="Screenshot of terraform destroy being run"></p><h2 id=option-2---onboarding-an-existing-aws-server-inventory-to-azure-arc-using-your-own-ansible-control-server>Option 2 - Onboarding an existing AWS server inventory to Azure Arc using your own Ansible control server</h2><blockquote><p><strong>Note: If you do not have an existing AWS server inventory and Ansible server, navigate back to Option 1</strong></p></blockquote><h3 id=review-provided-ansible-configuration-and-playbook>Review provided Ansible configuration and playbook</h3><p>Navigate to the <em>ansible_config</em> directory and review the provided configuration. The provided configuration contains a basic <em>ansible.cfg</em> file. This file enables the <a href=https://docs.ansible.com/ansible/latest/collections/amazon/aws/aws_ec2_inventory.html>amazon.aws.aws_ec2</a> Ansible plugin which dynamically loads your server inventory by using an AWS IAM role. Ensure that the IAM role you are using has sufficient privileges to access the inventory you wish to onboard.</p><p><img src=./08.png alt="Screenshot showing Ansible config file"></p><p>The file <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/aws/scaled_deployment/ansible/terraform/ansible_config/ansible_plugins/inventory_uswest2_aws_ec2.yml>inventory_uswest2_aws_ec2.yml</a> configures the aws_ec2 plugin to pull inventory from uswest-2 region and group assets by applied tags. Adjust this file as needed to support onboarding your server inventory (e.g., change region, or change groups or filters).</p><p>The files in <em><strong>./ansible_config/group_vars</strong></em> should be adjusted to provide the credentials you wish to use to onboard various ansible host groups.</p><p>When you have adjusted the provided config to support your environment, run the Ansible playbook by executing the following command, substituting your Azure service principal id and service principal secret.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>ansible-playbook arc_agent.yml -i ansible_plugins/inventory_uswest2_aws_ec2.yml --extra-vars <span style=color:#4e9a06>&#39;{&#34;service_principal_id&#34;: &#34;XXXXXXX-XXXXX-XXXXXXX&#34;, &#34;service_principal_secret&#34;: &#34;XXXXXXXXXXXXXXXXXXXXXXXX&#34;}&#39;</span>
</code></pre></div><p>If the playbook run is successful, you should see output similar to the below screenshot.</p><p><img src=./05.png alt="Screenshot showing Ansible playbook being run"></p><p>Open Azure Portal and navigate to the Arc-Aws-Demo resource group. You should see the Azure Arc enabled servers listed.</p><p><img src=./06.png alt="Screenshot showing Azure Portal with Azure Arc enabled servers"></p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/stack><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/lujiansong/azure_arc><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 The Docsy Authors All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank>Privacy Policy</a></small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.b5fc1b29d2465835844254bd4d804738eaf24c0cec53009b4c6899989be55a47.js integrity="sha256-tfwbKdJGWDWEQlS9TYBHOOryTAzsUwCbTGiZmJvlWkc=" crossorigin=anonymous></script></body></html>