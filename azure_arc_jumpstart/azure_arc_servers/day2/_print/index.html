<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.80.0"><link rel=canonical type=text/html href=/azure_arc_jumpstart/azure_arc_servers/day2/><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Unified Operations Use Cases | Goldydocs</title><meta property="og:title" content="Unified Operations Use Cases"><meta property="og:description" content="Once you have server resources projected into Azure with Azure Arc, you can start to use native Azure tooling to manage the servers as native Azure resources. The following scenarios show examples of using Azure management tools such as resource tags, Azure Policy, Log Analytics, and more with Azure Arc enabled servers."><meta property="og:type" content="website"><meta property="og:url" content="/azure_arc_jumpstart/azure_arc_servers/day2/"><meta property="og:site_name" content="Goldydocs"><meta itemprop=name content="Unified Operations Use Cases"><meta itemprop=description content="Once you have server resources projected into Azure with Azure Arc, you can start to use native Azure tooling to manage the servers as native Azure resources. The following scenarios show examples of using Azure management tools such as resource tags, Azure Policy, Log Analytics, and more with Azure Arc enabled servers."><meta name=twitter:card content="summary"><meta name=twitter:title content="Unified Operations Use Cases"><meta name=twitter:description content="Once you have server resources projected into Azure with Azure Arc, you can start to use native Azure tooling to manage the servers as native Azure resources. The following scenarios show examples of using Azure management tools such as resource tags, Azure Policy, Log Analytics, and more with Azure Arc enabled servers."><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-00000000-0','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preload href=/scss/main.min.4aec00cbc82dae02258a2ba135990358146339f666dc47346f0f1e49d7a6fa42.css as=style><link href=/scss/main.min.4aec00cbc82dae02258a2ba135990358146339f666dc47346f0f1e49d7a6fa42.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zM197.0804 232.033c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zM197.0839 232.0372c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zM197.0839 232.0372c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zM197.0804 177.6188c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zM197.0839 177.623c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zM197.0839 177.623c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zM197.5309 286.4723c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zM197.5344 286.4765c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zM197.5344 286.4765c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zM197.0804 340.5784c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zM197.0839 340.5826c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zM197.0839 340.5826c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Goldydocs</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/no/>Norsk</a>
<a class=dropdown-item href=/fa/>فارسی</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="print();return false;">Click here to print</a>.</p><p><a href=/azure_arc_jumpstart/azure_arc_servers/day2/>Return to the regular view of this page</a>.</p></div><h1 class=title>Unified Operations Use Cases</h1><div class=lead>Once you have server resources projected into Azure with Azure Arc, you can start to use native Azure tooling to manage the servers as native Azure resources. The following scenarios show examples of using Azure management tools such as resource tags, Azure Policy, Log Analytics, and more with Azure Arc enabled servers.</div><ul><li>1: <a href=#pg-f662c3c6424f0e3f7be88762438f027f>Inventory Tagging</a></li><ul></ul><li>2: <a href=#pg-caccbcbc963315fae066659de1818715>Monitoring Agent Extension</a></li><ul></ul><li>3: <a href=#pg-8a7b8f2b3e4ec67d3a0eede84e3eae93>Custom Script Extension</a></li><ul></ul><li>4: <a href=#pg-4bcf5ee34563db9860f2594f7c5d636a>Azure Policy</a></li><ul></ul><li>5: <a href=#pg-1960d9874e7502df863af9a46f8cae84>Key Vault Integration</a></li><ul></ul><li>6: <a href=#pg-eda68bcba3c1263207b730fff996799e>Security Center</a></li><ul></ul><li>7: <a href=#pg-50dbeacfd1099752a6b9ae86ffca6b70>Azure Sentinel</a></li><ul></ul><li>8: <a href=#pg-16e609be239099590da0beb9af17b4c5>Update Management</a></li><ul></ul></ul><div class=content></div></div><div class=td-content><h1 id=pg-f662c3c6424f0e3f7be88762438f027f>1 - Inventory Tagging</h1><h2 id=apply-inventory-tagging-to-azure-arc-enabled-servers>Apply inventory tagging to Azure Arc enabled servers</h2><p>The following README will guide you on how to use Azure Arc enabled servers to provide server inventory management capabilities across hybrid multi-cloud and on-premises environments.</p><p>Azure Arc enabled servers allows you to manage your Windows and Linux machines hosted outside of Azure on your corporate network or other cloud provider, similarly to how you manage native Azure virtual machines. When a hybrid machine is connected to Azure, it becomes a connected machine and is treated as a resource in Azure. Each connected machine has a Resource ID, is managed as part of a resource group inside a subscription, and benefits from standard Azure constructs such as Azure Policy and applying tags. The ability to easily organize and manage server inventory using Azure as a management engine greatly reduces administrative complexity and provides a consistent strategy for hybrid and multi-cloud environments.</p><p>In this guide, we will use <a href=https://docs.microsoft.com/en-us/azure/governance/resource-graph/first-query-portal>Resource Graph Explorer</a> and <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">AZ CLI</a> to demonstrate tagging and querying server inventory across multiple clouds from a single pane of glass in Azure.</p><blockquote><p><strong>Note: This guide assumes you already deployed VMs or servers that are running on-premises or other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li></ul><h2 id=verify-that-your-arc-connected-servers-are-ready-for-tagging>Verify that your Arc connected servers are ready for tagging</h2><p>We will be using Resource Graph Explorer during this exercise to query and view resources in Azure.</p><ul><li><p>Enter &ldquo;Resource Graph Explorer&rdquo; in the top search bar in the Azure portal and select it.</p><p><img src=./01.png alt="Screenshot showing Resource Graph Explorer in Azure Portal"></p></li><li><p>In the query window, enter the following query and then click &ldquo;Run Query&rdquo;:</p><pre><code class=language-kusto data-lang=kusto>Resources
| where type =~ 'Microsoft.HybridCompute/machines'
</code></pre></li><li><p>If you have correctly created Azure Arc enabled servers, they should be listed in the Results pane of Resource Graph Explorer. You can also view the Azure Arc enabled serves from the Azure portal.</p><p><img src=./02.png alt="Screenshot showing Resource Graph Explorer query"></p><p><img src=./10.png alt="Screenshot showing Azure Portal with Azure Arc enabled server"></p><p><img src=./11.png alt="Screenshot showing Azure Arc enabled server details"></p></li></ul><h2 id=create-a-basic-azure-tag-taxonomy>Create a basic Azure tag taxonomy</h2><ul><li><p>Open AZ CLI and run the following commands to create a basic taxonomy structure that will allow us to easily query and report on where our server resources are hosted (i.e., Azure vs AWS vs GCP vs On-premises). For more guidance on building out a tag taxonomy please review the <a href=https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/decision-guides/resource-tagging/>Resource naming and tagging decision guide</a>.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az tag create --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span>
az tag add-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;Azure&#34;</span>
az tag add-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;AWS&#34;</span>
az tag add-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;GCP&#34;</span>
az tag add-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;On-premises&#34;</span>
</code></pre></div><p><img src=./05.png alt="Screenshot showing output of az tag create"></p></li></ul><h2 id=tag-arc-resources>Tag Arc resources</h2><p>Now that we have created a basic taxonomy structure, we will apply tags to our Azure Arc enabled server resources. In this guide, we will demonstrate tagging resources in both AWS and GCP. If you only have resources in one of these providers, you can skip to the appropriate section for AWS or GCP.</p><h3 id=tag-arc-connected-aws-ubuntu-ec2-instance>Tag Arc-connected AWS Ubuntu EC2 instance</h3><ul><li><p>In AZ CLI, run the following commands to apply the &ldquo;Hosting Platform : AWS&rdquo; tag to your AWS Azure Arc enabled servers.</p><blockquote><p><strong>Note: If you connected your AWS EC2 instances using a method other than the one described in <a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>this tutorial</a>, then you will need to adjust the values for <code>awsResourceGroup</code> and <code>awsMachineName</code> to match values specific to your environment.</strong></p></blockquote><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#204a87>export</span> <span style=color:#000>awsResourceGroup</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;arc-aws-demo&#34;</span>
<span style=color:#204a87>export</span> <span style=color:#000>awsMachineName</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;arc-aws-demo&#34;</span>
<span style=color:#204a87>export</span> <span style=color:#000>awsMachineResourceId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>az resource show --resource-group <span style=color:#000>$awsResourceGroup</span> --name <span style=color:#000>$awsMachineName</span> --resource-type <span style=color:#4e9a06>&#34;Microsoft.HybridCompute/machines&#34;</span> --query id<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
<span style=color:#204a87>export</span> <span style=color:#000>awsMachineResourceId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span><span style=color:#204a87>echo</span> <span style=color:#000>$awsMachineResourceId</span> <span style=color:#000;font-weight:700>|</span> tr -d <span style=color:#4e9a06>&#34;\&#34;&#34;</span> <span style=color:#000;font-weight:700>|</span> tr -d <span style=color:#4e9a06>&#39;\r&#39;</span><span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
az resource tag --ids <span style=color:#000>$awsMachineResourceId</span> --tags <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;AWS&#34;</span>
</code></pre></div><p><img src=./07.png alt="Screenshot showing output of az resource tag"></p></li></ul><h3 id=tag-arc-connected-gcp-ubuntu-server>Tag Arc-connected GCP Ubuntu server</h3><ul><li><p>In AZ CLI, run the following commands to apply the &ldquo;Hosting Platform : GCP&rdquo; tag to your GCP Azure Arc enabled servers.</p><blockquote><p><strong>Note: If you connected your GCP instances using a method other than the one described in <a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>this tutorial</a>, then you will need to adjust the values for <code>gcpResourceGroup</code> and <code>gcpMachineName</code> to match values specific to your environment.</strong></p></blockquote><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#204a87>export</span> <span style=color:#000>gcpResourceGroup</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;arc-gcp-demo&#34;</span>
<span style=color:#204a87>export</span> <span style=color:#000>gcpMachineName</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;arc-gcp-demo&#34;</span>
<span style=color:#204a87>export</span> <span style=color:#000>gcpMachineResourceId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>az resource show --resource-group <span style=color:#000>$gcpResourceGroup</span> --name <span style=color:#000>$gcpMachineName</span> --resource-type <span style=color:#4e9a06>&#34;Microsoft.HybridCompute/machines&#34;</span> --query id<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
<span style=color:#204a87>export</span> <span style=color:#000>gcpMachineResourceId</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span><span style=color:#204a87>echo</span> <span style=color:#000>$gcpMachineResourceId</span> <span style=color:#000;font-weight:700>|</span> tr -d <span style=color:#4e9a06>&#34;\&#34;&#34;</span> <span style=color:#000;font-weight:700>|</span> tr -d <span style=color:#4e9a06>&#39;\r&#39;</span><span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
az resource tag --resource-group <span style=color:#000>$gcpResourceGroup</span> --ids <span style=color:#000>$gcpMachineResourceId</span> --tags <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;GCP&#34;</span>
</code></pre></div><p><img src=./08.png alt="Screenshot showing output of az resource tag"></p></li></ul><h2 id=query-resources-by-tag-using-resource-graph-explorer>Query resources by tag using Resource Graph Explorer</h2><p>Now that we have applied tags to our resources that are hosted in multiple clouds, we can use Resource Graph Explorer to query them and get insight into our multi-cloud landscape.</p><ul><li><p>In the query window, enter the following query:</p><pre><code class=language-kusto data-lang=kusto>Resources
| where type =~ 'Microsoft.HybridCompute/machines'
| where isnotempty(tags['Hosting Platform'])
| project name, location, resourceGroup, tags
</code></pre><p><img src=./04.png alt="Screenshot showing Resource Graph Explorer query"></p></li><li><p>Click &ldquo;Run Query&rdquo; and then select the Formatted Results toggle. If done correctly, you should see all Azure Arc enabled servers and their assigned &ldquo;Hosting Platform&rdquo; tag values.</p><p><img src=./06.png alt="Screenshot showing results of Resource Graph Explorer query"></p></li><li><p>We can also view the tags on the projected servers from Azure Portal.</p><p><img src=./12.png alt="Screenshot showing tags on Azure Arc enabled server"></p><p><img src=./13.png alt="Screenshot showing tags on Azure Arc enabled server"></p></li></ul><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><ul><li><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></p></li><li><p>Remove tags created as part of this guide by executing the following script in AZ CLI.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az tag remove-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;Azure&#34;</span>
az tag remove-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;AWS&#34;</span>
az tag remove-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;GCP&#34;</span>
az tag remove-value --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span> --value <span style=color:#4e9a06>&#34;On-premises&#34;</span>
az tag create --name <span style=color:#4e9a06>&#34;Hosting Platform&#34;</span>
</code></pre></div></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-caccbcbc963315fae066659de1818715>2 - Monitoring Agent Extension</h1><h2 id=deploy-monitoring-agent-extension-on-azure-arc-linux-and-windows-servers-using-extension-management>Deploy Monitoring Agent Extension on Azure Arc Linux and Windows servers using Extension Management</h2><p>The following README will guide you on how to manage extensions on Azure Arc enabled servers. Virtual machine extensions are small applications that provide post-deployment configuration and automation tasks such as software installation, anti-virus protection, or a mechanism to run a custom script.</p><p>Azure Arc enabled servers, enables you to deploy Azure VM extensions to non-Azure Windows and Linux VMs, giving you a hybrid or multi-cloud management experience that levels to Azure VMs.</p><p>You can use the Azure portal, Azure CLI, an ARM template, PowerShell script or Azure policies to manage the extension deployment to Azure Arc enabled servers, both Linux and Windows. In this guide, you will use an ARM template deploy the Microsoft Monitoring Agent (MMA) to your servers so they are onboard on Azure services that leverage this agent: Azure Monitor, Azure Security Center, Azure Sentinel, etc.</p><blockquote><p><strong>Note: This guide assumes you already deployed VMs or servers that are running on-premises or other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><p>Please review the <a href=https://docs.microsoft.com/en-us/azure/azure-monitor/insights/vminsights-enable-overview#supported-operating-systems>Azure Monitor supported OS documentation</a> and ensure that the VMs you will use for this exercise are supported. For Linux VMs, check both the Linux distribution and kernel to ensure you are using a supported configuration.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p>As mentioned, this guide starts at the point where you already deployed and connected VMs or servers to Azure Arc. In the screenshots below you can see a GCP server has been connected with Azure Arc and is visible as a resource in Azure.</p><p><img src=./01.png alt="Screenshot Azure Arc enabled server on resource group"></p><p><img src=./02.png alt="Screenshot Azure Arc enabled server connected status"></p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI</a>. Azure CLI should be running version 2.7** or later. Use <code>az --version</code> to check your current installed version.</p></li><li><p>Create Azure Service Principal (SP)</p><p>To connect a VM or bare-metal server to Azure Arc, Azure service principal assigned with the &ldquo;contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a>.</strong></p></blockquote></li><li><p>You will also need to have a Log Analytics workspace deployed. You can automate the deployment by editing the ARM template <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/extensions/arm/log_analytics-template.parameters.json>parameters file</a> and provide a name and location for your workspace.</p><p><img src=./03.png alt="Screenshot ARM template parameters file"></p><p>To deploy the ARM template, navigate to the &ldquo;deployment folder&rdquo; <em><strong>../extensions/arm</strong></em> and run the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az deployment group create --resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--template-file &lt;The *log_analytics-template.json* template file location&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--parameters &lt;The *log_analytics-template.parameters.json* template file location&gt;
</code></pre></div></li></ul><h2 id=azure-arc-enabled-servers-microsoft-monitoring-agent-extension-deployment>Azure Arc enabled servers Microsoft Monitoring Agent Extension Deployment</h2><ul><li><p>Edit the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/extensions/arm/mma-template.parameters.json><em>extensions parameters file</em></a></p><p><img src=./04.png alt="Screenshot ARM template parameters file"></p></li><li><p>To match your configuration you will need to provide:</p><ul><li><p>The VM name as it is registered in Azure Arc.</p><p><img src=./05.png alt="Screenshot Azure Arc enabled server computer name"></p></li><li><p>The location of the resource group where you registered the Azure Arc enabled server.</p><p><img src=./06.png alt="Screenshot Azure Arc enabled server location"></p></li><li><p>Information of the Log Analytics workspace you previously created: workspace ID and key. These parameters will be used to configure the MMA agent. You can get this information by going to your Log Analytics workspace and under &ldquo;Settings&rdquo; select &ldquo;Agent management&rdquo;.</p><p><img src=./07.png alt="Screenshot Azure Arc enabled server Agent management"></p><p><img src=./08.png alt="Screenshot workspace configuration"></p></li></ul></li><li><p>Choose the ARM template that matches your operating system, for <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/extensions/arm/mma-template-windows.json><em>Windows</em></a> and <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/extensions/arm/mma-template-linux.json><em>Linux</em></a>, deploy the template by running the following command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az deployment group create --resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--template-file &lt;The *mma-template.json* template file location&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--parameters &lt;The *mma-template.parameters.json* template file location&gt;
</code></pre></div></li><li><p>Once the template has completed its run, you should see an output as follows:</p><p><img src=./09.png alt="Screenshot ARM template execution output"></p></li><li><p>You will have the Microsoft Monitoring agent deployed on your Windows or Linux system and reporting to the Log Analytics workspace that you have selected. You can verify by going back to the &ldquo;Agents management&rdquo; section of your workspace and choosing either Windows or Linux, you should see now an additional connected VM.</p><p><img src=./10.png alt="Screenshot Windows connected agents"></p><p><img src=./11.png alt="Screenshot Linux connected agents"></p></li></ul><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p><ul><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></p></li><li><p>Remove the Log Analytics workspace by executing the following command in AZ CLI. Provide the workspace name you used when creating the Log Analytics Workspace.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az monitor log-analytics workspace delete --resource-group &lt;Name of the Azure resource group&gt; --workspace-name &lt;Log Analytics Workspace Name&gt; --yes
</code></pre></div></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8a7b8f2b3e4ec67d3a0eede84e3eae93>3 - Custom Script Extension</h1><h2 id=deploy-custom-script-extension-on-azure-arc-linux-and-windows-servers-using-extension-management>Deploy Custom Script Extension on Azure Arc Linux and Windows servers using Extension Management</h2><p>The following README will guide you on how to execute custom scripts on Azure Arc enabled servers by using Virtual Machine extensions. Virtual machine extensions are small applications that provide post-deployment configuration and automation tasks such as software installation, anti-virus protection, or a mechanism to run a custom script.</p><p>You can use the Azure portal, Azure CLI, an ARM template, PowerShell or Linux Shell script, or Azure policies to manage the extension deployment to Azure Arc enabled servers. In this guide, we will use an ARM template to deploy the custom script extension. This extension downloads and executes scripts on virtual machines and it is useful for post deployment configuration, software installation, or any other configuration or management tasks.</p><blockquote><p><strong>Note: This guide assumes you already deployed VMs or servers that are running on-premises or other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p>As mentioned, this guide starts at the point where you already deployed and connected VMs or servers to Azure Arc. In the screenshots below you can see a GCP server has been connected with Azure Arc and is visible as a resource in Azure.</p><p><img src=./01.png alt="Screenshot Azure Arc enabled server on resource group"></p><p><img src=./02.png alt="Screenshot Azure Arc enabled server on connected status"></p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI</a>. Azure CLI should be running version 2.7** or later. Use <code>az --version</code> to check your current installed version.</p></li><li><p>Create Azure Service Principal (SP)</p><p>To connect a VM or bare-metal server to Azure Arc, Azure service principal assigned with the &ldquo;contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a>.</strong></p></blockquote></li><li><p>In order to demonstrate the custom script extension, we will use the below Linux and Windows scripts.</p><ul><li><a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/scripts/custom_script_linux.sh><em>Linux</em></a>: The script will modify the message of the day (MOTD) on the operating system.</li><li><a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/scripts/custom_script_windows.ps1><em>Windows</em></a>: The script will install Windows Terminal, Microsoft Edge, 7zip and Visual Studio Code <a href=https://chocolatey.org/>Chocolaty</a> packages on the VM.</li></ul></li></ul><h2 id=azure-arc-enabled-servers-custom-script-extension-deployment>Azure Arc enabled servers Custom Script Extension Deployment</h2><ul><li><p>Edit the extensions parameters file for <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/extensions/arm/customscript-templatewindows.parameters.json><em>Windows</em></a> or for <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/extensions/arm/customscript-templatelinux.parameters.json><em>Linux</em></a></p><p><img src=./03.png alt="Screenshot parameters file"></p></li><li><p>To match your environment configuration, you will need to provide the following information:</p><ul><li><p>The VM name as it is registered in Azure Arc.</p><p><img src=./04.png alt="Screenshot Azure Arc enabled server machine name"></p></li><li><p>The location of the resource group where you registered the Azure Arc enabled server.</p><p><img src=./05.png alt="Screenshot Azure region"></p></li><li><p>A public Uri for the script that you would like to run on the servers, in this case use the URL for the script in raw format.</p><ul><li>For Windows: <a href=https://raw.githubusercontent.com/microsoft/azure_arc/main/azure_arc_servers_jumpstart/scripts/custom_script_windows.ps1>Public Uri</a></li><li>For Linux: <a href=https://raw.githubusercontent.com/microsoft/azure_arc/main/azure_arc_servers_jumpstart/scripts/custom_script_linux.sh>Public Uri</a></li></ul></li><li><p>To run either script, use the below commands:</p><ul><li><p>Windows:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#000>powershell</span> <span style=color:#000>-ExecutionPolicy</span> <span style=color:#000>Unrestricted</span> <span style=color:#ce5c00;font-weight:700>-File</span> <span style=color:#000>custom_script_windows</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ps1</span>
</code></pre></div></li><li><p>Linux:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./custom_script_linux.sh
</code></pre></div></li></ul></li></ul></li><li><p>To deploy the ARM template for Linux or Windows, navigate to the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/extensions/arm>deployment folder</a> and run the below command with the templates that match your operating system:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>az deployment group create --resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--template-file &lt;The *customscript-template.json* template file location <span style=color:#204a87;font-weight:700>for</span> Linux or Windows&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--parameters &lt;The *customscript-template.parameters.json* template file location&gt;
</code></pre></div></li><li><p>Once the template deployment has completed it&rsquo;s run, you should see an output as follows:</p><p><img src=./06.png alt="Screenshot ARM template output"></p></li><li><p>To verify a successful deployment on the Azure Arc enabled server, in the Azure Portal, by clicking on &ldquo;Extensions&rdquo; settings. You should see the Custom Script extension installed.</p><p><img src=./07.png alt="Screenshot custom script extension"></p></li><li><p>Another way to verify successful custom script execution is by connecting to the VMs and verifying that the operating system has been configured.</p><ul><li><p>For the Linux VM, use SSH to connect the VM and check out the message of the day which was customized by the script:</p><p><img src=./08.png alt="Screenshot message of the day changed"></p></li><li><p>For the Windows VM, use RDP to connect the VM and verify that the additional software has been installed: Microsoft Edge, 7zip and Visual Studio Code.</p><p><img src=./09.png alt="Screenshot additional software installed"></p></li></ul></li></ul><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-4bcf5ee34563db9860f2594f7c5d636a>4 - Azure Policy</h1><h2 id=deploy-monitoring-agent-extension-to-azure-arc-linux-and-windows-servers-using-azure-policy>Deploy Monitoring Agent Extension to Azure Arc Linux and Windows servers using Azure Policy</h2><p>The following README will guide you on how to use Azure Arc enabled servers to assign Azure Policies to VMs outside of Azure, whether they are on-premises or other clouds. With this feature you can now use Azure Policy to audit settings in the operating system of an Azure Arc enabled server, if a setting is not compliant you can also trigger a remediation task.</p><p>In this case, you will assign a policy to audit if the Azure Arc connected machine has the (Microsoft Monitoring Agent) MMA agent installed, if not, you will use the extensions feature to automatically deploy it to the VM, an enrollment experience that levels to Azure VMs. This approach can be used to make sure all your servers are onboard to services such as Azure Monitor, Azure Security Center, Azure Sentinel, etc.</p><p>You can use the Azure Portal, an ARM template or PowerShell script to assign policies to Azure subscriptions or resource groups. In this guide, you will use an ARM template to assign built-in policies.</p><blockquote><p><strong>Note: This guide assumes you already deployed VMs or servers that are running on-premises or other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><p>Please review the <a href=https://docs.microsoft.com/en-us/azure/azure-monitor/insights/vminsights-enable-overview#supported-operating-systems>Azure Monitor supported OS documentation</a> and ensure that the VMs you will use for this guide are supported. For Linux VMs, check both the Linux distribution and kernel to ensure you are using a supported configuration.</p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p>As mentioned, this guide starts at the point where you already deployed and connected VMs or servers to Azure Arc. In the screenshots below we can see a GCP server has been connected with Azure Arc and is visible as a resource in Azure.</p><p><img src=./01.png alt="Screenshot Azure Arc enabled server on resource group"></p><p><img src=./02.png alt="Screenshot Azure Arc enabled server connected status"></p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI</a>. Azure CLI should be running version 2.7** or later. Use <code>az --version</code> to check your current installed version.</p></li><li><p>Create Azure service principal (SP)</p><p>To connect a VM or bare-metal server to Azure Arc, Azure service principal assigned with the &ldquo;contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a>.</strong></p></blockquote></li><li><p>You will also need to have a Log Analytics workspace deployed. You can automate the deployment by editing the ARM template <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/policies/arm/log_analytics-template.parameters.json>parameters file</a>, provide a name and location for your workspace.</p><p><img src=./03.png alt="Screenshot ARM template parameters file"></p><p>To deploy the ARM template, navigate to the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/policies/arm>deployment folder</a> and run the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>  az deployment group create --resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --template-file &lt;The *log_analytics-template.json* template file location&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --parameters &lt;The *log_analytics-template.parameters.json* template file location&gt;
</code></pre></div></li></ul><h2 id=azure-policies-on-azure-arc-connected-machines>Azure Policies on Azure Arc connected machines</h2><ul><li><p>Now that you have all the prerequisites set, you can assign policies to our Arc connected machines. Edit the <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/policies/arm/policy.json>parameters file</a> to provide your subscription ID as well as the Log Analytics workspace.</p><p><img src=./04.png alt="Screenshot ARM template parameter file"></p><p>To start the deployment, use the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az policy assignment create --name <span style=color:#4e9a06>&#39;Enable Azure Monitor for VMs&#39;</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--scope <span style=color:#4e9a06>&#39;/subscriptions/&lt;Your subscription ID&gt;/resourceGroups/&lt;Name of the Azure resource group&gt;&#39;</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--policy-set-definition <span style=color:#4e9a06>&#39;55f3eceb-5573-4f18-9695-226972c6d74a&#39;</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>-p &lt;The *policy.json* template file location&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--assign-identity --location &lt;Azure Region&gt;
</code></pre></div><p>The flag <em>policy-set-definition</em> points to the initiative &ldquo;Enable Azure Monitor&rdquo; definition ID.</p></li><li><p>Once the initiative is assigned, it takes around 30 minutes for the assignment to be applied to the defined scope. After those 30 minutes, Azure Policy will start the evaluation cycle against the Azure Arc connected machine and recognize it as &ldquo;Non-compliant&rdquo; (since it still does not have the Log Analytics Agent configuration deployed). To check this, go to the Azure Arc connected Machine under the Policies section.</p><p><img src=./05.png alt="Screenshot Azure Policy non-compliant"></p></li><li><p>Now, you will assign a remediation task to the non-compliant resource to put into a compliant state.</p><p><img src=./06.png alt="Screenshot Azure Policy remediation task"></p></li><li><p>Under &lsquo;Policy to remediate&rsquo; choose &lsquo;[Preview] Deploy Log Analytics Agent to Linux Azure Arc machines&rsquo; and select &lsquo;Remediate&rsquo;. This remediation task is instructing Azure Policy to run the deployIfNotExists effect and use the Azure Arc extension management capabilities to deploy the Log Analytics agent on the VM</p><p><img src=./07.png alt="Screenshot Azure Policy remediation task"></p></li><li><p>Once you have assigned remediation task, the policy will be evaluated again and show that the server on GCP is compliant and that the Microsoft Monitoring Agent extension is installed on the Azure Arc machine.</p><p><img src=./08.png alt="Screenshot remediation task configuration"></p><p><img src=./09.png alt="Screenshot Azure Policy compliant status"></p></li></ul><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><p>Remove the Azure Policy assignment by executing the following script in Azure CLI.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az policy assignment delete --name <span style=color:#4e9a06>&#39;Enable Azure Monitor for VMs&#39;</span> --resource-group &lt;resource_group&gt;
</code></pre></div><p>Remove the Log Analytics workspace by executing the following script in Azure CLI. Provide the workspace name you used when creating the Log Analytics workspace.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az monitor log-analytics workspace delete --resource-group &lt;Name of the Azure resource group&gt; --workspace-name &lt;Log Analytics workspace Name&gt; --yes
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-1960d9874e7502df863af9a46f8cae84>5 - Key Vault Integration</h1><h2 id=deploy-azure-key-vault-extension-to-azure-arc-enabled-ubuntu-server-and-use-a-key-vault-managed-certificate-with-nginx>Deploy Azure Key Vault Extension to Azure Arc enabled Ubuntu server and use a Key Vault managed certificate with Nginx</h2><p>The scenario will show you how to onboard the <a href=https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/key-vault-linux>Azure Key Vault</a> extension on an Azure Arc enabled server, and then use a certificate managed by Azure Key Vault to secure web traffic with TLS on a web server.</p><p>In this guide, we will focus on securing an Ubuntu web server. The only prerequisite you need to complete for this scenario is an existing Azure Arc enabled server running Ubuntu 18.04 (other Ubuntu releases may also work but have not been tested).</p><blockquote><p><strong>Note: This guide assumes you already deployed an Ubuntu server that is running on-premises or in other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li></ul><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p>As mentioned, this guide starts at the point where you already deployed and connected VMs or bare-metal servers to Azure Arc. For this scenario, as can be seen in the screenshots below, we will be using an Amazon Web Services (AWS) EC2 instance that has been already connected to Azure Arc and is visible as a resource in Azure.</p><p><img src=./01.png alt="Screenshot showing EC2 instance in AWS console"></p><p><img src=./02.png alt="Screenshot showing Azure Arc enabled server"></p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI to version 2.7.0 and above</a>. Use the below command to check your current installed version.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az --version
</code></pre></div></li></ul><h2 id=create-an-azure-key-vault-and-a-new-self-signed-certificate>Create an Azure Key Vault and a new self-signed certificate</h2><p>First, we will create a new Azure resource group, Azure Key Vault and a self-signed certificate from an Az CLI.</p><ul><li><p>Create a new resource group to hold the key vault resource.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az group create --name &lt;name <span style=color:#204a87;font-weight:700>for</span> your resource group&gt; --location &lt;location <span style=color:#204a87;font-weight:700>for</span> your resource group&gt;
</code></pre></div><p><img src=./03.png alt="Screenshot of creating a resource group from Az CLI"></p></li><li><p>Create a new key vault resource. Note that key vault names must be globally unique.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az keyvault create --name &lt;name <span style=color:#204a87;font-weight:700>for</span> your keyvault&gt; --location &lt;location&gt; --resource-group &lt;name of your resource group&gt;
</code></pre></div><p><img src=./04.png alt="Screenshot of creating a keyvault from Az CLI"></p></li><li><p>Create a new self-signed certificate with keyvault.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az keyvault certificate create --vault-name arckeyvault1 -n cert1 -p <span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>az keyvault certificate get-default-policy<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
</code></pre></div><p><img src=./05.png alt="Screenshot of creating a self-signed certificate from Az CLI"></p></li></ul><h2 id=install-and-configure-nginx-on-your-azure-arc-enabled-ubuntu-server>Install and configure Nginx on your Azure Arc enabled Ubuntu server</h2><p>We will use the Azure Custom Script extension on your Azure Arc enabled server to install and configure an Nginx web server. Before installing Nginx, we must open the right inbound ports on our AWS EC2 instance&rsquo;s security group. Then we will deploy an ARM template that will use the custom script extension to install Nginx.</p><ul><li><p>Navigate to your EC2 instance on the AWS cloud console and open the &ldquo;allow-all-sg&rdquo; security group.</p><p><img src=./06.png alt="Screenshot of an EC2 instance in AWS cloud console"></p></li><li><p>Click on the &ldquo;Inbound&rdquo; tab of the security group and then click &ldquo;Edit&rdquo;.</p><p><img src=./07.png alt="Screenshot of a security group in AWS cloud console"></p><p><img src=./08.png alt="Screenshot of a security group in AWS cloud console"></p></li><li><p>Click &ldquo;Add Rule&rdquo; and add HTTP and HTTPS rules, keeping all the default seeings as seen in the screenshot. Click Save.</p><p><img src=./09.png alt="Screenshot of adding a security group rule in AWS cloud console"></p><p><img src=./10.png alt="Screenshot of added a security group rule in AWS cloud console"></p></li><li><p>Configure Key Vault to allow Azure Arc enabled server to access secrets</p><ul><li><p>Navigate to your Key Vault and open the &ldquo;Access Policies&rdquo; blade</p><p><img src=./11.png alt="Screenshot of the Access Policies blade in a Key Vault"></p></li><li><p>Click &ldquo;Add access policy&rdquo; and in the dropdown for &ldquo;Secret Permissions&rdquo; check Get and List.</p><p><img src=./12.png alt="Screenshot showing &ldquo;Add access policy&rdquo; for Key Vault"></p></li><li><p>Next to &ldquo;Select principal&rdquo; Click &ldquo;None selected&rdquo; and search for your Azure Arc enabled server machine name and select it.</p><p><img src=./13.png alt="Screenshot showing &ldquo;Add access policy&rdquo; for Key Vault"></p></li><li><p>Click &ldquo;Save&rdquo; to commit the changes.</p><p><img src=./14.png alt="Screenshot showing &ldquo;Add access policy&rdquo; for Key Vault"></p></li></ul></li><li><p>Use Custom Script extension to install Nginx and configure Key Vault extension</p><ul><li><p>Modify the values of nginx-keyvault.parameters.json for the following parameters with values for your environment:</p><p><img src=./15.png alt="Screenshot showing example parameters for nginx-keyvault.parameters.json"></p></li><li><p>Run the deployment with the following Az CLI command.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az deployment group create --resource-group &lt;name of your resource group&gt; --template-file nginx-keyvault.json --parameters nginx-keyvault.parameters.json
</code></pre></div><p><img src=./16.png alt="Screenshot showing ARM deployment completing"></p></li></ul></li><li><p>SSH into your Azure Arc enabled server to update the Nginx configuration to use the certificate.</p><p><img src=./17.png alt="Screenshot showing SSH into Azure Arc enabled server"></p><ul><li><p>Open <em>/etc/nginx/conf.d/ssl.conf</em> using nano or your preferred text editor.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>nano /etc/nginx/conf.d/ssl.conf
</code></pre></div><p><img src=./18.png alt="Screenshot showing nano editing /etc/nginx/conf.d/ssl.conf"></p></li><li><p>Edit the file updating the following lines with the correct path to your certificate.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>ssl_certificate /etc/ssl/certs/&lt;your cert filename&gt;<span style=color:#000;font-weight:700>;</span>
ssl_certificate_key /etc/ssl/certs/&lt;your cert filename&gt;<span style=color:#000;font-weight:700>;</span>
</code></pre></div><p>Your filename will be of the format &lsquo;keyvault_name&rsquo;.&lsquo;certificate_name&rsquo; (all lowercase). For example, if your Key Vault is named &ldquo;myKeyVault&rdquo; and your certificate is named &ldquo;cert1&rdquo; then your filename will be &ldquo;mykeyvault.cert1&rdquo;. See the screens below for a before and after example.</p><p><img src=./19.png alt="Screenshot showing unedited /etc/nginx/conf.d/ssl.conf"></p><p><img src=./20.png alt="Screenshot showing edited /etc/nginx/conf.d/ssl.conf"></p></li><li><p>Restart the nginx service by running the following command.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>sudo service nginx restart
</code></pre></div><p><img src=./21.png alt="Screenshot showing restart of nginx service"></p></li></ul></li><li><p>Test everything by accessing your Nginx webserver over HTTPS. Open a browser and enter &ldquo;https://XX.XX.XX.XX&rdquo; into the address bar, replacing the placeholder with the public IP address of your server.</p><ul><li><p>You should see a warning describing that your connection is not private or secure. The message will vary depending on which web browser you use.</p><p><img src=./22.png alt="Screenshot showing accessing web server in browser"></p></li><li><p>If you are using Microsoft Edge, you can validate that your certificate is being used by comparing the certificate thumbprint reported in the browser with your certificate thumbprint in Key Vault, as seen in the screenshots below. Click the &ldquo;Not secure&rdquo; box to the left of the address bar, then click &ldquo;Certificate (not valid)&rdquo; and open the &ldquo;Details&rdquo; tab to view the thumbprint.</p><p><img src=./23.png alt="Screenshot showing browser certificate thumbprint"></p><p><img src=./24.png alt="Screenshot showing browser certificate thumbprint"></p><p><img src=./25.png alt="Screenshot showing Key Vault certificate thumbprint"></p></li></ul></li></ul><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><ul><li><p>Delete the key vault resource by running the following command in Az CLI.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az keyvault delete --name &lt;name of your keyvault&gt;
</code></pre></div><p><img src=./26.png alt="Screenshot showing Key Vault being deleted from Az CLI"></p></li><li><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-eda68bcba3c1263207b730fff996799e>6 - Security Center</h1><h2 id=connect-azure-arc-enabled-servers-to-azure-security-center>Connect Azure Arc enabled servers to Azure Security Center</h2><p>The following README will guide you on how to onboard an Azure Arc enabled server on to <a href=https://docs.microsoft.com/en-us/azure/security-center/>Azure Security Center (ASC)</a>, so you can start collecting security-related configurations as well as event logs to recommend actions and improve your overall Azure security posture.</p><p>In this guide, you will enable and configure Azure Security Center Standard tier on your Azure subscription, which will provide you with advanced threat protection (ATP) and detection capabilities. To complete this process you will:</p><ul><li><p>Setup a Log Analytics Workspace where logs and events will be aggregated for analysis.</p></li><li><p>Assign Security Center’s default security policies.</p></li><li><p>Review Azure Security Center&rsquo;s recommendations.</p></li><li><p>Apply recommended configurations on Azure Arc enabled servers using the <em><strong>Quick Fix</strong></em> remediations.</p></li></ul><blockquote><p><strong>Note: This guide assumes you already deployed VMs or servers that are running on-premises or other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p>As mentioned, this guide starts at the point where you already deployed and connected VMs or bare-metal servers to Azure Arc. For this scenario, as can be seen in the screenshots below, we will be using a Google Cloud Platform (GCP) instance that has been already connected to Azure Arc and is visible as a resource in Azure.</p><p><img src=./01.png alt="Screenshot of Azure Portal showing Azure Arc enabled server"></p><p><img src=./02.png alt="Screenshot of Azure Portal showing Azure Arc enabled server detail"></p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI</a>. Azure CLI should be running version 2.7** or later. Use <code>az --version</code> to check your current installed version.</p></li><li><p>Create Azure service principal (SP)</p><p>To connect a VM or bare-metal server to Azure Arc, Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a>.</strong></p></blockquote></li></ul><h2 id=onboarding-azure-security-center>Onboarding Azure Security Center</h2><ul><li><p>Data collected by Azure Security Center is stored in a Log Analytics workspace. You can either use the default one created by ASC or a custom one created by you. If you want to create a dedicated workspace, you can automate the deployment by editing the ARM template <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/securitycenter/arm/log_analytics-template.parameters.json>parameters file</a>, provide a name and location for your workspace:</p><p><img src=./03.png alt="Screenshot showing Azure ARM template"></p></li><li><p>To deploy the ARM template, navigate to the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/securitycenter/arm>deployment folder</a> and run the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>  az deployment group create --resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --template-file &lt;The *log_analytics-template.json* template file location&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --parameters &lt;The *log_analytics-template.parameters.json* template file location&gt;
</code></pre></div></li><li><p>If you are going for an user-defined workspace, you should instruct Security Center to use it instead of the default one, use the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>  az security workspace-setting create --name default <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --target-workspace <span style=color:#4e9a06>&#39;/subscriptions/&lt;Your subscription ID&gt;/resourceGroups/&lt;Name of the Azure resource group&gt;/providers/Microsoft.OperationalInsights/workspaces/&lt;Name of the Log Analytics Workspace&gt;&#39;</span>
</code></pre></div></li><li><p>Select the Azure Security Center tier. The Free tier is enabled on all your Azure subscriptions by default and will provide continuous security assessment and actionable security recommendations. In this guide, you will use the Standard tier for Virtual Machines that extends these capabilities providing unified security management and threat protection across your hybrid cloud workloads. To enable the Standard tier of Azure Security Center for VMs run the command below:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az security pricing create -n VirtualMachines --tier <span style=color:#4e9a06>&#39;standard&#39;</span>
</code></pre></div></li><li><p>Now you need to assign the default Security Center policy initiative. ASC makes its security recommendations based on policies. There is an specific initiative that groups Security Center policies with the definition ID &lsquo;1f3afdf9-d0c9-4c3d-847f-89da613e70a8&rsquo;. The command below will assign the ASC initiative to your subscription:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az policy assignment create --name <span style=color:#4e9a06>&#39;ASC Default &lt;Your subscription ID&gt;&#39;</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--scope <span style=color:#4e9a06>&#39;/subscriptions/&lt;Your subscription ID&gt;&#39;</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--policy-set-definition <span style=color:#4e9a06>&#39;1f3afdf9-d0c9-4c3d-847f-89da613e70a8&#39;</span>
</code></pre></div></li></ul><h2 id=azure-arc-and-azure-security-center-integration>Azure Arc and Azure Security Center Integration</h2><p>Now that you have successfully onboard ASC, you will get recommendations to help you protect your resources, including your Azure Arc enabled servers. ASC will then periodically analyze the security state of your Azure resources to identify potential security vulnerabilities.</p><ul><li><p>In the &ldquo;Compute & apps&rdquo; section under &ldquo;VM and Servers&rdquo;, ASC will provide you with an overview of all the discovered security recommendations for your VMs and computers, including Azure VMs, Azure Classic VMs, servers and <strong>Azure Arc Machines</strong>.</p><p><img src=./04.png alt="Screenshot showing Azure Security Center compute and apps"></p></li><li><p>On the Azure Arc enabled servers, ASC will provide a recommendation to install the Log Analytics agent. In addition, each recommendation will include:</p><ul><li><p>A short description of what is being recommended.</p></li><li><p>A Secure Score impact, in this case, with a status of <em>High</em>.</p></li><li><p>The remediation steps to carry out in order to implement the recommendation. For specific recommendations, like this one, you will also get a <em><strong>Quick Fix</strong></em> that enables you to quickly remediate a recommendation on multiple resources.</p><p><img src=./05.png alt="Screenshot showing ASC recommendation on Azure Arc enabled server"></p><p><img src=./06.png alt="Screenshot showing ASC recommendation to install Log Analytics"></p></li></ul></li><li><p>This remediation <em><strong>Quick Fix</strong></em> is using an ARM template to deploy the Microsoft Monitoring Agent extension on the Azure Arc machine.</p><p><img src=./07.png alt="Screenshot showing ASC Quick Fix ARM template"></p></li><li><p>You can trigger the remediation with the ARM template from the Azure Security Center dashboard, by selecting the Log Analytics Workspace used for ASC and clicking on &ldquo;Remediate 1 resource&rdquo;.</p><p><img src=./08.png alt="Screenshot showing triggering of remediation step of ASC"></p></li><li><p>After you apply the recommendation on the Azure Arc enabled server the resource will be now marked as healthy.</p><p><img src=./09.png alt="Screenshot showing healthy Azure Arc enabled server"></p></li></ul><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><ul><li><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></p></li><li><p>Remove the Log Analytics workspace by executing the following script in AZ CLI. Provide the workspace name you used when creating the Log Analytics Workspace.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az monitor log-analytics workspace delete --resource-group &lt;Name of the Azure resource group&gt; --workspace-name &lt;Log Analytics Workspace Name&gt; --yes
</code></pre></div></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-50dbeacfd1099752a6b9ae86ffca6b70>7 - Azure Sentinel</h1><h2 id=connect-azure-arc-enabled-servers-to-azure-sentinel>Connect Azure Arc enabled servers to Azure Sentinel</h2><p>The following README will guide you on how to onboard Azure Arc enabled servers on to <a href=https://docs.microsoft.com/es-es/azure/sentinel/>Azure Sentinel</a>, so you can start collecting security-related events and start correlating them with other data sources.</p><p>In this guide, you will enable and configure Azure Sentinel on your Azure subscription. To complete this process you will:</p><ul><li><p>Setup a Log Analytics Workspace where logs and events will be aggregated for analysis and correlation.</p></li><li><p>Enable Azure Sentinel on the workspace.</p></li><li><p>Onboard Azure Arc enabled servers on Sentinel by using the extension management feature and Azure Policies.</p></li></ul><blockquote><p><strong>Note: This guide assumes you already deployed VMs or servers that are running on-premises or other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p>As mentioned, this guide starts at the point where you already deployed and connected VMs or bare-metal servers to Azure Arc. For this scenario, as can be seen in the screenshots below, we will be using a Google Cloud Platform (GCP) instance that has been already connected to Azure Arc and is visible as a resource in Azure.</p><p><img src=./01.png alt="Screenshot showing Azure Portal with Azure Arc enabled server"></p><p><img src=./02.png alt="Screenshot showing Azure Portal with Azure Arc enabled server detail"></p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI</a>. Azure CLI should be running version 2.7** or later. Use <code>az --version</code> to check your current installed version.</p></li><li><p>Create Azure service principal (SP).</p><p>To connect a VM or bare-metal server to Azure Arc, Azure service principal assigned with the &ldquo;Contributor&rdquo; role is required. To create it, login to your Azure account run the below command (this can also be done in <a href=https://shell.azure.com/>Azure Cloud Shell</a>).</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az login
az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;&lt;Unique SP Name&gt;&#34;</span> --role contributor
</code></pre></div><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az ad sp create-for-rbac -n <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span> --role contributor
</code></pre></div><p>Output should look like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
<span style=color:#204a87;font-weight:700>&#34;appId&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;displayName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;http://AzureArcServers&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#204a87;font-weight:700>&#34;tenant&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><blockquote><p><strong>Note: It is optional but highly recommended to scope the SP to a specific <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">Azure subscription and resource group</a>.</strong></p></blockquote></li></ul><h2 id=onboarding-azure-sentinel>Onboarding Azure Sentinel</h2><p>Azure Sentinel uses the Log Analytics agent to collect Windows and Linux server&rsquo;s log files and forwards them to Azure Sentinel, the data collected is stored in a Log Analytics workspace. Since you cannot use the default workspace created by Azure Security Center (ASC), a custom one is required and you could have raw events and alerts for ASC within the same custom workspace as Sentinel.</p><ul><li><p>You will need to create a dedicated Log Analytics workspace and enable the Azure Sentinel solution on the top of it. For that you can use this <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/azuresentinel/arm/sentinel-template.json>ARM template</a> that will create a new Log Analytics Workspace and define the Azure Sentinel solution and enable it for the workspace. To automate the deployment edit the ARM template <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/azuresentinel/arm/sentinel-template.parameters.json>parameters file</a>, provide a name and location for your workspace:</p><p><img src=./03.png alt="Screenshot showing Azure ARM template"></p></li><li><p>To deploy the ARM template, navigate to the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/azuresentinel/arm>deployment folder</a> and run the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az deployment group create --resource-group &lt;Name of the Azure resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--template-file &lt;The *sentinel-template.json* template file location&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--parameters &lt;The *sentinel-template.parameters.json* template file location&gt;
</code></pre></div></li></ul><p>For example:</p><p><img src=./04.png alt="Screenshot showing az deployment group create command"></p><h2 id=azure-arc-enabled-vms-onboarding-on-azure-sentinel>Azure Arc enabled VMs onboarding on Azure Sentinel</h2><p>Once you have deployed Azure Sentinel on your Log Analytics workspace, you will need to connect data sources to it.</p><p>There are connectors for Microsoft services, third party solutions from the Security products ecosystem. You can also use Common Event Format (CEF), Syslog, or REST-API to connect your data sources with Azure Sentinel.</p><p>For servers and VMs, you can install the Microsoft Monitoring Agent (MMA) agent or the Sentinel agent which collects the logs and forwards them to Azure Sentinel. You can deploy the agent in multiple ways by leveraging Azure Arc:</p><ul><li>Using <strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/day2/arc_vm_extension_mma_arm/>Extension Management</a></strong></li></ul><p>This feature in Azure Arc enabled servers allows you to deploy the MMA agent VM extensions to a non-Azure Windows and/or Linux VMs. You can use the Azure Portal, Azure CLI, an ARM template as well as PowerShell script to manage extension deployment to Azure Arc enabled servers.</p><ul><li>Setting up <strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/day2/arc_policies_mma/>Azure Policies</a></strong></li></ul><p>Using this approach, you will assign an Azure Policy to audit if the Azure Arc enabled Server has the MMA agent installed. If the agent is not installed, you will use the Extensions feature to automatically deploy it to the VM using a Remediation task, an enrollment experience that compares to Azure VMs.</p><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><ul><li><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></p></li><li><p>Remove the Log Analytics workspace by executing the following script in AZ CLI. Provide the workspace name you used when creating the Log Analytics Workspace.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az monitor log-analytics workspace delete --resource-group &lt;Name of the Azure resource group&gt; --workspace-name &lt;Log Analytics Workspace Name&gt; --yes
</code></pre></div></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-16e609be239099590da0beb9af17b4c5>8 - Update Management</h1><h2 id=enable-update-management-on-azure-arc-enabled-servers>Enable Update Management on Azure Arc enabled servers</h2><p>The scenario will show you how to onboard Azure Arc enabled servers to <a href=https://docs.microsoft.com/en-us/azure/automation/update-management/overview>Update Management</a>, so that you can manage operating system updates for your Azure Arc enabled servers running Windows or Linux.</p><p>In this guide, you will create and configure an Azure Automation account and Log Analytics workspace to support Update Management for Azure Arc enabled servers by doing the following:</p><ul><li><p>Setup a new Log Analytics Workspace and Azure Automation account.</p></li><li><p>Enable Update Management on Azure Arc enabled servers.</p></li></ul><blockquote><p><strong>Note: This guide assumes you already deployed VMs or servers that are running on-premises or other clouds and you have connected them to Azure Arc but If you haven&rsquo;t, this repository offers you a way to do so in an automated fashion:</strong></p></blockquote><ul><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></li><li><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></li></ul><h2 id=prerequisites>Prerequisites</h2><ul><li><p>Clone the Azure Arc Jumpstart repository</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/microsoft/azure_arc.git
</code></pre></div></li><li><p>As mentioned, this guide starts at the point where you already deployed and connected VMs or bare-metal servers to Azure Arc. For this scenario, as can be seen in the screenshots below, we will be using an Amazon Web Services (AWS) EC2 instance that has been already connected to Azure Arc and is visible as a resource in Azure.</p><p><img src=./01.png alt="Screenshot showing AWS cloud console with EC2 instance"></p><p><img src=./02.png alt="Screenshot showing Azure Portal with Azure Arc enabled server"></p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install or update Azure CLI</a>. Azure CLI should be running version 2.14 or later. Use <code>az --version</code> to check your current installed version.</p></li></ul><h2 id=configuring-update-management>Configuring Update Management</h2><p>Update Management uses the Log Analytics agent to collect Windows and Linux server log files and the data collected is stored in a Log Analytics workspace.</p><ul><li><p>You will need to create a Log Analytics workspace. For that you can use this <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/updateManagement/law-template.json>ARM template</a> that will create a new Log Analytics Workspace and define the Update Management solution and enable it for the workspace.</p></li><li><p>First, create a new resource group for the Log Analytics workspace by running the below command, replacing the values in brackets with your own.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az group create --name &lt;Name <span style=color:#204a87;font-weight:700>for</span> your resource group&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--location &lt;Location <span style=color:#204a87;font-weight:700>for</span> your resources&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>--tags <span style=color:#4e9a06>&#34;Project=jumpstart_azure_arc_servers&#34;</span>
</code></pre></div><p><img src=./03.png alt="Screenshot showing az group create being run"></p></li><li><p>Next, edit the ARM template <a href=https://github.com/microsoft/azure_arc/blob/main/azure_arc_servers_jumpstart/updateManagement/law-template.parameters.json>parameters file</a>, providing a name for your Log Analytics workspace, a location, and a name for your Azure Automation account. You also need to supply the name of your Azure Arc enabled server, and the name of the resource group that contains the Arc enabled server as shown in the example below:</p><p><img src=./04.png alt="Screenshot showing Azure ARM template"></p></li><li><p>To deploy the ARM template, navigate to the <a href=https://github.com/microsoft/azure_arc/tree/main/azure_arc_servers_jumpstart/updateManagement>deployment folder</a> and run the below command:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az deployment group create --resource-group &lt;Name of the Azure resource group you created&gt; <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    --template-file law-template.json <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    --parameters law-template.parameters.json
</code></pre></div><p><img src=./05.png alt="Screenshot showing az deployment group create being run"></p></li><li><p>When the deployment is complete, you should be able to see the resource group with your Log Analytics workspace, automation account and Update Management solution from the Azure Portal. Drilling into the Log Analytics workspace Solutions blade should show the Update Management solution.</p><p><img src=./06.png alt="Screenshot showing Azure Portal with Log Analytics workspace"></p></li></ul><h2 id=confirm-that-the-update-management-solution-is-deployed-on-your-azure-arc-enabled-server>Confirm that the Update Management solution is deployed on your Azure Arc enabled server</h2><ul><li><p>Click on the Solutions blade of the Log Analytics workspace and then click the Updates solution from the list to check the progress of the Update Management assessment.</p><p><img src=./13.png alt="Screenshot showing Solutions Blade of Log Analytics workspace"></p></li><li><p>It may take several hours for Update Management to collect enough data to show an assessment for your VM. In the screen below we can see the assessment is being performed.</p><p><img src=./14.png alt="Screenshot showing Update Management overview blade"></p></li><li><p>When the assessment is complete, you will see an option to &ldquo;View summary&rdquo; on the Update Management blade.</p><p><img src=./15.png alt="Screenshot showing Update Management with summary"></p></li><li><p>Click View Summary and then click again to drill into the Update Management assessment. In the below example we can see there are updates missing on our Azure Arc enabled server.</p><p><img src=./16.png alt="Screenshot showing"></p></li></ul><h2 id=schedule-an-update>Schedule an Update</h2><p>Now that we have configured the Update Management solution, we can deploy updates on a set schedule for our Azure Arc enabled server.</p><ul><li><p>Navigate to the Automation Account we created previously and click on the Update Management blade as shown in the screenshot below. You should see your Azure Arc enabled server listed.</p><p><img src=./18.png alt="Screenshot showing Azure Automation account"></p></li><li><p>From the above screen, click &ldquo;Schedule update deployment&rdquo;. On the next screen, select the Operating System that your Azure Arc enabled server is using, and then select &ldquo;Machines to update&rdquo; as shown below.</p><p><img src=./19.png alt="Screenshot showing scheduling an update with Update Management"></p></li><li><p>From the &ldquo;Type&rdquo; dropdown, select &ldquo;Machines&rdquo; and then select your server and click Ok.</p><p><img src=./20.png alt="Screenshot showing scheduling an update with Update Management"></p></li><li><p>Click Schedule Settings and then provide a desired schedule.</p><p><img src=./21.png alt="Screenshot showing scheduling an update with Update Management"></p><p><img src=./22.png alt="Screenshot showing scheduling an update with Update Management"></p></li><li><p>Finally, provide a name for your Update deployment and then click Create.</p><p><img src=./23.png alt="Screenshot showing scheduling an update with Update Management"></p></li><li><p>From the Automation Account Update Management blade, you should be able to see your scheduled Update deployment from the Deployment Schedules tab.
<img src=./24.png alt="Screenshot showing scheduled update"></p></li></ul><p>The Update Management solution will now update your Azure Arc enabled servers in the deployment window based on the schedule you defined. There is a lot more you can do with <a href=https://docs.microsoft.com/en-us/azure/automation/update-management/overview>Update Management</a> that is outside the scope of this scenario. Review the <a href=https://docs.microsoft.com/en-us/azure/automation/update-management/overview>documentation</a> for more information.</p><h2 id=clean-up-environment>Clean up environment</h2><p>Complete the following steps to clean up your environment.</p><ul><li><p>Remove the virtual machines from each environment by following the teardown instructions from each guide.</p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_ubuntu/>GCP Ubuntu instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/gcp/gcp_terraform_windows/>GCP Windows instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_ubuntu/>AWS Ubuntu EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/aws/aws_terraform_al2/>AWS Amazon Linux 2 EC2 instance</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_linux/>Azure Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/azure/azure_arm_template_win/>Azure Windows VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_ubuntu/>VMware vSphere Ubuntu VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vmware/vmware_terraform_winsrv/>VMware vSphere Windows Server VM</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_ubuntu/>Vagrant Ubuntu box</a></strong></p></li><li><p><strong><a href=https://azurearcjumpstart.io/azure_arc_jumpstart/azure_arc_servers/vagrant/local_vagrant_windows/>Vagrant Windows box</a></strong></p></li><li><p>Delete the resource group.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>az group delete --name &lt;Name of your resource group&gt;
</code></pre></div><p><img src=./26.png alt="Screenshot showing az group delete being run"></p></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/stack><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/lujiansong/azure_arc><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 The Docsy Authors All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank>Privacy Policy</a></small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.b5fc1b29d2465835844254bd4d804738eaf24c0cec53009b4c6899989be55a47.js integrity="sha256-tfwbKdJGWDWEQlS9TYBHOOryTAzsUwCbTGiZmJvlWkc=" crossorigin=anonymous></script></body></html>